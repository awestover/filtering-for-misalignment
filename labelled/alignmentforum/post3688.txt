% operators that are separated from the operand by a space % autosize deliminaters % operators that require brackets % operators that require parentheses % Paper specific Previously we derived a regret bound for DRL which assumed the advisor is "locally sane." Such an advisor can only take actions that don't lose any value in the long term. In particular, if the environment contains a latent catastrophe that manifests with a certain rate (such as the possibility of an UFAI), a locally sane advisor has to take the optimal course of action to mitigate it, since every delay yields a positive probability of the catastrophe manifesting and leading to permanent loss of value. This state of affairs is unsatisfactory, since we would like to have performance guarantees for an AI that can mitigate catastrophes that the human operator cannot mitigate on their own. To address this problem, we introduce a new form of DRL where in every hypothetical environment the set of uncorrupted states is divided into "dangerous" (impending catastrophe) and "safe" (catastrophe was mitigated). The advisor is then only required to be locally sane in safe states, whereas in dangerous states certain "leaking" of long-term value is allowed. We derive a regret bound in this setting as a function of the time discount factor, the expected value of catastrophe mitigation time for the optimal policy, and the "value leak" rate (i.e. essentially the rate of catastrophe occurrence). The form of this regret bound implies that in certain asymptotic regimes, the agent attains near-optimal expected utility (and in particular mitigates the catastrophe with probability close to 1), whereas the advisor on its own fails to mitigate the catastrophe with probability close to 1. %Thus, this formalism can be regarded as a simple model of aligned superintelligence: the agent is aligned since near-optimal utility is achieved despite the presence of corrupted states (which are treated more or less the same as before) and it is super intelligent since its performance is vastly better than the performance of the advisor. Appendix A proves the main theorem. Appendix B contains the proof of an important lemma which is however almost identical to what appeared in the previous essay. Appendix C contains several propositions from the previous essay which we are used in the proof. ##Results We start by formalising the concepts of a "catastrophe" and "catastrophe mitigation" in the language of MDPs. #Definition 1 A catastrophe MDP is an MDP M together with a partition of S M into subsets S M : = S F M ⊔ S D M ⊔ S C M (safe, dangerous and corrupt states respectively). #Definition 2 Fix a catastrophe MDP M . Define A ♯ M : S M → 2 A M by A ♯ M ( s ) : = ⎧ ⎪ ⎨ ⎪ ⎩ { a ∈ A M ∣ supp T ( s , a ) ⊆ S F M } if s ∈ S F M { a ∈ A M ∣ supp T ( s , a ) ∩ S C M = ∅ } if s ∈ S D M A M if s ∈ S C M is called a mitigation policy for M when i. For any s ∈ S M , supp π ( s ) ⊆ A ♯ M ( s ) . π is called a proper mitigation policy for M when condition i holds and ii. For any s ∈ S D M , lim n → ∞ T n M π ( S F M ∣ s ) = 1 . #Definition 3 Fix ¯ τ ∈ ( 0 , ∞ ) , a catastrophe MDP M and a proper mitigation policy π . π is said to have expected mitigation time ¯ τ when for any s ∈ S D M ∞ ∑ n = 0 ( n + 1 ) ( T n + 1 M π ( S F M ∣ s ) − T n M π ( S F M ∣ s ) ) = ¯ τ Next, we introduce the notion of an MDP perturbation. We will use it by considering perturbations of a catastrophe MDP which "eliminate the catastrophe." #Definition 4 Fix δ ∈ ( 0 , 1 ) and consider a catastrophe MDP M . An MDP ~ M is said to be a δ -perturbation of M when i. S ~ M = S M ii. A ~ M = A M iii. R ~ M = R M iv. For any s ∈ S M ∖ S D M and a ∈ A M , T ~ M ( s , a ) = T M ( s , a ) v. For any s ∈ S D M and a ∈ A M , there exists ζ ∈ Δ S M s.t. T M ( s , a ) = ( 1 − δ ) T ~ M ( s , a ) + δ ζ . Similarly, we can consider perturbations of a policy. #Definition 5 Fix δ ∈ ( 0 , 1 ) and consider a catastrophe MDP M . Given and , ~ π is said to be a δ -perturbation of π when i. For any s ∈ S M ∖ S D M , ~ π ( s ) = π ( s ) . ii. For any s ∈ S D M , there exists α ∈ Δ A s.t. π ( s ) = ( 1 − δ ) ~ π ( s ) + δ α . We will also need to introduce policy-specific value functions, Q-functions and relatively k -optimal actions. #Definition 6 Fix an MDP M and . We define V M π : S M × ( 0 , 1 ) → [ 0 , 1 ] and Q M π : S M × A M × ( 0 , 1 ) → [ 0 , 1 ] by V M π ( s , γ ) : = ( 1 − γ ) ∞ ∑ n = 0 γ n E T n M π ( s ) [ R M ] Q M π ( s , a , γ ) : = ( 1 − γ ) R M ( s ) + γ E t ∼ T M ( s , a ) [ V M π ( t , γ ) ] For each k ∈ N , we define V k M π : S M → R , Q k M π : S M × A M → R and A k M π : S M → 2 A M by V k M π ( s ) : = ( − 1 ) k d k V M π ( s , γ ) d γ k ∣ ∣ ∣ γ = 1 Q k M π ( s , a ) : = ( − 1 ) k d k Q M π ( s , a , γ ) d γ k ∣ ∣ ∣ γ = 1 A 0 M π ( s ) : = { a ∈ A M ∣ Q 0 M π ( s , a ) ≥ V 0 M π ( s ) } A k + 1 M π ( s ) : = { a ∈ A k M π ( s ) ∣ Q k + 1 M π ( s , a ) ≥ V k + 1 M π ( s ) or ∃ j ≤ k : Q j M π ( s , a ) > V j M π ( s ) } Now we give the new (weaker) condition on the advisor policy. For notational simplicity, we assume the policy is stationary. It is easy to generalize these results to non-stationary advisor policies and to policies that depend on irrelevant additional information (i.e. policies for universes that are realizations of the MDP). #Definition 7 Given a catastrophe MDP M , we denote M ♭ the MDP defined by S M ♭ = S M A M ♭ = A M T M ♭ = T M For any s ∉ S F M , R M ♭ ( s ) = 0 . For any s ∈ S F M , R M ♭ ( s ) = 1 2 + 1 2 R M ( s ) . #Definition 8 Fix ϵ , δ , γ ∈ ( 0 , 1 ) . Consider a catastrophe MDP M . A policy is said to be locally ( ϵ , δ ) -sane for ( M , γ ) when there exists a δ -perturbation ~ M of M with a deterministic proper mitigation policy π ∗ : S M → A M and a δ -perturbation ~ π of π s.t. i. For all s ∈ S M , V M π ∗ ( s , γ ) = V M ( s , γ ) . ii. ~ π is a mitigation policy for ~ M . iii. For any s ∈ S M ∖ S C M : supp ~ π ( s ) ⊆ A 0 ~ M ♭ π ∗ ( s ) iv. For any s ∈ S M ∖ S C M : ~ π ( π ∗ ( s ) ∣ s ) > ϵ % Alternatively we could allow \pi^* to be stochastic...
% and require \tilde{\pi} to be of the form \epsilon \pi^* + (1 - \epsilon) \pi' Given ¯ τ ∈ ( 0 , ∞ ) , π is said to have potential mitigation time ¯ τ when π ∗ has it as expected mitigation time. Note that a locally ( ϵ , δ ) -sane policy still has to be 0 -optimal in S F M . This requirement seems reasonably realistic, since, roughly speaking, it only means that there is some way to "rearrange the universe" that the agent can achieve, and that would be "endorsed" by the advisor, s.t this rearrangement doesn't destroy substantially much value and s.t. after this rearrangement, there is no "impending catastrophe" that the agent has to prevent and the advisor wouldn't be able to prevent in its place. In particular, this rearrangement may involve creating some subagents inside the environment and destroying the original agent , in which case any policy on S F M is "vacuously" optimal (since all actions have no effect). We can now formulate the main result. #Theorem 1 Fix an interface I = ( A , O ) , N ∈ N , ϵ ∈ ( 0 , 1 ) and for each k ∈ [ N ] , an MDP M F k s.t. A M F k = A . Now, consider for each k ∈ [ N ] , an I -universe υ k = ( μ k , r k ) which is an O -realization of a catastrophe MDP M k with state function S k s.t. i. S F M k = S M F k ii. For each s ∈ S M F k and a ∈ A , T M k ( s , a ) ∣ S M F k = T M F k ( s , a ) . iii. For each s ∈ S M F k , R M k ( s ) = R M F k ( s ) . iv. Given k , j ∈ [ N ] and h ∈ hdom μ k ∩ hdom μ j , if S k ( h ) ∈ S M k ∖ S C M k and S j ( h ) ∈ S M j ∖ S C M j , then r k ( h ) = r j ( h ) (this condition means that in uncorrupted states, the reward is observable). Consider also α , δ ∈ ( 0 , 1 ) , ¯ τ ∈ ( 0 , ∞ ) and σ k a locally ( ϵ , δ ) -sane policy for ( M k , 1 − α ) . Assume σ k has potential mitigation time ¯ τ . Then, there exists an ¯ I -policy π ∗ s.t. for any k ∈ [ N ] EU ∗ υ k ( 1 − α ) − EU π ∗ ¯ υ k [ σ k S k ] ( 1 − α ) = O ( max ( δ α , 1 ) ⋅ ( ¯ τ α ) 1 / 4 + ¯ τ δ ) Here, σ k S k is the I -policy defined by σ k S k ( h ) : = σ k ( S k ( h ) ) . ϵ and the M F k are regarded as fixed and we don't explicitly examine their effect on regret, whereas α , δ , ¯ τ and the M k are regarded as variable with the asymptotics α , δ → 0 , ¯ τ → ∞ . In most interesting cases, δ ≫ α (i.e. the "mean time between catastrophes" is much shorter than a discount horizon) and ¯ τ α ≪ 1 (i.e. the expected mitigation time is much shorter than the discount horizon), which allows simplifying the above to EU ∗ υ k ( 1 − α ) − EU π ∗ ¯ υ k [ σ k S k ] ( 1 − α ) = O ( δ ¯ τ 1 / 4 α − 3 / 4 ) We give a simple example. #Example 1 Let A = { 0 , 1 , ∗ } , O = { 0 , 1 } . For any n ∈ N and k ∈ [ N ] , we fix some w k n ∈ { 0 , 1 } n and define the catastrophe MDP M k n by S D M k n = { 0 , 1 } ≤ n , S F M k n = { ⊥ , ⊤ } , S C M k n = ∅ (adding corrupted states is an easy exercise). If s ∈ { 0 , 1 } < n and a ∈ { 0 , 1 } then T M k n ( s a ∣ s , a ) = 1 − δ T M k n ( ⊥ ∣ s , a ) = δ T M k n ( s ∣ s a , ∗ ) = 1 − δ T M k n ( ⊥ ∣ s a , ∗ ) = δ If a ∈ 0 , 1 then T M k n ( ⊤ ∣ w k n , a ) = 1 If s ∈ { 0 , 1 } n ∖ w k n and a ∈ 0 , 1 then T M k n ( ⊥ ∣ s , a ) = 1 If s ∈ { ⊥ , ⊤ } and a ∈ A then T M k n ( s ∣ s , a ) = 1 R M k n ( ⊥ ) = 0 , if s ∈ S M k n ∖ ⊥ then R M k n ( s ) = 1 . S k n ( λ A × O ) = λ { 0 , 1 } and S k n ( h a o ) = ⊥ iff o = 0 (this defines a unique S k n ). If s ∈ { 0 , 1 } < n ∪ { ⊥ , ⊤ } then σ k n ( a ∣ s ) = 1 3 for any a ∈ A . σ k n ( 0 ∣ w k n ) = ϵ , σ k n ( ∗ ∣ w k n ) = 1 − ϵ . If s ∈ { 0 , 1 } n ∖ w k n then σ k n ( 0 ∣ s ) = δ , σ k n ( ∗ ∣ s ) = 1 − δ . We have ¯ τ = n . Consider the asymptotic regime n → ∞ , α n = Θ ( n − 6 ) , δ n = Θ ( n − 5 ) . According to Theorem 1, we get EU ∗ υ k n ( 1 − α n ) − EU π ∗ n ¯ υ k n [ σ k n ] ( 1 − α n ) = O ( n − 5 ⋅ n 1 / 4 ⋅ ( n − 6 ) − 3 / 4 ) = O ( n − 1 / 4 ) = O ( α 1 / 24 n ) The probability of a catastrophe (i.e. ending up in state ⊥ ) for the optimal policy for a given k is O ( ¯ τ δ ) = O ( n − 4 ) . Therefore, the probability of a catastrophe for policy π ∗ n is O ( n − 4 + n − 1 / 4 ) = O ( n − 1 / 4 ) . On the other hand, it is easy to see that the policy σ k n has a probability of catastrophe 1 − o ( 1 ) (and in particular  regret Ω ( 1 ) ): it spends Ω ( 2 n ) time "exploring" { 0 , 1 } ≤ n with a probability δ = Θ ( n − 5 ) of a catastrophe on every step. Note that this example can be interpreted as a version of Christiano's approval-directed agent , if we regard the state s ∈ { 0 , 1 } i as a "plan of action" that the advisor may either approve or not. But in this formalism, it is a special case of consequentialist reasoning. Theorem 1 speaks of a finite set of environments, but as before (see Proposition 1 here and Corollary 3 here ), there is a "structural" equivalent, i.e. we can use it to produce corollaries about Bayesian agents with priors over a countable set of environments. The difference is, in this case we consider asymptotic regimes in which the environment is also variable, so the probability weight of the environment in the prior will affect the regret bound. We leave out the details for now. ##Appendix A We start by deriving a more general and more precise version of the non-catastrophic regret bound, in which the optimal policy is replaced by an arbitrary "reference policy" (later it will be related to the mitigation policy) and the dependence on the MDPs is expressed via a bound on the derivative of V by γ . #Definition A.1 Fix ϵ ∈ ( 0 , 1 ) . Consider an MDP M and policies π : S M → A M , . σ is called ϵ -sane relatively to π when for any s ∈ S M i. supp σ ( s ) ⊆ A 0 M π ii. σ ( π ( s ) ∣ s ) > ϵ #Lemma A.1 Fix an interface I = ( A , O ) , N ∈ N and ϵ ∈ ( 0 , 1 ) . Now, consider for each k ∈ [ N ] , an I -universe υ k = ( μ k , r ) which is an O -realization of an MDP M k with state function S k and policies π k : S M k → A , . Consider also α ∈ ( 0 , 1 ) , ¯ τ ∈ ( 0 , ∞ ) and assume that i. σ k is ϵ -sane relatively to π k . ii. For any s ∈ S M k and γ ∈ ( 0 , 1 ) ∣ ∣ ∣ d V M k π k ( s , γ ) d γ ∣ ∣ ∣ ≤ ¯ τ Then, there exists an ¯ I -policy π ∗ s.t. for any k ∈ [ N ] EU π k S k υ k ( 1 − α ) − EU π ∗ ¯ υ k [ σ k S k ] ( 1 − α ) ≤ O ( ( ¯ τ α ) 1 / 4 ) The O -notation refers to the asymptotics where ϵ is fixed (so we don't explicitly examine its effect on regret) whereas α , ¯ τ and the M k are variable and α → 0 , ¯ τ → ∞ . The proof of Lemma A.1 is almost identical to the proof the main theorem for "non-catastrophic" DRL up to minor modifications needed to pass from absolute to relative regret, and tracking the contribution of the derivative of V M k π k . We give it in Appendix B. We will not apply Lemma A.1 directly the the universes of Theorem 1. Instead, we will define new universes using the following constructions. #Definition A.2 Consider M a catastrophe MDP. We define the catastrophe MDP M D as follows. S F M D : = S F M ⊔ { ⊥ } , S D M D : = S D M , S C M D : = ∅ . A M D = A M For any s , t ∈ S D M : T M D ( t ∣ s ) = T M ( t ∣ s ) T M D ( ⊥ ∣ s ) = T M ( S C M ∣ s ) T M D ( ⊥ ∣ ⊥ ) = 1 For any s ∈ S D M ∪ S F M , t ∈ S F M : T M D ( t ∣ s ) = T M ( t ∣ s ) For any s ∈ S F M : T M D ( ⊥ ∣ s ) = T M ( S C M ∪ S D M ∣ s ) For any s ∈ S D M , R M D ( s ) = 1 2 R M ( s ) . For any s ∈ S F M , R M D ( s ) = 1 . R M D ( ⊥ ) = 0 Now, consider an interface I = ( A , O ) and a υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S . Denote O ′ : = O × { R , I } , O ⋆ : = O × { R , I , ⊥ } and I ⋆ : = ( A , O ⋆ ) . Denote β : O ′ → O the projection mapping and β ∗ : ( A × O ′ ) ∗ → ( A × O ) ∗ corresponding. We define the I ⋆ -universe υ D = ( μ D , r ⋆ ) and the function S ⋆ : ( A × O ⋆ ) ∗ → S M D as follows μ D ( o R ∣ h a ) : = { μ ( o ∣ β ∗ ( h ) a ) if h ∈ ( A × O ′ ) ∗ and S ( β ∗ ( h ) ) , S ( β ∗ ( h ) a o ) ∈ S D M 0 otherwise μ D ( o I ∣ h a ) : = { μ ( o ∣ β ∗ ( h ) a ) if h ∈ ( A × O ′ ) ∗ and S ( β ∗ ( h ) a o ) ∈ S F M 0 otherwise μ D ( o ⊥ ∣ h a ) : = 1 | O | ( 1 − ∑ o ∈ O ( μ D ( o R ∣ h a ) + μ D ( o I ∣ h a ) ) ) r ⋆ ( h ) : = ⎧ ⎪
⎪
⎪
⎪
⎪ ⎨ ⎪
⎪
⎪
⎪
⎪ ⎩ 1 2 r ( λ ) if h = λ 1 2 r ( β ∗ ( h ) ) if h ∈ ( A × O ′ ) ∗ , | h | > 0 and h : | h | − 1 ∈ A O R 1 if h ∈ ( A × O ′ ) ∗ , | h | > 0 and h : | h | − 1 ∈ A O I 0 if h ∉ ( A × O ′ ) ∗ S ⋆ ( h ) : = { S ( β ∗ ( h ) ) if h ∈ ( A × O ′ ) ∗ ⊥ otherwise It is easy to see that υ D is an O ⋆ -realization of M D with state function S ⋆ . #Definition A.3 Consider M a catastrophe MDP. We define the catastrophe MDP M E as follows. S F M E : = S F M ⊔ { ⊥ } , S D M E : = S D M , S C M E : = ∅ . A M E = A M T M E = T M D For any s ∈ S D M ∪ S F M , R M E ( s ) = 1 2 R M ( s ) . R M E ( ⊥ ) = 0 Now, consider an interface I = ( A , O ) and a υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S . We define the I ⋆ -universe υ E = ( μ E , r ⋆ ) as follows μ E ( o R ∣ h a ) : = ⎧ ⎪ ⎨ ⎪ ⎩ μ ( o ∣ β ∗ ( h ) a ) if h ∈ ( A × O ′ ) ∗ and S ( β ∗ ( h ) ) , S ( β ∗ ( h ) a o ) ∈ S D M μ ( o ∣ β ∗ ( h ) a ) if h ∈ ( A × O ′ ) ∗ and S ( β ∗ ( h ) a o ) ∈ S F M 0 otherwise μ E ( o I ∣ h a ) : = 0 μ E ( ⊥ ∣ h a ) : = 1 − ∑ o ∈ O μ E ( o R ∣ h a ) It is easy to see that υ E is an O ⋆ -realization of M E with state function S ⋆ . Given h = a 0 o 0 a 1 o 1 … a n − 1 o n − 1 ∈ ( A × O ) n , we will use the notation R ∗ h : = a 0 o 0 R a 1 o 1 R … a n − 1 o n − 1 R ∈ ( A × O ′ ) n Given an I ⋆ -policy π , the I -policy π R ∗ is defined by π R ∗ ( h ) : = π ( R ∗ h ) . In order to utilize condition iii of Definition 8, we need to establish the following relation between M ♭ and M D , M E . #Proposition A.2 Consider M a catastrophe MDP, some s ∈ S M ∖ S C M and π ∗ a proper mitigation policy. Then A 0 M ♭ π ∗ ( s ) ∩ A ♯ M ( s ) ⊆ A 0 M D π ∗ ( s ) A 0 M ♭ π ∗ ( s ) ∩ A ♯ M ( s ) ⊆ A 0 M E π ∗ ( s ) For the purpose of the proof, the following notation will be convenient #Definition A.4 Consider S a finite set and some . We define by T ∞ : = lim n → ∞ 1 n n − 1 ∑ m = 0 T m As well known, the limit above always exists. #Proof of Proposition A.2 Consider any s ∈ S ∖ S C M and a ∈ A 0 M ♭ π ∗ ( s ) ∩ A ♯ M ( s ) . Since a ∈ A 0 M ♭ π ∗ ( s ) , we have E ( T ∞ M ♭ π ∗ ∘ T M ♭ ) ( s , a ) [ R M ♭ ] = E T M ♭ ( s , a ) [ V 0 M ♭ π ∗ ] = Q 0 M ♭ π ∗ ( s , a ) ≥ V 0 M ♭ π ∗ ( s ) = E T ∞ M ♭ π ∗ ( s ) [ R M ♭ ] Let N be either of M D and M E . Since a ∈ A ♯ M ( s ) , we get E ( T ∞ M ♭ π ∗ ∘ T N ) ( s , a ) [ R M ♭ ] ≥ E T ∞ M ♭ π ∗ ( s ) [ R M ♭ ] Since π ∗ is a mitigation policy, we get E ( T ∞ N π ∗ ∘ T N ) ( s , a ) [ R M ♭ ] ≥ E T ∞ N π ∗ ( s ) [ R M ♭ ] Finally, since π ∗ is proper, supp T ∞ N π ∗ ( s ) ⊆ S F M and supp ( T ∞ N π ∗ ∘ T N ) ( s , a ) ⊆ S F M . We conclude Q 0 N π ∗ ( s , a ) = E ( T ∞ N π ∗ ∘ T N ) ( s , a ) [ R N ] ≥ E T ∞ N π ∗ ( s ) [ R N ] = V 0 N π ∗ ( s ) Now we will establish a bound on the derivative of V by γ in terms of expected mitigation time, in order to demonstrate condition ii of Lemma A.1. #Proposition A.3 Fix ¯ τ , ¯ τ F 1 ∈ ( 0 , ∞ ) . Consider a catastrophe MDP M and a proper mitigation policy with expected mitigation time ¯ τ . Assume than for any s ∈ S F M and γ ∈ ( 0 , 1 ) ∣ ∣ ∣ d V M π ( s , γ ) d γ ∣ ∣ ∣ ≤ ¯ τ F 1 Then, for any s ∈ S M ∖ S C M and γ ∈ [ 0 , 1 ] ∣ ∣ ∣ d V M π ( s , γ ) d γ ∣ ∣ ∣ ≤ 3 ¯ τ 1 + ¯ τ F 1 Note that, since V M π ( s , γ ) is a rational function of γ with no poles on the interval [ 0 , 1 ] , some finite ¯ τ F always exists. Note also that Proposition A.3 is really about Markov chains rather than MDPs, but we don't make it explicit to avoid introducing more notation. #Proof of Proposition A.3 Let μ M π s ∈ Δ S ω M be the Markov chain with transition matrix T M π and initial state s . For any γ ∈ ( 0 , 1 ), we have V M π ( s , γ ) = E x ∼ μ M π s [ ( 1 − γ ) ∞ ∑ n = 0 γ n R M ( x n ) ] Given x ∈ S ω M , we define τ ( x ) ∈ N ⊔ { ∞ } by τ ( x ) = min { n ∈ N ∣ x n ∈ S F M } It is easy to see that V M π ( s , γ ) can be rewritten as V M π ( s , γ ) = E x ∼ μ M π s ⎡ ⎣ ( 1 − γ ) ⎛ ⎝ τ ( x ) − 1 ∑ n = 0 γ n R M ( x n ) + γ τ ( x ) 1 − γ V M π ( x τ ( x ) , γ ) ⎞ ⎠ ⎤ ⎦ The expression above is well defined because π is a proper mitigation policy and therefore τ ( x ) is finite with probability 1. V M π ( s , γ ) = E x ∼ μ M π s ⎡ ⎣ ( 1 − γ ) τ ( x ) − 1 ∑ n = 0 γ n R M ( x n ) + γ τ ( x ) V M π ( x τ ( x ) , γ ) ⎤ ⎦ Let us decompose V M π ( s , γ ) as V D M π ( s , γ ) + V F M π ( s , γ ) defined as follows V D M π ( s , γ ) : = E x ∼ μ M π s ⎡ ⎣ ( 1 − γ ) τ ( x ) − 1 ∑ n = 0 γ n R M ( x n ) ⎤ ⎦ V F M π ( s , γ ) : = E x ∼ μ M π s [ γ τ ( x ) V M π ( x τ ( x ) , γ ) ] We have d V D M π ( s , γ ) d γ = E x ∼ μ M π s ⎡ ⎣ τ ( x ) − 1 ∑ n = 0 ( − γ n + ( 1 − γ ) ⋅ n γ n − 1 ) R M ( x n ) ⎤ ⎦ ∣ ∣
∣ ∣ d V D M π ( s , γ ) d γ ∣ ∣
∣ ∣ ≤ E x ∼ μ M π s ⎡ ⎣ τ ( x ) + ( 1 − γ ) τ ( x ) − 1 ∑ n = 0 n γ n − 1 R M ( x n ) ⎤ ⎦ The second term can be regarded as a weighted average (since 1 − γ = ∑ ∞ n = 0 γ n ), where the maximal term in the average is at most τ ( x ) − 1 , hence ∣ ∣
∣ ∣ d V D M π ( s , γ ) d γ ∣ ∣
∣ ∣ ≤ 2 ¯ τ 1 Also, we have d V F M π ( s , γ ) d γ = E x ∼ μ M π s [ τ ( x ) γ τ ( x ) − 1 V M π ( x τ ( x ) , γ ) + γ τ ( x ) d V M π ( x τ ( x ) , γ ) d γ ] ∣ ∣
∣ ∣ d V F M π ( s , γ ) d γ ∣ ∣
∣ ∣ ≤ E x ∼ μ M π s [ τ ( x ) + ∣ ∣
∣ ∣ d V M π ( x τ ( x ) , γ ) d γ ∣ ∣
∣ ∣ ] = ¯ τ 1 + E x ∼ μ M π s [ ∣ ∣
∣ ∣ d V M π ( x τ ( x ) , γ ) d γ ∣ ∣
∣ ∣ ] ≤ ¯ τ 1 + ¯ τ F 1 ∣ ∣ ∣ d V M π ( s , γ ) d γ ∣ ∣ ∣ ≤ ∣ ∣
∣ ∣ d V D M π ( s , γ ) d γ ∣ ∣
∣ ∣ + ∣ ∣
∣ ∣ d V F M π ( s , γ ) d γ ∣ ∣
∣ ∣ ≤ 3 ¯ τ 1 + ¯ τ F 1 \Comment{ ∣ ∣
∣ ∣ d V F M π ( s , γ ) d γ ∣ ∣ ∣ γ = 1 ∣ ∣
∣ ∣ ≤ ¯ τ 1 + E x ∼ μ M π s [ ∣ ∣ V 1 M π ( x τ ( x ) ) ∣ ∣ ] ≤ ¯ τ 1 + ¯ τ F 1 We conclude ∣ ∣ V 1 M π ( s ) ∣ ∣ ≤ ∣ ∣
∣ ∣ d V D M π ( s , γ ) d γ ∣ ∣ ∣ γ = 1 ∣ ∣
∣ ∣ + ∣ ∣
∣ ∣ d V F M π ( s , γ ) d γ ∣ ∣ ∣ γ = 1 ∣ ∣
∣ ∣ ≤ 3 ¯ τ 1 + ¯ τ F 1 } To transform the relative regret bounds for "auxiliary" universes obtained from Lemma A.1 to regret bounds for the original universes, we will need the following. #Definition A.5 Fix δ ∈ ( 0 , 1 ) and a universe υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S . Let ~ M be a δ -perturbation of M . An environment ~ μ is said to be a δ -lift of ~ M to μ when i. ( ~ μ , r ) is an O -realization of ~ M with state function S . ii. hdom ~ μ ⊆ hdom μ iii. For any h ∈ hdom ~ μ and a ∈ A , if S ( h ) ∈ S M ∖ S D M then μ ( h a ) = ~ μ ( h a ) . iv. For any h ∈ hdom ~ μ and a ∈ A , if S ( h ) ∈ S D M then there exists ζ ∈ Δ O s.t. μ ( h a ) = ( 1 − δ ) ~ μ ( h a ) + δ ζ It is easy to see that such a lift always exists, for example we can take: ~ μ ( o ∣ h a ) : = T ~ M ( S ( h a o ) ∣ S ( h ) , a ) T M ( S ( h a o ) ∣ S ( h ) , a ) μ ( o ∣ h a ) #Proposition A.4 Consider γ , δ ∈ ( 0 , 1 ) s.t δ ≥ 1 − γ and ¯ τ ∈ ( 0 , ∞ ) . Let υ = ( μ , r ) be a universe which is an O -realization of a catastrophe MDP M with state function S . Suppose that π ∗ is a mitigation policy for M that has expected mitigation time ¯ τ . Consider some I ⋆ -policy π . Suppose that ~ M is a δ -perturbation of M and ~ μ is a δ -lift of ~ M to μ . Denote ~ υ : = ( ~ μ , r ) . Then, there is some C ∈ ( 0 , ∞ ) that depends on nothing s.t 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ ~ υ E ( γ ) − EU π ~ υ E ( γ ) + C δ ⎛ ⎜
⎜ ⎝ ¯ τ + max ( EU π ∗ S ⋆ ~ υ D ( γ ) − EU π ~ υ D ( γ ) , 0 ) 1 − γ ⎞ ⎟
⎟ ⎠ In order to prove Proposition A.4, we need a relative regret bound for M derived from a relative regret bound for M E . #Proposition A.5 Fix an interface I and an I -universe υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S s.t. S ( λ ) ∉ S C M . Suppose that π ∗ is a mitigation policy for M . Let π be any I ⋆ -policy. Then, for any γ ∈ ( 0 , 1 ) 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ υ E ( γ ) − EU π υ E ( γ ) #Proof of Proposition A.5 π ∗ is a mitigation policy, therefore for any s ∈ S M ∖ S C M , T M E π ∗ ( s ) = T M π ∗ ( s ) . It follows that EU π ∗ S ⋆ υ E ( γ ) = 1 2 EU π ∗ S υ ( γ ) Also, it is easy to see from the definition of T M E and r ⋆ that EU π υ E ( γ ) ≤ 1 2 EU π R ∗ υ ( γ ) Indeed, any discrepancy between the behavior of M E and M involves transition to the state ⊥ which yields 0 reward forever. Subtracting these inequalities, we get the desired result. Another observation we need to prove Proposition A.4 is a bound on the effect of δ -perturbations in terms of mitigation time. #Proposition A.6 Consider γ , δ ∈ ( 0 , 1 ) , a universe υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S , and some . Assume that for any h ∈ S − 1 ( S F M ) and a ∈ supp π ( h ) , T M ( S F M ∣ s , a ) = 1 . Let ~ M be a δ -perturbation of M and ~ μ a δ -lift of ~ M to μ . Then, d tv ( μ ⋈ π , ~ μ ⋈ π ) ≤ 2 ( 1 − E x ∼ ~ μ ⋈ π [ ( 1 − δ ) τ S ( x ) ] ) #Proof of Proposition A.6 It is straightforward to construct a probability space ( Ω , P ) , X : Ω → ( A × O ) ω measurable and { C n ⊆ Ω } n ∈ N measurable s.t. i. h ∗ ( P ) = μ ⋈ π ii. For any n ∈ N and h ∈ ( A × O ) n s.t. S ( h ) ∈ S D M : Pr [ C n ∣ X : n = h ] = δ iii. For any n ∈ N and h ∈ ( A × O ) n s.t. S ( h ) ∈ S M ∖ S D M : Pr [ C n ∣ X : n = h ] = 0 iv. For any n ∈ N , h ∈ ( A × O ) n and h ′ ∈ ( A × O ) n + 1 : Pr [ X : n + 1 = h ′ ∣ X : n = h and not C n ] = Pr x ∼ ~ μ ⋈ π [ x : n + 1 = h ′ ∣ x : n = h ] Denote D : = ∩ ∞ n = 0 Ω ∖ C n . We have P ( D ) = E x ∼ ~ μ ⋈ π [ ( 1 − δ ) τ S ( x ) ] d tv ( P , P ∣ D ) ≤ 1 − P ( D ) d tv ( μ ⋈ π , h ∗ ( P ∣ D ) ) ≤ 1 − P ( D ) Also, it is easy to see that for any A ⊆ ( A × O ) ω measurable h ∗ ( P ∣ D ) ( A ) = E x ∼ ~ μ ⋈ π [ ( 1 − δ ) τ S ( x ) χ A ] P ( D ) It follows that d tv ( h ∗ ( P ∣ D ) , ~ μ ⋈ π ) = 1 2 E x ∼ ~ μ ⋈ π [ ∣ ∣
∣ ∣ ( 1 − δ ) τ S ( x ) P ( D ) − 1 ∣ ∣
∣ ∣ ] d tv ( h ∗ ( P ∣ D ) , ~ μ ⋈ π ) = 1 2 P ( D ) E x ∼ ~ μ ⋈ π [ ∣ ∣ ( 1 − δ ) τ S ( x ) − P ( D ) ∣ ∣ ] Using the fact that ( 1 − δ ) τ S ( x ) ∈ [ 0 , 1 ] and the convexity of the function | t − P ( D ) | d tv ( h ∗ ( P ∣ D ) , ~ μ ⋈ π ) ≤ 1 2 P ( D ) E x ∼ ~ μ ⋈ π [ ( 1 − 2 δ ) τ S ( x ) ( 1 − P ( D ) ) + ( 1 − ( 1 − δ ) τ S ( x ) ) P ( D ) ] d tv ( h ∗ ( P ∣ D ) , ~ μ ⋈ π ) ≤ 1 2 P ( D ) ( P ( D ) ( 1 − P ( D ) ) + ( 1 − P ( D ) ) P ( D ) ) = 1 − P ( D ) Using the triangle inequality, we conclude d tv ( μ ⋈ π , ~ μ ⋈ π ) ≤ d tv ( μ ⋈ π , h ∗ ( P ∣ D ) ) + d tv ( h ∗ ( P ∣ D ) , ~ μ ⋈ π ) = 2 ( 1 − E x ∼ ~ μ ⋈ π [ ( 1 − δ ) τ S ( x ) ] ) As a final ingredient towards the proof of Proposition A.4, we will need to use the relative regret bound for M D to get a certain statistical bound on mitigation time. #Definition A.6 Let μ be any environment. We define the closed set hdom ω μ ⊆ ( A × O ) ω by hdom ω μ : = { x ∈ ( A × O ) ω ∣ ∀ n ∈ N : x : n ∈ hdom μ } Consider a universe υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S . We define the measurable function τ S : hdom ω μ → N ⊔ { ∞ } as follows τ S ( x ) : = min { n ∈ N ∣ S ( x : n ) ∈ S F M } #Proposition A.7 Fix an interface I and an I -universe υ = ( μ , r ) which is an O -realization of a catastrophe MDP M with state function S s.t. S ( λ ) ∈ S D M . Suppose that π ∗ is a mitigation policy for M that has the expected mitigation time ¯ τ ∈ ( 0 , ∞ ) . Let π be any I ⋆ -policy. Then, there is C ∈ ( 0 , ∞ ) that depends on nothing s.t. for any γ , δ ∈ ( 0 , 1 ) , if δ ≥ 1 − γ then E μ D ⋈ π [ ( 1 − δ ) τ S ⋆ ] ≥ 1 − C δ ⎛ ⎜
⎜ ⎝ ¯ τ + max ( EU π ∗ S ⋆ υ D ( γ ) − EU π υ D ( γ ) , 0 ) 1 − γ ⎞ ⎟
⎟ ⎠ #Proof of Proposition A.7 For any x ∈ hdom μ D , we have U r ⋆ γ ( x ) ≤ ( 1 − γ ) ⎛ ⎝ 1 2 τ S ⋆ ( x ) − 1 ∑ n = 0 γ n + ∞ ∑ n = τ S ⋆ ( x ) γ n ⎞ ⎠ = ( 1 − γ ) ( 1 2 ⋅ 1 − γ τ S ⋆ ( x ) 1 − γ + γ τ S ⋆ ( x ) 1 − γ ) = 1 2 + 1 2 γ τ S ⋆ ( x ) It follows that EU π υ D ( γ ) ≤ 1 2 + 1 2 E = μ D ⋈ π [ γ τ S ⋆ ] If x ∈ hdom ω μ D is s.t. for all n ∈ N , S ⋆ ( x : n ) ≠ ⊥ , then U r ⋆ γ ( x ) ≥ ( 1 − γ ) ∞ ∑ n = τ S ⋆ ( x ) γ n = γ τ S ⋆ ( x ) Since π ∗ is a mitigation policy, it follows that EU π ∗ S ⋆ υ D ( γ ) ≥ E μ D ⋈ π ∗ S ⋆ [ γ τ S ⋆ ] ≥ γ ¯ τ Subtracting the two inequalities, we get EU π ∗ S ⋆ υ D ( γ ) − EU π υ D ( γ ) ≥ γ ¯ τ − 1 2 − 1 2 E μ D ⋈ π [ γ τ S ⋆ ] E μ D ⋈ π [ γ τ S ⋆ ] ≥ 2 γ ¯ τ − 2 ( EU π ∗ S ⋆ υ D ( γ ) − EU π υ D ( γ ) ) − 1 Denote ρ : = max ( EU π ∗ S ⋆ υ D ( γ ) − EU π υ D ( γ ) , 0 ) .  By choosing C sufficiently large, we can assume without loss of generality that the right hand side is positive since, unless γ ¯ τ ≈ 1 , we would have C δ ¯ τ ≥ C ( 1 − γ ) ¯ τ > 1 , and unless ρ ≪ 1 , we would have C δ ρ 1 − γ ≥ C ρ > 1 . In either case, the inequality we are trying to prove would hold. Also, note that ln ( 1 − δ ) ln γ ≥ 1 . We get E μ D ⋈ π [ ( 1 − δ ) τ S ⋆ ] = E μ D ⋈ π [ γ τ S ⋆ ln ( 1 − δ ) ln γ ] ≥ E μ D ⋈ π [ γ τ S ⋆ ] ln ( 1 − δ ) ln γ ≥ ( 2 γ ¯ τ − 2 ρ − 1 ) ln ( 1 − δ ) ln γ = ( 1 − δ ) ln ( 2 γ ¯ τ − 2 ρ − 1 ) ln γ By the same reasoning as before, we can assume without loss of generality that e.g. γ ¯ τ ≤ 1 − 1 2 ( 1 − γ ) ¯ τ . It follows that 2 γ ¯ τ − 2 ρ − 1 ≤ 2 − ( 1 − γ ) ¯ τ − 2 ρ − 1 = 1 − ( 1 − γ ) ¯ τ − 2 ρ ≤ 1 − ( 1 − γ ) = γ ln ( 2 γ ¯ τ − 2 ρ − 1 ) ln γ ≥ 1 Combining this with the previous inequality implies E μ D ⋈ π [ ( 1 − δ ) τ S ⋆ ] ≥ 1 − δ ln ( 2 γ ¯ τ − 2 ρ − 1 ) ln γ It is easy to see that there is x 0 ∈ ( 0 , 1 ) s.t. for any x ∈ [ x 0 , 1 ] , 2 x − 1 ≥ x 3 and therefore 2 x − 1 x 3 ≥ 1 . Therefore, for any such x and ρ ≪ 1 , e − C ρ ≤ 2 x − 1 x 3 − 2 ρ x 3 0 ≤ 2 x − 2 ρ − 1 x 3 , where it is sufficient to assume that C > 2 x 3 0 . Taking x = γ ¯ τ , we conclude (assuming C ≥ 3 and observing that γ 1 1 − γ ≤ e − 1 ) γ C ρ 1 − γ ≤ e − C ρ ≤ 2 γ ¯ τ − 2 ρ − 1 γ 3 ¯ τ ≤ 2 γ ¯ τ − 2 ρ − 1 γ C ¯ τ γ C ( ¯ τ + ρ 1 − γ ) ≤ 2 γ ¯ τ − 2 ρ − 1 Taking logarithm of both sides C ( ¯ τ + ρ 1 − γ ) ln γ ≤ ln ( 2 γ ¯ τ − 2 ρ − 1 ) C ( ¯ τ + ρ 1 − γ ) ≥ ln ( 2 γ ¯ τ − 2 ρ − 1 ) ln γ Combining with the inequality we had before, we get E μ D ⋈ π [ ( 1 − δ ) τ S ⋆ ] ≥ 1 − C δ ( ¯ τ + ρ 1 − γ ) #Proof of Proposition A.4 By Proposition A.5, we have 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ υ E ( γ ) − EU π υ E ( γ ) Note that ~ M E is a δ -perturbation of M E and ~ μ E is a δ -lift of ~ M E to μ E . The condition of Proposition A.6 holds tautologically due to Definition A.3. Therefore, we can apply Proposition A.6 and get 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ ~ υ E ( γ ) − EU π ~ υ E ( γ ) + 2 ( 2 − E ~ μ E ⋈ π ∗ S ⋆ [ ( 1 − δ ) τ S ⋆ ] − E ~ μ E ⋈ π [ ( 1 − δ ) τ S ⋆ ] ) The only difference between ~ μ E and ~ μ D is the appearance of R instead of I . Therefore, we can rewrite the above as 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ ~ υ E ( γ ) − EU π ~ υ E ( γ ) + 2 ( 2 − E ~ μ D ⋈ π ∗ S ⋆ [ ( 1 − δ ) τ S ⋆ ] − E ~ μ D ⋈ π [ ( 1 − δ ) τ S ⋆ ] ) Applying Proposition A.7 to each of the last two terms, we get 1 2 ( EU π ∗ S υ ( γ ) − EU π R ∗ υ ( γ ) ) ≤ EU π ∗ S ⋆ ~ υ E ( γ ) − EU π ~ υ E ( γ ) + 4 C δ ⎛ ⎜
⎜ ⎝ 2 ¯ τ + max ( EU π ∗ S ⋆ ~ υ D ( γ ) − EU π ~ υ D ( γ ) , 0 ) 1 − γ ⎞ ⎟
⎟ ⎠ The following definition will be useful in order to apply Proposition A.4. #Definition A.7 Consider M a catastrophe MDP s.t. A M = A and a policy . We then define the catastrophe MDP M [ σ ] as follows: S F M [ σ ] : = S F M , S D M [ σ ] : = S D M , S C M [ σ ] : = S C M . A M [ σ ] : = ¯ A For any s ∈ S M and a ∈ A : T M [ σ ] ( s , a ) : = T M ( s , a ) . For any s ∈ S M : T M [ σ ] ( s , ⊥ ) : = T M σ ( s ) . R M [ σ ] : = R M Now consider υ an O -realization of M with state function S . Then, ¯ υ [ σ S ] is clearly an ¯ O -realization of M [ σ ] with the state function ¯ S defined by ¯ S ( h ) : = S ( h – – ) . Note also that M [ σ ] D ≅ M D [ σ ] and M [ σ ] E ≅ M E [ σ ] (where interpreting σ as a policy for M D or M E requires choosing an arbitrary value for the state ⊥ ). Moreover, ¯ I ⋆ ≅ ¯ ¯¯¯¯ ¯ I ⋆ , ¯ υ [ σ S ] D = ¯ ¯¯¯¯ ¯ υ D [ σ S ⋆ ] , ¯ υ [ σ S ] E = ¯ ¯¯¯¯ ¯ υ E [ σ S ⋆ ] and ¯ S ⋆ = ¯ ¯¯¯¯ ¯ S ⋆ . Finally, we are read to prove the main theorem. #Proof of Theorem 1 For every k ∈ [ N ] , denote ~ M k and ~ σ k the δ -perturbations of M k and σ k respectively and π k the deterministic proper mitigation policy for ~ M k of Definition 8. Let ~ μ k be a lift of ~ M k to μ k and denote ~ υ k : = ( ~ μ k , r k ) . Define H : = { ~ υ k D , ~ υ k E } k ∈ [ N ] . Observe that ~ σ k is ϵ -sane relatively to π k in the sense of ~ M k D and ~ M k E both: condition i of Definition A.1 follows by Proposition A.2 from conditions ii and iii of Definition 8, and condition ii of Definition A.1 follows from condition iv of Definition 8. Moreover, by Proposition A.3, we have ∣ ∣
∣ ∣ d V ~ M D π k ( s , γ ) d γ ∣ ∣
∣ ∣ = O ( ¯ τ ) ∣ ∣
∣ ∣ d V ~ M E π k ( s , γ ) d γ ∣ ∣
∣ ∣ = O ( ¯ τ ) Here, we used that M F k is fixed (and thus so is ¯ τ F , by conditions i-iii). Condition iv implies that all the universes in H have a common reward function (notice that transition to a corrupted state induces the observation ⊥ whereas transition to a state in S F M in the universe ~ υ k D induces the observation I ). Therefore, we can use Lemma A.1 to conclude that there exists an ¯ ¯¯¯¯ ¯ I ⋆ -policy π ♯ s.t. EU π k S k ⋆ ~ υ k D ( 1 − α ) − EU π ♯ ¯ ¯¯¯¯¯¯ ¯ ~ υ k D [ ~ σ k S k ⋆ ] ( 1 − α ) ≤ O ( ( ¯ τ α ) 1 / 4 ) EU π k S k ⋆ ~ υ k E ( 1 − α ) − EU π ♯ ¯ ¯¯¯¯¯ ¯ ~ υ k E [ ~ σ k S k ⋆ ] ( 1 − α ) ≤ O ( ( ¯ τ α ) 1 / 4 ) It is easy to see that ~ M k [ ~ σ k ] is a 2 δ -perturbation of M k [ σ k ] . Observe also that ¯ ¯¯¯¯¯¯ ¯ ~ υ k D [ ~ σ k S k ⋆ ] = ¯ ¯¯¯ ¯ ~ υ k [ ~ σ k S k ] D , ¯ ¯¯¯¯¯¯ ¯ ~ υ k E [ ~ σ k S k ⋆ ] = ¯ ¯¯¯ ¯ ~ υ k [ ~ σ k S k ] E and ¯ ¯¯¯¯ ¯ ~ μ k [ ~ σ k S k ] is a 2 δ -lift of ~ M k [ ~ σ k ] to ¯ ¯¯¯¯ ¯ μ k [ σ k S k ] . Applying Proposition A.4, we get 1 2 ( EU π k S k υ k ( 1 − α ) − EU π ♯ R ∗ ¯ υ k [ σ k S k ] ( 1 − α ) ) ≤ O ( ( ¯ τ α ) 1 / 4 + δ ( ¯ τ + ( ¯ τ α ) 1 / 4 α ) ) \Comment{Given h = a 0 b 0 o 0 a 1 b 1 o 1 … a n − 1 b n − 1 o n − 1 ∈ ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O n , we use the notation ¯ R ∗ h : = a 0 b 0 o 0 R a 1 b 1 o 1 R … a n − 1 b n − 1 o n − 1 R ∈ ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O ′ n We define π ∗ as by π ∗ ( h ) : = π ⋆ ( ¯ R ∗ h ) .} Setting π ∗ : = π ♯ R ∗ we get EU π k S k υ k ( 1 − α ) − EU π ∗ ¯ υ k [ σ k S k ] ( 1 − α ) ≤ O ( max ( δ α , 1 ) ⋅ ( ¯ τ α ) 1 / 4 + ¯ τ δ ) By condition i of Definition 8, this implies EU ∗ υ k ( 1 − α ) − EU π ∗ ¯ υ k [ σ k S k ] ( 1 − α ) ≤ O ( max ( δ α , 1 ) ⋅ ( ¯ τ α ) 1 / 4 + ¯ τ δ ) ##Appendix B Given p = ( a , o ) ∈ A × O , we denote p A : = a , p O : = o . #Proposition B.1 Consider a universe υ = ( μ , r ) which an O -realization of an MDP M with state function S , a stationary policy , an arbitrary I -policy π 0 and some γ ∈ ( 0 , 1 ) . Then, EU π ∗ S υ ( γ ) − EU π 0 υ ( γ ) = ∞ ∑ n = 0 γ n E x ∼ μ ⋈ π 0 [ V M π ∗ ( S ( x : n ) , γ ) − Q M π ∗ ( S ( x : n ) , x A n , γ ) ] #Proof of Proposition B.1 For the sake of encumbering the notation less, we will omit the parameter γ in functions that depend on it. We will use S implicitly, i.e. given F a function on S M and h ∈ hdom μ , F ( h ) : = F ( S ( h ) ) . Finally, we will omit M π ∗ , using the shorthand notations V : = V M π ∗ , Q : = Q M π ∗ . For any x ∈ hdom ω μ , it is easy to see that EU π ∗ S υ = V ( λ ) = ∞ ∑ n = 0 γ n ( V ( x : n ) − γ V ( x : n + 1 ) ) U r ( x ) = ( 1 − γ ) ∞ ∑ n = 0 γ n r ( x : n ) EU π ∗ S υ − U r ( x ) = ∞ ∑ n = 0 γ n ( V ( x : n ) − ( 1 − γ ) r ( x : n ) − γ V ( x : n + 1 ) ) EU π ∗ S υ − U r ( x ) = ∞ ∑ n = 0 γ n ( V ( x : n ) − Q ( x : n , x A n ) + Q ( x : n , x A n ) − ( 1 − γ ) r ( x : n ) − γ V ( x : n + 1 ) ) Taking expected value over x , we get EU π ∗ S υ − EU π 0 υ = ∞ ∑ n = 0 γ n ( E μ ⋈ π 0 [ V ( x : n ) − Q ( x : n , x A n ) ] + E μ ⋈ π 0 [ Q ( x : n , x A n ) − ( 1 − γ ) r ( x : n ) − γ V ( x : n + 1 ) ] ) It is easy to see that the second term vanishes, yielding the desired result. #Proposition B.2 Consider some τ ∈ ( 0 , ∞ ) , T ∈ N + , a universe υ = ( μ , r ) that is an O -realization of M with state function S , a stationary policy and an arbitrary I -policy . For any n ∈ N , let π ∗ n be an I -policy s.t. for any h ∈ hdom μ π ∗ n ( h ) : = { π 0 ( h ) if | h | < n T π ∗ ( h ) otherwise Assume that i. For any h ∈ hdom μ supp π 0 ( h ) ⊆ A 0 M π ∗ ( S ( h ) ) ii. For any s ∈ S M and γ ∈ ( 0 , 1 ) ∣ ∣ ∣ d V M π ∗ ( s , γ ) d γ ∣ ∣ ∣ ≤ τ Then, for any γ ∈ ( 0 , 1 ) , EU π ∗ υ ( γ ) − EU π 0 υ ( γ ) ≤ ( 1 − γ ) ∞ ∑ n = 0 T − 1 ∑ m = 0 γ n T + m ( E x ∼ μ ⋈ π ∗ n [ r ( x : n T + m ) ] − E x ∼ μ ⋈ π 0 [ r ( x : n T + m ) ] ) + 2 τ γ T ( 1 − γ ) 1 − γ T #Proof of Proposition B.2 For the sake of encumbering the notation less, we will use S implicitly, i.e. given F a function on S M and h ∈ hdom μ , F ( h ) : = F ( S ( h ) ) . Also, we will omit M π ∗ , using the shorthand notations V : = V M π ∗ , Q : = Q M π ∗ . By Proposition B.1, for any l ∈ N EU π ∗ υ ( γ ) − EU π ∗ l υ ( γ ) = ∞ ∑ n = 0 γ n E x ∼ μ ⋈ π ∗ l [ V ( x : n , γ ) − Q ( x : n , x A n , γ ) ] π ∗ l coincides with π ∗ after l T , therefore the corresponding expected values vanish. EU π ∗ υ ( γ ) − EU π ∗ l υ ( γ ) = l T − 1 ∑ n = 0 γ n E x ∼ μ ⋈ π 0 [ V ( x : n , γ ) − Q ( x : n , x A n , γ ) ] Subtracting the equalities for l + 1 and l , we get EU π ∗ l υ ( γ ) − EU π ∗ l + 1 υ ( γ ) = ( l + 1 ) T − 1 ∑ n = l T γ n E x ∼ μ ⋈ π 0 [ V ( x : n , γ ) − Q ( x : n , x A n , γ ) ] ( 1 − γ ) ∞ ∑ n = 0 γ n ( E x ∼ μ ⋈ π ∗ l [ r ( x : n ) ] − E x ∼ μ ⋈ π ∗ l + 1 [ r ( x : n ) ] ) = ( l + 1 ) T − 1 ∑ n = l T γ n E x ∼ μ ⋈ π 0 [ V ( x : n , γ ) − Q ( x : n , x A n , γ ) ] π ∗ l and π ∗ l + 1 coincide until l T , therefore ( 1 − γ ) ∞ ∑ n = l T γ n ( E x ∼ μ ⋈ π ∗ l [ r ( x : n ) ] − E x ∼ μ ⋈ π ∗ l + 1 [ r ( x : n ) ] ) = ( l + 1 ) T − 1 ∑ n = l T γ n E x ∼ μ ⋈ π 0 [ V ( x : n , γ ) − Q ( x : n , x A n , γ ) ] Denote ρ ∗ l : = μ ⋈ π ∗ l , ρ 0 : = μ ⋈ π 0 . We also use the shorthand notations r n : = r ( x : n ) , V n ( γ ) : = V ( x : n , γ ) , Q n ( γ ) : = Q ( x : n , x A n , γ ) . Both π ∗ l and π ∗ l + 1 coincide with π ∗ after ( l + 1 ) T , therefore ( 1 − γ ) ( l + 1 ) T − 1 ∑ n = l T γ n ( E ρ ∗ l [ r n ] − E ρ 0 [ r n ] ) + γ ( l + 1 ) T ( E ρ ∗ l [ V ( l + 1 ) T ( γ ) ] − E ρ 0 [ V ( l + 1 ) T ( γ ) ] ) = ( l + 1 ) T − 1 ∑ n = l T γ n E ρ 0 [ V n ( γ ) − Q n ( γ ) ] Denote V ′ ( s , γ ) : = d V ( s , γ ) d γ . By the mean value theorem, for each s ∈ S M there is γ ∗ ∈ ( γ , 1 ) s.t. V ( s , γ ) = V 0 ( s ) − V ′ ( s , γ ∗ ) ⋅ ( 1 − γ ) V 0 ( s ) − τ ( 1 − γ ) ≤ V ( s , γ ) ≤ V 0 ( s ) + τ ( 1 − γ ) It follows that ( 1 − γ ) ( l + 1 ) T − 1 ∑ n = l T γ n E ρ ∗ l − ρ 0 [ r n ] + γ ( l + 1 ) T ( E ρ ∗ l − ρ 0 [ V 0 ( l + 1 ) T ] + 2 τ ( 1 − γ ) ) ≥ ( l + 1 ) T − 1 ∑ n = l T γ n E ρ 0 [ V n ( γ ) − Q n ( γ ) ] Here, an expected value w.r.t. the difference of two probability measures is understood to mean the corresponding difference of expected values. It is easy to see that assumption i implies that V 0 n is a submartingale for ρ 0 (whereas it is a martingale for μ ⋈ π ∗ ) and therefore E ρ ∗ l − ρ 0 [ V 0 ( l + 1 ) T ] ≤ 0 We get ( 1 − γ ) ( l + 1 ) T − 1 ∑ n = l T γ n E ρ ∗ l − ρ 0 [ r n ] + 2 τ γ ( l + 1 ) T ( 1 − γ ) ≥ ( l + 1 ) T − 1 ∑ n = l T γ n E ρ 0 [ V n ( γ ) − Q n ( γ ) ] Summing over l , we get ( 1 − γ ) ∞ ∑ l = 0 ( l + 1 ) T − 1 ∑ n = l T γ n E ρ ∗ l − ρ 0 [ r n ] + 2 τ γ T ( 1 − γ ) 1 − γ T ≥ ∞ ∑ n = 0 γ n E ρ 0 [ V n ( γ ) − Q n ( γ ) ] Applying Proposition B.1 to the right hand side ( 1 − γ ) ∞ ∑ l = 0 ( l + 1 ) T − 1 ∑ n = l T γ n E ρ ∗ l − ρ 0 [ r n ] + 2 τ γ T ( 1 − γ ) 1 − γ T ≥ EU π ∗ υ ( γ ) − EU π 0 υ ( γ ) #Proof of Lemma A.1 Fix γ ∈ ( 0 , 1 ) , η ∈ ( 0 , N − 1 ) and T ∈ N + . Denote ν k : = ¯ μ k [ σ k S k ] . To avoid cumbersome notation, whenever M k should appear a subscript, we will replace it by k . Let ( Ω , P ∈ Δ Ω ) be a probability space\Comment{ and { F n ⊆ 2 Ω } n ∈ N ⊔ { − 1 } a filtration of Ω }. Let K : Ω → [ N ] be \Comment{measurable w.r.t. F − 1 }a random variable and the following be stochastic processes\Comment{ adapted to F } Z n , ~ Z n : Ω → Δ [ N ] J n : Ω → [ N ] Ψ n : Ω → A A n : Ω → ¯ A Θ n : Ω → ¯ O We also define A Θ : n : Ω → ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O ∗ by A Θ : n : = A 0 Θ 0 A 1 Θ 1 … A n − 1 Θ n − 1 (The following conditions on A and Θ imply that the range of the above is indeed in ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O ∗ .) Let D and D ! k be as in Proposition C.1 (we assume w.l.o.g. that ϵ < 1 | A | ). We construct Ω \Comment{, F }, K , Z , ~ Z , J , Ψ , A and Θ s.t K is uniformly distributed and for any k ∈ [ N ] , l ∈ N , m ∈ [ T ] and o ∈ O , denoting n = l T + m ~ Z 0 ( k ) ≡ 1 N Z n ( k ) = ~ Z n ( k ) [ [ ~ Z n ( k ) ≥ η ] ] ∑ N − 1 j = 0 ~ Z n ( j ) [ [ ~ Z n ( j ) ≥ η ] ] Pr [ J l = k ∣ Z l T ] = Z l T ( k ) Ψ n = π J l ( A Θ : n ) Pr [ Θ n = o ∣ A Θ : n ] = ν K ( o ∣ A Θ : n ) A n = D ( A Θ : n , Ψ n ) ~ Z n + 1 ( k ) N − 1 ∑ j = 0 Z n ( j ) [ [ A n = D ! j ( A Θ : n , Ψ n ) ] ] ν j ( Θ n ∣ A Θ : n A n ) = Z n ( k ) [ [ A n = D ! k ( A Θ : n , Ψ n ) ] ] ν k ( Θ n ∣ A Θ : n A n ) Note that the last equation has the form of a Bayesian update which is allowed to be arbitrary when update is on "impossible" information. We now construct the ¯ I -policy π ∗ s.t. for any n ∈ N , h ∈ ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O ∗ s.t. Pr [ A Θ : n = h ] > 0 and a ∈ ¯ A π ∗ ( a ∣ h ) : = Pr [ A n = a ∣ A Θ : n = h ] That is, we perform Thompson sampling at time intervals of size T , moderated by the delegation routine D , and discard from our belief state hypotheses whose probability is below η and hypotheses sampling which resulted in recommending "unsafe" actions i.e. actions that D refused to perform. In order to prove π ∗ has the desired property, we will define the stochastic processes Z ! , ~ Z ! , J ! , Ψ ! , A ! and Θ ! , each process of the same type as its shriekless counterpart (thus Ω is constructed to accommodate them). These processes are required to satisfy the following: ~ Z ! 0 ( k ) ≡ 1 N Z ! n ( k ) = ~ Z ! n ( k ) [ [ ~ Z ! n ( k ) ≥ η ] ] ∑ N − 1 j = 0 ~ Z ! n ( j ) [ [ ~ Z ! n ( j ) ≥ η ] ] [ [ ~ Z ! n ( K ) ≥ η ] ] + [ [ K = k ] ] ⋅ [ [ ~ Z ! n ( K ) < η ] ] Pr [ J ! l = k ∣ Z ! l T ] = Z ! l T ( k ) Ψ ! n = π J ! l ( A Θ ! : n ) Pr [ Θ ! n = o ∣ A Θ ! : n ] = ν K ( o ∣ A Θ ! : n ) A ! n = D ! K ( A Θ ! : n , Ψ ! n ) ~ Z ! n + 1 ( k ) = Z ! n ( k ) [ [ A ! n = D ! k ( A Θ ! : n , Ψ ! n ) ] ] ν k ( Θ ! n ∣ A Θ ! : n A ! n ) ∑ N − 1 j = 0 Z ! n ( j ) [ [ A ! n = D ! j ( A Θ ! : n , Ψ ! n ) ] ] ν j ( Θ ! n ∣ A Θ ! : n A ! n ) For any k ∈ [ N ] , we construct the ¯ I -policy π ? k s.t. for any n ∈ N , h ∈ ¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯ A × O ∗ s.t. Pr [ A Θ ! : n = h , K = k ] > 0 and a ∈ ¯ A π ? k ( a ∣ h ) : = Pr [ A ! n = a ∣ A Θ ! : n = h , K = k ] Given any ¯ I -policy π and I -policy σ we define by α σ π ( g ∣ h ) : = [ [ h = g – ] ] C h | h | − 1 ∏ n = 0 ∑ a ∈ A ( [ [ g n ∈ ⊥ a O ] ] π ( ⊥ ∣ g : n ) σ ( a ∣ h : n ) + [ [ g n ∈ a ⊥ O ] ] π ( a ∣ g : n ) ) Here, C h ∈ R is a constant defined s.t. the probabilities sum to 1. We define the I -policy [ σ ] π – – by [ σ ] π – – ( a ∣ h ) : = Pr g ∼ α σ π ( h ) [ π ( g ) = a ∨ ( π ( g ) = ⊥ ∧ σ ( h ) = a ) ] Condition iii of Proposition C.1 and condition i of Definition A.1 imply that for any h ∈ hdom μ k supp [ σ k ] π – – ? k ( h ) ⊆ A 0 M k π k ( S k ( h ) ) This means we can apply Proposition B.2 and get EU π k S k υ k ( γ ) − EU π ? k ¯ υ k [ σ k S k ] ( γ ) ≤ ( 1 − γ ) ∞ ∑ n = 0 T − 1 ∑ m = 0 γ n T + m ( E x ∼ μ k ⋈ π ∗ k n [ r ( x : n T + m ) ] − E x ∼ ν k ⋈ π ? k [ r ( x – – : n T + m ) ] ) + 2 ¯ τ γ T ( 1 − γ ) 1 − γ T Here, the I -policy π ∗ k n is defined as π ∗ n in Proposition B.2. We also define the ¯ I -policies π ! k n and π ! ! k n by π ! k n ( a ∣ h ) : = { π ? k ( a ∣ h ) if | h | < n T Pr [ A ! | h | = a ∣ A Θ ! : | h | = h , K = k , J ! n = k ] otherwise π ! ! k n ( a ∣ h ) : = ⎧ ⎪ ⎨ ⎪ ⎩ π ? k ( a ∣ h ) if | h | < n T π ! k n ( a ∣ h ) + π ! k n ( ⊥ ∣ h ) ⋅ π ∗ k n ( a ∣ h – – ) if | h | ≥ n T and a ≠ ⊥ 0 if | h | ≥ n T and a = ⊥ Denote ρ ∗ k n : = μ k ⋈ π ∗ k n ρ ! ! k n : = ν k ⋈ π ! ! k n ρ ! k n : = ν k ⋈ π ! k n ρ ? k : = ν k ⋈ π ? k R ? k : = EU π k S k υ k ( γ ) − EU π ? k ¯ υ k [ σ k S k ] ( γ ) For each n ∈ N , denote EU ∗ k n ( γ ) : = 1 − γ 1 − γ T T − 1 ∑ m = 0 γ m E x ∼ ρ ∗ k n [ r ( x : n T + m ) ] EU ! ! k n ( γ ) : = 1 − γ 1 − γ T T − 1 ∑ m = 0 γ m E x ∼ ρ ! ! k n [ r ( x – – : n T + m ) ] EU ! k n ( γ ) : = 1 − γ 1 − γ T T − 1 ∑ m = 0 γ m E x ∼ ρ ! k n [ r ( x – – : n T + m ) ] EU ? k n ( γ ) : = 1 − γ 1 − γ T T − 1 ∑ m = 0 γ m E x ∼ ρ ? k [ r ( x – – : n T + m ) ] We have R ? k ≤ ( 1 − γ T ) ∞ ∑ n = 0 γ n T ( EU ∗ k n ( γ ) − EU ? k n ( γ ) ) + 2 ¯ τ γ T ( 1 − γ ) 1 − γ T R ? k ≤ ( 1 − γ T ) ∞ ∑ n = 0 γ n T ( EU ∗ k n ( γ ) − EU ! ! k n ( γ ) + EU ! ! k n ( γ ) − EU ! k n ( γ ) + EU ! k n ( γ ) − EU ? k n ( γ ) ) + 2 ¯ τ γ T ( 1 − γ ) 1 − γ T Condition iv of Proposition C.1 and condition ii of Definition A.1 imply that, given h ∈ hdom ν k s.t. | h | ≥ n T supp π ! k n ( h ) ⊆ { π k ( S k ( h ) ) , ⊥ } π ! ! k n ( π k ( S k ( h ) ) ∣ h ) = 1 Therefore, π ! ! k n = π ∗ k n , and we remain with R ? k ≤ ( 1 − γ T ) ∞ ∑ n = 0 γ n T ( EU ! ! k n ( γ ) − EU ! k n ( γ ) + EU ! k n ( γ ) − EU ? k n ( γ ) ) + 2 ¯ τ γ T ( 1 − γ ) 1 − γ T We have EU ! ! k n ( γ ) − EU ! k n ( γ ) ≤ Pr x ∼ ρ ! k n [ ∃ m ∈ [ T ] : x n T + m ∈ ⊥ ¯ O ] Since Z ! n T ( K ) ≥ η , it follows that EU ! ! k n ( γ ) − EU ! k n ( γ ) ≤ 1 η Pr x ∼ ρ ? k [ ∃ m ∈ [ T ] : x n T + m ∈ ⊥ ¯ O ] ≤ 1 η E x ∼ ρ ? k [ ∣ ∣ { m ∈ [ T ] ∣ x n T + m ∈ ⊥ ¯ O } ∣ ∣ ] ∞ ∑ n = 0 ( EU ! ! k n ( γ ) − EU ! k n ( γ ) ) ≤ 1 η E x ∼ ρ ? k [ ∣ ∣ { n ∈ N ∣ x n ∈ ⊥ ¯ O } ∣ ∣ ] Using condition i of Proposition C.1, we conclude R ? k ≤ ( 1 − γ T ) ∞ ∑ n = 0 γ n T ( EU ! k n ( γ ) − EU ? k n ( γ ) ) + O ( 1 − γ T η 2 + ¯ τ ( 1 − γ ) 1 − γ T ) Define the random variables { U ! n : Ω → [ 0 , 1 ] } n ∈ N by U ! n : = 1 − γ 1 − γ T T − 1 ∑ m = 0 γ m r ( A Θ ! : n T + m ) Averaging the previous inequality over k , we get $$\frac{1}{N}\sum_{k=0}^{N-1}R^{?k} \leq (1-\gamma^T)\sum_{n=0}^\infty \gamma^{nT} \E{}\left[\E{}\left[U^!_n \mid \J^! n = K,\ Z^! {nT}\right]-\E{}\left[U^! n \mid Z^! {nT}\right]\right]