This is the first in a series of essays that aim to derive a regret bound for DRL that depends on finer attributes of the prior than just the number of hypotheses. Specifically, we consider the entropy of the prior and a certain learning-theoretic dimension parameter. As a "by product", we derive a new regret bound for ordinary RL without resets and without traps. In this chapter, we open the series by demonstrating the latter, under the significant simplifying assumption that the MDPs are deterministic. Background The regret bound we previously derived for DRL grows as a power law with the number of hypotheses. In contrast, the RL literature is usually concerned with considering all transition kernels on a fixed state space satisfying some simple assumption (e.g. a bound on the diameter or bias span). In particular, the number of hypotheses is uncountable. While the former seems too restrictive (although it's relatively simple to generalize it to countable hypothesis classes), the latter seems too coarse. Indeed, we expect a universally intelligent agent to detect patterns in the data, i.e. follow some kind of simplicity prior rather than a uniform distribution over transition kernels. The underlying technique of our proof was lower bounding the information gain in a single episode of posterior sampling by the expected regret incurred during this episode. Although we have not previously stated it in this form, the resulting regret bound depends on the entropy of the prior (we considered a uniform prior instead). This idea (unbeknownst to us) appeared earlier in Russo and Van Roy . Moreover, later Russo and Van Roy used to it formulate a generalization of posterior sampling they call "information-directed sampling" the can produce far better regret bounds in certain scenarios. However, to the best of our knowledge, this technique was not previously used to analyze reinforcement learning (as opposed to bandits). Therefore, it seems natural to derive such an "entropic" regret bound for ordinary RL, before extending it to DRL. Now, Osband and Van Roy derived a regret bound for priors supported on some space of transition kernels as a function of its Kolmogorov dimension and "eluder" dimension (the latter introduced previously by Russo and Van Roy ). They also consider a continuous state space. This is a finer approach than considering nearly arbitrary transition kernels on a fixed state space, but it still doesn't distinguish between different priors with the same support. Our new results involve a parameter similar to eluder dimension, but instead of Kolmogorov dimension we use entropy (in the following chapters we will see that Kolmogorov dimension is, in some sense, an upper bound on entropy). As opposed to Osband and Van Roy, we currently limit ourselves to finite state spaces, but on the other hand we consider no resets (at the price of a "no traps" assumption). In this chapter we derive the entropic regret bound for deterministic MDPs. (In the following we will call them deterministic decision processes (DDPs) since they have little to do with Markov.) This latter restriction significantly simplifies the analysis. In the following chapters, we will extend it to stochastic MDPs, however the resulting regret bound will be somewhat weaker. Results We start by introducing a new learning-theoretic concept of dimension. It is similar to eluder dimension, but is adapted to the discrete deterministic setting and also somewhat stronger (i.e. smaller: more environment classes are low dimensional w.r.t. this concept than w.r.t. eluder dimension). Definition 1 Consider sets A , B and F ⊆ { A → B } non-empty. Given C ⊆ A × B and a ∗ ∈ A , we say that a ∗ is F - dependent of C when for any f , g : A → B s.t. for any ( a , b ) ∈ C it holds f ( a ) = g ( a ) = b ,  we have f ( a ∗ ) = g ( a ∗ ) . Otherwise, we say that a ∗ is F - independent of C . The prediction dimension of F (denoted dim p F ) is the supremum of the set of n ∈ N for which there is a sequence { ( a k ∈ A , b k ∈ B ) } k ∈ [ n ] s.t.  for every k ∈ [ n ] , a k is F -independent of { ( a j , b j ) } j ∈ [ k ] . Fix non-empty finite sets S (the set of states) and A (the set of actions). Denote X : = S × [ 0 , 1 ] , where the second factor is regarded as the space of reward values. Given e : S × A → X , T e : S × A → S and R e : S × A → [ 0 , 1 ] s.t. e ( s , a ) = ( T e ( s , a ) , R e ( s , a ) ) , we regard T e as the (deterministic) transition kernel and R e as the reward function associated with "DDP hypothesis" e . This allows us to speak of the dimension of a DDP hypothesis class (i.e. some H ⊆ { S × A → X } ). We now give some examples for dimensions of particular function/hypothesis classes. Proposition 1 Given any A , B and F ⊆ { A → B } , we have dim p F < | F | . Proposition 2 Given any A , B and F ⊆ { A → B } , we have dim p F ≤ | A | . In particular, given H as above, dim H ≤ | S | ⋅ | A | . Proposition 3 We now consider deterministic Markov decision processes that are cellular automata . Consider finite sets X (the set of cells), M (the set of neighbor types) and a mapping ν : X × M → X (which cell is the neighbor of which cell). For example, M might be a subset of a group acting on X . More specifically, X can be ( Z / n Z ) d acting on itself, corresponding to a d -dimensional toroidal cellular automaton of size n . Consider another set C (the set of cell states) and suppose that S = { X → C } . Given any s ∈ S , and x ∈ X , define s x : X → C by s x ( m ) : = s ( ν ( x , m ) ) . Given any T : { M → C } × A → C , define T glob : S × A → S by T glob ( s , a ) ( x ) : = T ( s x , a ) . Given any R : { M → C } → [ 0 , 1 ] , define R glob : S → [ 0 , 1 ] by R glob ( s ) : = 1 | X | ∑ x ∈ X R ( s x ) . Define H by H : = { ( T glob , R glob ) ∣ ∣ T : { M → C } × A → C , R : { M → C } → [ 0 , 1 ] } That is, H is the set of transition kernels and reward functions that are local in the sense defined by ν . Then, dim p H ≤ | C | | M | ( | A | + 1 ) . In Proposition 3, it might seem like, although the rules of the automaton are local, the influence of the agent is necessarily global , because the dependence on the action appears in all cells. However, this is not really a restriction: the state of the cells can encode a particular location for the agent and the rules might be such that the agent's influence is local around this location. More unrealistic is the full observability . Dealing with partially observable cellular automata is outside the scope of this essay. The central lemma in the proof of the regret bound for RL is a regret bound in its own right, in the setting of (deterministic) contextual bandits . Since this lemma might be of independent interest, we state it already here. Let S (contexts), A (arms) and O (outcomes) be non-empty sets. Fix a function R : O → [ 0 , 1 ] (the reward function). For any c ∈ S ω (a fixed sequence of contexts), e : S × A → O (outcome rule) and π : ( S × O ) ∗ × S k → A (policy), we define e c π ∈ Δ O ω to be the resulting distribution over outcome histories. Given γ ∈ [ 0 , 1 ) , we define U γ : O ω → [ 0 , 1 ] (the utility function) by U γ ( o ) : = ( 1 − γ ) ∞ ∑ n = 0 γ n R ( o n ) Lemma 1 Consider a countable non-empty set of hypotheses H ⊆ { S × A → O } and some ζ ∈ Δ H (the prior). For each s ∈ S , define H s ⊆ { A → O } by H s : = { e : A → O ∣ ∣ e ( a ) = e ′ ( s , a ) , e ′ ∈ H } Let D : = max s ∈ S dim p H s and suppose that A is countable [this assumption is to simplify the proof and is not really necessary] . Then, there exists π † : ( S × O ) ∗ × S k → A s.t. for any c ∈ S ω and γ ∈ ( 0 , 1 ) E e ∼ ζ [ ( 1 − γ ) ∞ ∑ n = 0 γ n max a ∈ A R ( e ( c n , a ) ) − E e c π † [ U γ ] ] ≤ √ 16 D H ( ζ ) ln 2 ⋅ ( 1 − γ ) Note that the expression on the left hand side is the Bayesian regret. On the right hand side, H ( ζ ) stands for the Shannon entropy of ζ . In particular we have H ( ζ ) ≤ ln | H | ≤ | S | ⋅ | A | ln | O | Also, it's not hard to see that | H | ≤ | O | dim p H ≤ | O | D | S | and therefore D H ( ζ ) ≤ ( dim p H ) 2 ln | O | D H ( ζ ) ≤ D 2 | S | ln | O | Finally, the policy π † we actually consider in the proof is Thompson sampling. Now we proceed to studying reinforcement learning. First, we state a regret bound for RL with resets. Now S stands for the set of states and A for the set of actions. We fix a sequence of initial states c ∈ S ω . For any e : S × A → X (environment), π : X ∗ × X k → A (policy), and T ∈ N + we define e π ∈ Δ X ω to be the resulting distribution over histories, assuming that the state is reset to c n and the reward to 0 every time period of length T + 1 . In particular, we have Pr x ∼ e c [ T ] π [ ∀ n ∈ N : x n ( T + 1 ) = ( c n , 0 ) ] = 1 Given γ ∈ [ 0 , 1 ) we define U γ : X ω → [ 0 , 1 ] U γ ( s r ) : = ( 1 − γ ) ∞ ∑ n = 0 γ n r n Theorem 1 Consider a countable non-empty set of hypotheses H ⊆ { S × A → X } and some ζ ∈ Δ H . Let D : = dim p H . Then, for any T ∈ N + and γ ∈ [ 0 , 1 ) , there exists π † γ : X ∗ × X k → A s.t. for any c ∈ S ω E e ∼ ζ ⎡ ⎣ max π : X ∗ × X → A E e c [ T ] π [ U γ ] − E e c [ T ] π † T , γ [ U γ ] ⎤ ⎦ ≤ √ 16 D H ( ζ ) ln 2 ⋅ ( T + 1 ) ( 1 − γ ) Note that e c [ T ] π is actually a probability measure concentrated on a single history, sincee π is deterministic: we didn't make it explicit only to avoid introducing new notation. Finally, we give the regret bound without resets. For any e : S × A → X and π : X ∗ × X k → A , we define e π ∈ Δ X ω to be the resulting distribution over histories, given initial state s 0 and no resets. Theorem 2 Consider a countable non-empty set of hypotheses H ⊆ { S × A → X } and some ζ ∈ Δ H . Let D : = dim p H . Assume that for any e ∈ H and s ∈ S , A 0 e ( s ) = A [ A 0 was defined here in "Definition 1"; so was the value function V ( s , x ) used below] (i.e. there are no traps). For any γ ∈ [ 0 , 1 ) we define τ ( γ ) by τ ( γ ) : = E e ∼ ζ [ max s ∈ S sup x ∈ ( γ , 1 ) ∣ ∣ ∣ d V e ( s , x ) d x ∣ ∣ ∣ ] Then, for any γ ∈ [ 0 , 1 ) s.t. 1 − γ ≪ 1 there exists π † γ : X ∗ × X k → A s.t. E e ∼ ζ ⎡ ⎣ max π : X ∗ × X → A E e π [ U γ ] − E e π † γ [ U γ ] ⎤ ⎦ = O ( 3 √ D H ( ζ ) ⋅ ( τ ( γ ) + 1 ) ( 1 − γ ) ) Note that τ ( γ ) decreases with γ so this factor doesn't make the qualitative dependence on γ any worse. Both Theorem 1 and Theorem 2 have anytime variants in which the policy doesn't depend on γ at the price of a slightly (within a constant factor) worse regret bound, but for the sake of brevity we don't state them (our ultimate aim is DRL which is not anytime anyway). In Theorem 2 we didn't specify the constant, so it is actually true verbatim without the γ dependence in π † γ (but we still leave the dependence to simplify the proof a little). It is also possible to spell out the assumption on γ in Theorem 2. Proofs Definition A.1 Consider sets A , B and F ⊆ { A → B } non-empty. A sequence { ( a k ∈ A , b k ∈ B ) } k ∈ [ n ] is said to be F -independent , when  for every k ∈ [ n ] , a k is F -independent of { ( a j , b j ) } j ∈ [ k ] . Definition A.2 Consider sets A , B . Given C ⊆ A × B and a ∗ ∈ A , suppose f , g : A → B are s.t.: For any ( a , b ) ∈ C , f ( a ) = g ( a ) = b f ( a ∗ ) = g ( a ∗ ) Then, f , g are said to shatter ( C , a ∗ ) . Given sequences { ( a k ∈ A , b k ∈ B ) } k ∈ [ n ] and { ( f k , g k : A → B ) } k ∈ [ n ] , ( f , g ) is said to shatter ( a , b ) when for any k ∈ [ n ] , ( f k , g k ) shatters ( { ( a j ∈ A , b j ∈ B ) } j ∈ [ k ] , a k ) . Proof of Proposition 1 Consider { ( a k ∈ A , b k ∈ B ) } k ∈ [ n ] an F -independent sequence. We will now construct G ⊆ F s.t. | G | = n + 1 , which is sufficient. By the definition of F -independence, there is a sequence { ( f k , g k ∈ F ) } k ∈ [ n ] that shatters ( a , b ) . We have f k ( a k ) ≠ g k ( a k ) and therefore either f k ( a k ) ≠ b k or g k ( a k ) ≠ b k . Without loss of generality, assume that for each k ∈ [ n ] , f k ( a k ) ≠ b k . It follows that for any k ∈ [ n ] and j ∈ [ k ] , f j ( a j ) ≠ b j = f k ( a j ) and therefore f j ≠ f k . If n = 0 then there is nothing to prove since F is non-empty, hence we can assume n > 0 . For any k ∈ [ n − 1 ] , f k ( a k ) ≠ b k = g n − 1 ( a k ) and therefore f k ≠ g n − 1 . Also, f n − 1 ( a n − 1 ) ≠ g n − 1 ( a n − 1 ) and therefore f n − 1 ≠ g n − 1 . We now take G = { f 0 , f 1 … f n − 1 , g n − 1 } , completing the proof. ■ Proof of Proposition 2 Consider { ( a k ∈ A , b k ∈ B ) } k ∈ [ n ] an F -independent sequence and { ( f k , g k ∈ F ) } k ∈ [ n ] that shatters it. For any k ∈ [ n ] and j ∈ [ k ] , we have f k ( a j ) = g k ( a j ) but f k ( a k ) ≠ g k ( a k ) , implying that a j ≠ a k . It follows that | A | ≥ n . ■ Proof of Proposition 3 Consider { ( s k ∈ S , a k ∈ A , t k ∈ S , r k ∈ [ 0 , 1 ] ) } k ∈ [ n ] an H -independent sequence and { ( T glob k , R glob k , ~ T glob k , ~ R glob k ) } k ∈ [ n ] that shatters it. Define A , B ⊆ [ n ] by A : = { k ∈ [ n ] ∣ ∣ T glob k ( s k , a k ) ≠ ~ T glob k ( s k , a k ) } B : = { k ∈ [ n ] ∣ ∣ R glob k ( s k ) ≠ ~ R glob k ( s k ) } Since ( T glob , R glob , ~ T glob , ~ R glob ) shatters ( s , a , t , r ) , we have A ∪ B = [ n ] . Consider any k ∈ A . Obviously, there is x k ∈ X s.t. T glob k ( s k , a k ) ( x k ) ≠ ~ T glob k ( s k , a k ) ( x k ) Denote σ k : = ( s k ) x k ∈ C M . We have T k ( σ k , a k ) ≠ ~ T k ( σ k , a k ) . On the other hand, for any j ∈ A ∩ [ k ] , the shattering implies T glob k ( s j , a j ) = ~ T glob k ( s j , a j ) and in particular T k ( σ j , a j ) = ~ T k ( σ j , a j ) . Therefore, ( σ k , a k ) ≠ ( σ j , a j ) . We conclude that | A | ≤ | C | | M | ⋅ | A | . Now consider any k ∈ B . Define f k ∈ R { M → C } by ( f k ) σ : = ∣ ∣ { x ∈ X ∣ ∣ ( s k ) x = σ } ∣ ∣ | X | We have f k ⋅ R k = R glob k ( s k ) ≠ ~ R glob k ( s k ) = f k ⋅ ~ R k f k ⋅ ( R k − ~ R k ) ≠ 0 (These are dot products in R { M → C } .) On the other hand, for any j ∈ B ∩ [ k ] , the shattering implies f j ⋅ R k = f j ⋅ ~ R k and therefore f j ⋅ ( R k − ~ R k ) = 0 . Therefore, f k is not in the linear span of { f j } j ∈ B ∩ [ k ] and hence the set { f k } k ∈ B is linearly independent.  We conclude that | B | ≤ dim R { M → C } = | C | | M | . Putting everything together, we get n ≤ | A | + | B | ≤ | C | | M | ( | A | + 1 ) . ■ Proposition A.1 Consider a countable set A , a set B , a non-empty countable set F ⊆ { A → B } , some f ∗ : A → B , some ζ ∈ Δ F and some ξ ∈ Δ A . Denote p : = Pr ( a , f ) ∼ ξ × ζ [ f ( a ) ≠ f ∗ ( a ) ] Then, for any q ∈ ( 0 , 1 ) , we can choose A ∘ ⊆ A and F ∘ ⊆ F s.t. ξ ( A ∘ ) ≥ 1 − q , ζ ( F ∘ ) ≥ 1 − p q dim p F and for any f , g ∈ F ∘ and a ∈ A ∘ , f ( a ) = g ( a ) . Proof of Proposition A.1 We define A ∘ by A ∘ : = { a ∈ A ∣ ∣ ∣ Pr f ∼ ζ [ f ( a ) ≠ f ∗ ( a ) ] ≤ p q } The fact that ξ ( A ∘ ) ≥ 1 − q follows from the definition of p . Denote n : = | A ∘ | ∈ N ∪ { ω } and enumerate A ∘ as A ∘ = { a k } k ∈ [ n ] . For each k ∈ [ n ] , define F k ⊆ F recursively by F 0 : = F F k + 1 : = { F k if ∀ f , g ∈ F k : f ( a k ) = g ( a k ) { f ∈ F k | f ( a k ) = f ∗ ( a k ) } otherwise Set F ∘ : = ⋂ k ∈ [ n ] F k . Define I ⊆ [ n ] by I : = { k ∈ [ n ] | F k + 1 ≠ F k } Denote m : = | I | . For any i ∈ [ m ] , we denote by k i the i -th number in I in increasing order. Denote a ∗ i : = a k i and b ∗ i : = f ∗ ( a ∗ i ) . By the definition of F k , for each i ∈ [ m ] we can choose f i , g i ∈ F k i s.t. f i ( a ∗ i ) ≠ g i ( a ∗ i ) . Moreover, it also follows from the definition that for every i ∈ [ m ] and j ∈ [ i ] , f i ( a ∗ j ) = g i ( a ∗ j ) = b ∗ j (using only the fact that f i , g i ∈ F k i and k i > k j ). Therefore, ( f , g ) shatters ( a ∗ , b ∗ ) and hence m ≤ dim p F . By the definition of A ∘ , for any k ∈ I , ζ ( F k + 1 ) ≥ ζ ( F k ) − p q . On the other hand, for any k ∈ [ n ] ∖ I , F k + 1 = F k and in particular ζ ( F k + 1 ) = ζ ( F k ) . We conclude that ζ ( F ∘ ) ≥ ζ ( F 0 ) − p q m ≥ 1 − p q dim p F ■ Proposition A.2 Consider a countable set A , a set B , a non-empty countable set F ⊆ { A → B } , some ζ ∈ Δ F and some ξ ∈ Δ A . Consider f ∗ : A → B s.t. f ∗ ( a ) ∈ a r g m a x b ∈ B Pr f ∼ ζ [ f ( a ) = b ] Then, Pr ( a , f ) ∼ ξ × ζ [ f ( a ) ≠ f ∗ ( a ) ] ≤ 1 ln 2 I ( a , f ) ∼ ξ × ζ [ f ; a , f ( a ) ] [ I [ f ; a , f ( a ) ] stands for the mutual information between f and the joint random variables a , f ( a ) .] Proof of Proposition A.2 By the chain rule for mutual information I ( a , f ) ∼ ξ × ζ [ f ; a , f ( a ) ] = I ( a , f ) ∼ ξ × ζ [ f ; a ] + I ( a , f ) ∼ ξ × ζ [ f ; f ( a ) | a ] The first term on the right hand side obviously vanishes, and the second term can be expressed in terms of KL-divergence. For any a ∈ A , Define ev a : F → B by ev a ( f ) : = f ( a ) . We get I ( a , f ) ∼ ξ × ζ [ f ; a , f ( a ) ] = E ( a , f ) ∼ ξ × ζ [ D K L ( δ f ( a ) ∣ ∣ ∣ ∣ ev a ∗ ζ ) ] = E ( a , f ) ∼ ξ × ζ [ ln 1 ζ ( ev − 1 a ( f ( a ) ) ) ] I ( a , f ) ∼ ξ × ζ [ f ; a , f ( a ) ] ≥ E ( a , f ) ∼ ξ × ζ [ ln 1 ζ ( ev − 1 a ( f ( a ) ) ) ; f ( a ) ≠ f ∗ ( a ) ] For any a ∈ A and f ∈ F , ζ ( ev − 1 a ( f ( a ) ) ) ≤ ζ ( ev − 1 a ( f ∗ ( a ) ) ) by definition of f ∗ . If f ( a ) ≠ f ∗ ( a ) , then ζ ( ev − 1 a ( f ( a ) ) ) + ζ ( ev − 1 a ( f ∗ ( a ) ) ) = ζ ( ev − 1 a ( { f ( a ) , f ∗ ( a ) } ) ) ≤ 1 It follows that, in this case, ζ ( ev − 1 a ( f ( a ) ) ) ≤ 1 2 . We conclude I ( a , f ) ∼ ξ × ζ [ f ; a , f ( a ) ] ≥ ( ln 2 ) Pr ( a , f ) ∼ ξ × ζ [ f ( a ) ≠ f ∗ ( a ) ] ■ Proposition A.3 Consider a countable set A , a set O , a non-empty countable set H ⊆ { A → O } , some ζ ∈ Δ H and some R : O → [ 0 , 1 ] . Let Π : H → A be s.t. Π ( e ) ∈ a r g m a x a ∈ A R ( e ( a ) ) Then, E e ∼ ζ [ max a ∈ A R ( e ( a ) ) − E a ∼ Π ∗ ζ [ R ( e ( a ) ) ] ] ≤ 4 √ dim p H ln 2 ⋅ I ( a , e ) ∼ Π ∗ ζ × ζ [ e ; a , e ( a ) ] Proof of Proposition A.3 Denote ξ : = Π ∗ ζ , D : = dim p H and Γ : = I ( a , e ) ∼ ξ × ζ [ e ; a , e ( a ) ] . By Proposition A.2, there is e ∗ : A → O s.t. Pr ( a , e ) ∼ ξ × ζ [ e ( a ) ≠ e ∗ ( a ) ] ≤ Γ ln 2 By Proposition A.1 (setting q : = √ Γ D ln 2 ), there are A ∘ ⊆ A and H ∘ ⊆ H s.t. ξ ( A ∘ ) ≥ 1 − √ Γ D ln 2 , ζ ( H ∘ ) ≥ 1 − √ Γ D ln 2 and for any e 1 , e 2 ∈ H ∘ and a ∈ A , e 1 ( a ) = e 2 ( a ) . Define H ∗ : = H ∘ ∩ Π − 1 ( A ∘ ) . We have ζ ( H ∗ ) ≥ 1 − 2 √ Γ D ln 2 . Denote L : = E e ∼ ζ [ max a ∈ A R ( e ( a ) ) − E a ∼ ξ [ R ( e ( a ) ) ] ] . For brevity, we will also use the notation E e ∗ [ X ] : = E e ∼ ζ [ X ; e ∈ H ∗ ] . We get, using the bound on ζ ( H ∗ ) L ≤ E e ∗ [ max a ∈ A R ( e ( a ) ) − E a ∼ ξ [ R ( e ( a ) ) ] ] + 2 √ Γ D ln 2 L ≤ E e ∗ [ E e ′ ∗ [ R ( e ( Π ( e ) ) ) − R ( e ( Π ( e ′ ) ) ) ] ] + 4 √ Γ D ln 2 Using the properties of H ∘ and A ∘ we get L ≤ E e ∗ [ E e ′ ∗ [ R ( e ′ ( Π ( e ) ) ) − R ( e ′ ( Π ( e ′ ) ) ) ] ] + 4 √ Γ D ln 2 The expression inside the expected values in the first term on the right hand side is negative, by the property of Π . We conclude L ≤ 4 √ Γ D ln 2 ■ Proof of Lemma 1 For each s ∈ S we choose some Π s : H → A s.t. Π s ( e ) ∈ a r g m a x a ∈ A R ( e ( s , a ) ) We now take π † to be Thompson sampling. More formally, we construct a probability space ( Ω , P ) with random variables K : Ω → H (the true environment) and { J n : Ω → { S n → H } } n ∈ N (the hypothesis sampled on round n ). We define { A n : Ω → { S n + 1 → A } } n ∈ N (the action taken on round n ) and { Θ n : Ω → { S n + 1 → O } } n ∈ N (the observation made on round n ) by A n ( s ) : = Π s n ( J n ( s : n ) ) Θ n ( s ) : = K ( s n , A n ( s ) ) We also define { H n : Ω → { S n → H } } n ∈ N by H n ( s ) : = { e ∈ H | ∀ m ∈ [ n ] : e ( s m , A m ( s : m ) ) = Θ n ( s : m ) } H n is thus the set of hypotheses consistent with the previous outcomes K ( s m , Π s m ( J m ) ) . The random variables K , J have to satisfy K ∗ P = ζ (the distribution of the true environment is the prior) and Pr [ J n ( s ) = e ∣ ∣ K , { J m ( s : m ) } m ∈ [ n ] ] = Pr ζ [ e | H n ( s ) ] That is, the distribution of J n conditional on K and J m for m ∈ [ n ] is given by the prior ζ updated by the previous outcomes. π † is then defined s.t. for any s o ∈ ( S × O ) n , t ∈ S and a ∈ A : π † ( a | s o , t ) : = Pr [ A n ( s t ) = a | ∀ m ∈ [ n ] : o m = Θ m ( s : m ) ] Now we need to prove the regret bound. We denote the Bayesian regret by R : R ( c , γ ) : = E e ∼ ζ [ ( 1 − γ ) ∞ ∑ n = 0 γ n max a ∈ A R ( e ( c n , a ) ) − E e c π † [ U γ ] ] The construction of π † implies that R ( c , γ ) = ( 1 − γ ) ∞ ∑ n = 0 γ n E [ max a ∈ A R ( K ( c n , a ) ) − R ( K ( c n , A n ( c : n + 1 ) ) ) ] Define { Z n : Ω → { S n → Δ H } } n ∈ N (the belief state of the agent on round n ) and { Ξ n : Ω → { S n + 1 → Δ A } } n ∈ N (the distribution over actions on round n ) by Z n ( s ) : = ζ ∣ H n ( s ) Ξ n ( s ) : = Π s n ∗ Z n ( s ) Using expectation conditional on Z n we can rewrite the equation for R ( γ ) as R ( c , γ ) = ( 1 − γ ) ∞ ∑ n = 0 γ n E [ E e ∼ Z n ( c : n ) [ max a ∈ A R ( e ( c n , a ) ) − E a ∼ Ξ n ( c : n + 1 ) [ R ( e ( c n , a ) ) ] ] ] It follows that R ( c , γ ) ≤  

 ⎷ ( 1 − γ ) ∞ ∑ n = 0 γ n E ⎡ ⎣ E e ∼ Z n ( c : n ) [ max a ∈ A R ( e ( c n , a ) ) − E a ∼ Ξ n ( c : n + 1 ) [ R ( e ( c n , a ) ) ] ] 2 ⎤ ⎦ We now apply Proposition A.3 and get R ( c , γ ) ≤  
 ⎷ 16 D ln 2 ⋅ ( 1 − γ ) ∞ ∑ n = 0 γ n E [ I ( a , e ) ∼ Ξ n ( c : n + 1 ) × Z n ( c : n ) [ e ; a , e ( a ) ] ] R ( c , γ ) ≤  
 ⎷ 16 D ln 2 ⋅ ( 1 − γ ) ∞ ∑ n = 0 γ n E [ H ( Z n ( c : n ) ) − H ( Z n + 1 ( c : n + 1 ) ) ] R ( c , γ ) ≤ √ 16 D H ( ζ ) ln 2 ⋅ ( 1 − γ ) ■ Given any x ∈ X , we will use the notation x = ( st x ∈ S , rw x ∈ [ 0 , 1 ] ) . Proposition A.4 Fix T ∈ N + and consider a non-empty set of DDP hypotheses H ⊆ { S × A → X } . For each e : S × A → X we define e ♯ : S × A T → X T recursively by e ♯ ( s , π ) 0 : = e ( s , π 0 ) e ♯ ( s , π ) n + 1 = e ( st e ♯ ( s , π ) n , π n + 1 ) (That is, e ♯ ( s , π ) is the history resulting from DDP e interacting with action sequence π starting from initial state s .) Define H ♯ : = { e ♯ ∣ ∣ e ∈ H } Then, for any s ∈ S , dim p H ♯ s ≤ dim p H . Here, the subscript s has the same meaning as in Lemma 1. Proof of Proposition A.4 Fix s ∈ S . Let { ( π k ∈ A ♯ , h k ∈ X T ) } k ∈ [ n ] be an H ♯ s -independent sequence. We will now construct a sequence { ( s ∗ k ∈ S , a ∗ k ∈ A , x ∗ k ∈ X , e k ∈ H , ~ e k ∈ H ) } k ∈ [ n ] s.t ( e , ~ e ) shatters ( s ∗ , a ∗ , x ∗ ) . The latter implies that ( s ∗ , a ∗ , x ∗ ) is an H -independent sequence, establishing the claim. For brevity, we will use the notation f π : = f ♯ ( s , π ) (here, f : S × A → X and π : S × N → A ). For each k ∈ [ n ] define m k ∈ [ T ] by m k : = min { l ∣ ∣ ∃ f , ~ f ∈ H : ( f π k ) : l + 1 ≠ ( ~ f π k ) : l + 1 ∧ ∀ j ∈ [ k ] : f π j = ~ f π j = h j } Note that the set above is indeed non-empty because ( π , h ) is H ♯ s -independent. Given g ∈ X T , we will use the notational convention st g − 1 : = s . Choose e k , ~ e k s.t. ( e k π k ) : m k + 1 ≠ ( ~ e k π k ) : m k + 1 and ∀ j ∈ [ k ] : e k π j = ~ e k π j = h j . Obviously ( e k π k ) : m k = ( ~ e k π k ) : m k . We set s ∗ k : = st ( e k π k ) m k − 1 and a ∗ k : = ( π k ) m k . Clearly e k ( s ∗ k , a ∗ k ) ≠ ~ e k ( s ∗ k , a ∗ k ) . If k < n − 1 then there is f ∈ H s.t. ∀ j ∈ [ k + 1 ] : f π j = h j (by independence). Therefore, st ( h k ) m k − 1 = s ∗ k : otherwise st ( f π k ) m k − 1 ≠ st ( e k π k ) m k − 1 and we get a contradiction with the minimality of m k . We now set x ∗ k : = ( h k ) m k . If k = n , we choose x ∗ k ∈ X arbitrarily. For any k ∈ [ n ] and j ∈ [ k ] , e k π j = ~ e k π j = h j and therefore e k ( s ∗ k , a ∗ k ) = ~ e k ( s ∗ k , a ∗ k ) = x ∗ k . Proof of Theorem 1 Let A ♯ : = A T , O ♯ : = X T and H ♯ be defined as in Proposition A.4. By Proposition A.4, we have max s ∈ S dim p H ♯ s ≤ D . Define ζ ♯ ∈ Δ H ♯ as the pushforward of ζ by the ♯ operator. Define R ♯ γ : O ♯ → [ 0 , 1 ] by R ♯ γ ( h ) : = γ ( 1 − γ ) 1 − γ T + 1 T − 1 ∑ n = 0 γ n rw h n Denote also γ ♯ : = γ T + 1 . It is easy to see that given any η ∈ O ♯ ω U γ ( ∞ ∏ n = 0 ( c n , 0 ) η n ) = ( 1 − γ ♯ ) ∞ ∑ n = 0 γ ♯ n R ♯ γ ( η n ) The product is in the string concatenation sense. Applying Lemma 1 to all the " ♯ " objects (with S and c unaffected), we get π † T , γ s.t. E e ∼ ζ ⎡ ⎣ max π : X ∗ × X → A E e c [ T ] π [ U γ ] − E e c [ T ] π † T , γ [ U γ ] ⎤ ⎦ ≤ √ 16 D H ( ζ ♯ ) ln 2 ⋅ ( 1 − γ ♯ ) Here, we used the fact that the optimal policy for a DDP with fixed initial state (and any time discount function) can be taken to be a fixed sequence of actions. Observing that H ( ζ ♯ ) ≤ H ( ζ ) and 1 − γ T + 1 ≤ ( T + 1 ) ( 1 − γ ) , we get the desired result. ■ The following is a minor variant of what was called "Proposition B.2" here , and we state it here without proof (since the proof is essentially the same). Proposition A.5 Consider a DDP e : S × A → X , policies π 0 , π ∗ : X ∗ × X k → A and T ∈ N + . Suppose that for any h ∈ X ∗ and x ∈ X supp π 0 ( h , s ) ⊆ A 0 e ( s ) Suppose further that π ∗ is optimal for e with time discount γ and any initial state. Denote τ e ( γ ) : = max s ∈ S sup x ∈ ( γ , 1 ) ∣ ∣ ∣ d V e ( s , x ) d x ∣ ∣ ∣ Given any s ∈ S and policy π , denote e s π ∈ Δ X ω the distribution over histories of resulting from π interacting with e starting from initial state s . Finally, define U T , γ : X ω → [ 0 , 1 ] by U T , γ ( h ) : = 1 − γ 1 − γ T T − 1 ∑ n = 0 γ n rw h n Then E e π ∗ [ U γ ] ≤ ( 1 − γ T ) ∞ ∑ n = 0 γ n T E h ∼ e π 0 [ E e st h n T π ∗ [ U T , γ ] ] + 2 τ e ( γ ) γ T ( 1 − γ ) 1 − γ T Proof of Theorem 2 It is not hard to see that Theorem 1 can be extended to the setting where the initial state sequence c ∈ S ω is chosen in a way that depends on the history. This is because if c is chosen adversarially (i.e. in order to maximize regret), the history doesn't matter (in other words, we get a repeated zero-sum game in which, on each round, the initial state is chosen by the adversary and the policy is chosen by the agent after seeing the initial state; this game clearly has a pure Nash equilibrium). In particular, we can let c be just the states naturally resulting from the interaction of the DDP with the policy. Let π ∗ e γ be the optimal policy for DDP e and time discount γ . We get E e ∼ ζ ⎡ ⎣ ( 1 − γ T ) ∞ ∑ n = 0 γ n T E h ∼ e π † T , γ [ E e st h n T π ∗ e γ [ U T , γ ] ] − E e π † T − 1 , γ [ U γ ] ⎤ ⎦ ≤ √ 16 D H ( ζ ) ln 2 ⋅ T ( 1 − γ ) + 1 − γ 1 − γ T Here, the second term on the right hand side comes from the rewards at time moments divisible by T , which were set to 0 in Theorem 1. Denote R ( T , γ ) : = E e ∼ ζ ⎡ ⎣ max π : X ∗ × X → A E e π [ U γ ] − E e π † T − 1 , γ [ U γ ] ⎤ ⎦ Applying Proposition A.5, we get R ( T , γ ) ≤ √ 16 D H ( ζ ) ln 2 ⋅ T ( 1 − γ ) + 1 − γ 1 − γ T + 2 τ ( γ ) γ T ( 1 − γ ) 1 − γ T Assume that γ T − 1 ≥ 1 2 . Then 1 − γ 1 − γ T = 1 ∑ T − 1 n = 0 γ n ≤ 2 T R ( T , γ ) ≤ √ 16 D H ( ζ ) ln 2 ⋅ T ( 1 − γ ) + 4 τ ( γ ) + 2 T Now set T : = ⎡ ⎢
⎢
⎢ ⎢ 3  
 ⎷ ( τ ( γ ) + 1 ) 2 D H ( ζ ) ⋅ ( 1 − γ ) ⎤ ⎥
⎥
⎥ ⎥ It is easy to see that the assumption γ T − 1 ≥ 1 2 is now justified for 1 − γ ≪ 1 . We get R ( T , γ ) = O ( 3 √ D H ( ζ ) ⋅ ( τ ( γ ) + 1 ) ( 1 − γ ) )