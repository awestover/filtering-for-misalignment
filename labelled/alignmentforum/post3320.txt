TLDR: We define a variant of reinforcement learning in which the reward is not perceived directly, but can be estimated at any given moment by some (possibly costly) experiment. The reward function is no longer a function of the observation history, but a different object that we call "instrumental reward function". We give two definitions of instrumental reward function and prove their equivalence. We also derive a regret bound for this setting. Background In "classical" reinforcement learning the agent perceives the reward signal on every round of its interaction with the environment, whether through a distinct input channel or through some given way to compute the reward from the interaction history so far. On the other hand, we can rather easily imagine agents that optimize properties of their environment that they do not directly perceive. For example, if Alice, who lives in Dominica, donates money to the Against Malaria Foundation in order to save someone in Africa, then the result is usually not visible to Alice at the time it occurs, if ever. Similarly, Clippy the paperclip maximizer doesn't always perceive all the paperclips in the universe. Moreover, we might want to design agents that, in order to estimate the reward, direct queries to humans (which is costly and cannot be done continuously non-stop). Now, it is possible to define the perceived reward as the subjective expected value of the "true" imperceptible reward (see the Results section for details). Although this transformation preserves expected utility, it does not preserve Bayesian regret. Indeed, Bayesian regret is the difference between the expected utility attained by the agent and the expected utility attained by a "reference" agent that knows the true environment from the onset. However, after the transformation, the reference agent will behave as if it knows the observable dynamics of the true environment but still pretends not to know the true environment for the purpose of computing the reward. Therefore, regret analysis requires us to consider the imperceptible reward honestly. In fact, as we will see, certain assumptions about the imperceptible reward function are needed even to make the problem learnable at all. Finally, this transformation makes the reward function more complex and hence applying a "generic" reinforcement learning algorithm after the transformation (instead of exploiting the special form of the resulting reward function) might carry a significant computational complexity penalty. Related Work: De Blanc 2011 studies so called "ontological crises". That is, de Blanc examines the problem of translating a reward function from one ontology into another. Here, we avoid this problem by considering reward functions that are automatically defined in all ontologies. That said, it might still be interesting to think about how to specify our type of reward function starting from a reward function that is only defined in one particular ontology. We will return to this in the Discussion section. Krueger et al 2016 consider a setting where querying the reward is instantaneous and has a fixed cost. This is a special case of our setting, but we allow a much more general type of query and cost. Also, Krueger et al don't derive any theoretical regret bound (but they do present some experimental results). Finally, multi-armed bandits with partial monitoring are closely related, see for example Bartok et al 2013 . However, bandits by definition assume a stateless environment, and also our approach is rather different than what is usually studied in partial monitoring. The literature study was very cursory and I will be glad to know about prior work I missed! Results Partially Observable MDPs with Imperceptible Rewards Partially Observable Markov Decision Processes (POMDPs) serve as a natural starting point for thinking about imperceptible rewards. Indeed, it might seem like all we have to do is consider RL in a POMDP environment and let the reward to be a function of the (imperceptible) state. However, this setting is in general unlearnable even given assumptions that rule out traps. A (finite) POMDP is defined by non-empty finite sets S (states), A (actions) and O (observations), the transition kernel T : S × A k → S × O and the reward function R : S → [ 0 , 1 ] . As opposed to the "classical" definition of POMDP, we allow the value of R is to be imperceptible. The perceptible setting is a special case of the imperceptible setting: we can always encode the reward into the observation. To formulate a learning problem, we assume S , A and O to be fixed and an initial state s 0 ∈ S to be given, while T and R are unknown and belong to some hypothesis class H : H ⊆ { S × A k → S × O } × { S → [ 0 , 1 ] } Such a problem can be unlearnable even if R is known and there are no irreversible events that can happen: Example 1 Suppose that S = { s 0 , s − , s + } , A = { a − , a + } , O = { ⊥ } , R ( s 0 ) = 1 2 , R ( s − ) = 0 , R ( s + ) = 1 and H = { ( T − , R ) , ( T + , R ) } where for any s ∈ S T − ( s + , ⊥ | s , a − ) = 1 T − ( s − , ⊥ | s , a + ) = 1 T + ( s + , ⊥ | s , a + ) = 1 T + ( s − , ⊥ | s , a − ) = 1 Since | O | = 1 , there is no way to gain any information about which hypothesis is correct. Moreover, the optimal policies for the two hypotheses are different. Namely, for T + we should always take action a + and for T − we should always take action a − . To formalize and illustrate the discussion in the Background section, suppose H is Borel and ζ ∈ Δ H is the prior. We can then define the "perceived effective reward" E R : ( A × O ) ∗ → [ 0 , 1 ] by E R ( a o ) : = E ( T , R ) ∼ ζ ( s n + 1 , o ′ n ) ∼ T ( s n , a n ) [ R ( s | h | ) ∣ ∣ o ′ = o ] It is then easy to see that the E operator preserves expected utility: given any policy π : ( A × O ) ∗ k → A and m ∈ N E ( T , R ) ∼ ζ a n ∼ π ( a o : n ) ( s n + 1 , o n ) ∼ T ( s n , a n ) [ E R ( a o : m ) ] = E ( T , R ) ∼ ζ a n ∼ π ( a o : n ) ( s n + 1 , o n ) ∼ T ( s n , a n ) [ R ( s m ) ] and therefore, for any geometric time discount parameter γ ∈ [ 0 , 1 ) E ( T , R ) ∼ ζ a n ∼ π ( a o : n ) ( s n + 1 , o n ) ∼ T ( s n , a n ) [ ∞ ∑ n = 0 γ n E R ( a o : n ) ] = E ( T , R ) ∼ ζ a n ∼ π ( a o : n ) ( s n + 1 , o n ) ∼ T ( s n , a n ) [ ∞ ∑ n = 0 γ n R ( s n ) ] On the other hand, Bayesian regret is not preserved since, in general E ( T , R ) ∼ ζ [ max π E a o s ∼ T π [ ∞ ∑ n = 0 γ n E R ( a o : n ) ] ] ≠ E ( T , R ) ∼ ζ [ max π E a o s ∼ T π [ ∞ ∑ n = 0 γ n R ( s n ) ] ] Here a o s ∼ T π is shorthand notation for the same probability distribution as before. Indeed, in Example 1 the LHS of the above is 1 2 ⋅ 1 1 − γ since E R ≡ 1 2 , whereas the RHS is 1 2 + γ 1 − γ . The pathology of Example 1 comes about because reward is not only imperceptible but entirely unobservable . That is, no experiment can produce any information about whether the reward on a given round n > 0 was 0 or 1. More specifically, the states s − and s + are assigned different rewards, but there is no observable difference between them. It is as if Alice would assign value, not to people in Africa (whose existence and well-being can be measured) but to some Flying Spaghetti Monster s.t. the world behaves exactly the same regardless of its existence or condition. This observation suggests that, instead of assigning rewards to states which are just abstract labels in a model, we should assign rewards to states that are defined in terms of the observable consequences of the interaction of the agent with the environment. This leads us to the notion of "instrumental state", which we will now define formally. Instrumental States and Reward Functions First, we introduce some technical definitions for notational convenience. Definition 1 C o n S e t is the category whose objects are pairs ( V , C ) where V is a real vector space and C is a convex subset of V , and whose morphisms are M o r ( ( V , C ) , ( W , D ) ) : = { f : C → D | ∃ A ∈ H o m ( V , W ) , w ∈ W ∀ v ∈ C : f ( v ) = A v + w } We omit describing identity and composition of morphisms since they are obvious. It is easy to see that C o n S e t has arbitrary limits. In particular, C o n S e t has a final object that we denote by p t (the one point set), products ( ( V , C ) × ( W , D ) ≅ ( V ⊕ W , C × D ) ) and inverse limits of sequences. For any finite set A , ( R A , Δ A ) is an object in C o n S e t . Also, we will sometimes abuse notation by regarding C as an object of C o n S e t instead of ( V , C ) (i.e. making V implicit). Definition 2 The functor Cone : C o n S e t → C o n S e t is defined by Cone ( V , C ) : = ( V ⊕ R , { ( λ v , λ ) | λ ∈ [ 0 , 1 ] , v ∈ C } ) ( Cone f ) ( λ v , λ ) : = ( λ f ( v ) , λ ) Definition 3 For any C ∈ C o n S e t , we define h C : Cone C → [ 0 , 1 ] by h C ( λ v , λ ) : = λ Note that h is a natural transformation from Cone to the constant functor with value [ 0 , 1 ] . Given C ∈ C o n S e t and x ∈ Cone C s.t. x = ( u , λ ) for λ > 0 , we denote [ x ] : = λ − 1 u ∈ C . Now, we are ready to define instrumental states. We fix the sets A and O . Definition 4 For any n ∈ N , we define I S n ∈ C o n S e t , the space of n time step instrumental states, recursively by I S 0 : = p t I S n + 1 : = ∏ a ∈ A ( ∏ o ∈ O h I S n ) − 1 ( Δ O ) Here, ∏ o ∈ O h I S n is a mapping from ∏ o ∈ O Cone I S n to [ 0 , 1 ] O . The inverse image of a convex set (in this case Δ O ⊆ [ 0 , 1 ] O ) under an affine mapping (in this case ∏ o ∈ O h I S n ) is also a convex set. The semantics of Definition 4 is as follows. Any α ∈ ( ∏ o ∈ O h I S n ) − 1 ( Δ O ) can be regarded as a pair consisting of some α ′ ∈ Δ O (the image of α under ∏ o ∈ O h I S n ) and a mapping α ′′ : supp α ′ → I S n defined by α ′′ ( o ) : = [ α o ] . Given θ ∈ I S n + 1 , θ ′ a is the probability distribution over observations resulting from taking action a in state θ , whereas θ ′′ a ( o ) is the state resulting from taking action a in state θ conditional on observing o . This semantics can be made more formal as follows: Definition 5 Given θ ∈ I S n , we define dom θ ⊆ ( A × O ) ∗ recursively as follows: λ ∈ dom θ For all h ∈ ( A × O ) ∗ , a ∈ A and o ∈ O : a o h ∈ dom θ iff n > 0 , h I S n − 1 ( θ a o ) > 0 and h ∈ dom [ θ a o ] . Definition 6 Given θ ∈ I S n , h ∈ dom θ and a ∈ A , and assuming that | h | < n , we recursively define θ ( h a ) ∈ Δ O by For h = λ : θ ( o ∣ a ) : = h I S n − 1 ( θ a o ) For h = a ′ o ′ h ′ with some a ′ ∈ A , o ′ ∈ O and h ′ ∈ ( A × O ) ∗ : θ ( h a ) : = [ θ a ′ o ′ ] ( h ′ a ) The point of defining I S n in this manner is that (i) different points in I S n correspond to states that are truly not equivalent, i.e. can be empirically distinguished (statistically) and (ii) convex combinations of points in I S n correspond precisely to probabilistic mixtures. Formally, we have: Definition 7 Given θ ∈ I S n and π : ( A × O ) < n k → A (a policy), we define θ π ∈ Δ ( A × O ) n (probability distribution over histories resulting from following policy π in state θ ) by Pr a o ∼ θ π [ a m = a ∗ ] = E a o ∼ θ π [ π ( a ∗ | a o : m ) ] Pr a o ∼ θ π [ o m = o ∗ ] = E a o ∼ θ π [ θ ( o ∗ | a o : m a m ) ] Proposition 1 Consider some θ , θ ′ ∈ I S n and assume that for any π : ( A × O ) < n → A , θ π = θ ′ π . Then, θ = θ ′ . Proposition 2 Consider some θ , θ ′ ∈ I S n , π : ( A × O ) < n k → A and p ∈ [ 0 , 1 ] . Then ( p θ + ( 1 − p ) θ ′ ) π = p θ π + ( 1 − p ) θ ′ π I S n is a bounded polytope but in general it is *not} a simplex: we cannot regard it as just probability distributions over some set. For example, if | A | = | O | = 2 , then it's easy to see that I S 1 is a square (one axis is the probability to get a given observation when taking one action, the other axis is the probability for the other action). On the other hand, if | A | = 1 then I S n is a simplex: it is canonically isomorphic to Δ O n . There are a natural morphisms p r n : I S n + 1 → I S n whose semantics is forgetting about the behavior of the state at time step n : Definition 8 We define p r n : I S n + 1 → I S n for any n ∈ N recursively. p r 0 is the unique morphism from I S 1 to I S 0 ≅ p t . For any n ∈ N , p r n + 1 is given by p r n + 1 ( θ ) a o : = ( Cone p r n ) ( θ a o ) We thereby get a sequence I S 0 ← I S 1 ← I S 2 ← … Definition 9 We define I S ω , the space of (infinite time step) instrumental states by I S ω : = lim ← − n I S n We denote the canonical projections by p r ω n : I S ω → I S n . Of course, I S ω can also be regarded as the space of all possible stochastic environments. Specifically, we have: Definition 10 For any μ ∈ I S ω we define dom μ ∈ ( A × O ) ∗ by dom μ : = ∞ ⋃ n = 0 dom p r ω n μ Definition 11 Given μ ∈ I S ω , h ∈ dom μ and a ∈ A , we define μ ( h a ) ∈ Δ O by μ ( h a ) : = p r ω | h | + 1 μ ( h a ) Like in the finite time case, we have Definition 12 Given μ ∈ I S ω and π : ( A × O ) ∗ k → A , we define μ π ∈ Δ ( A × O ) ω by Pr a o ∼ μ π [ a n = a ∗ ] = E a o ∼ μ π [ π ( a ∗ | a o : n ) ] Pr a o ∼ μ π [ o n = o ∗ ] = E a o ∼ μ π [ μ ( o ∗ | a o : n a n ) ] Proposition 3 Consider some μ , μ ′ ∈ I S ω and assume that for any π : ( A × O ) ∗ → A , μ π = μ ′ π . Then, μ = μ ′ . Proposition 4 Consider some μ , μ ′ ∈ I S ω , π : ( A × O ) ∗ k → A and p ∈ [ 0 , 1 ] . Then ( p μ + ( 1 − p ) μ ′ ) π = p μ π + ( 1 − p ) μ ′ π For each n ∈ N , I S n is finite-dimensional and therefore has a natural topology. I S ω also becomes a topological space by equipping it with the inverse limit topology. Since the I S n are closed and bounded they are compact, and therefore I S ω is also compact by Tychonoff's theorem. In the special case | A | = 1 , I S ω ≅ Δ O ω and the inverse limit topology is the weak topology for probability measures, defined w.r.t. the product topology on O ω . We can now give the first definition of an instrumental reward function: a continuous affine function R : I S ω → R . Why affine? A convex linear combination of instrumental states is empirically indistinguishable from a probabilistic lottery. If we assign expected values to probabilistic lotteries (as we should by the VNM theorem), then we must also assign them to convex linear combinations of instrumental states: otherwise our reward again depends on entirely unobservable parameters of our model. An alternative approach is to consider the notion of "experiment" explicitly. We will use the notation X ≤ ω : = X ∗ ⊔ X ω . Given a logical condition ϕ , the symbol 1 ϕ will denote 1 when ϕ is true and 0 when ϕ is false. Definition 13 Given π : ( A × O ) ∗ k → A ⊔ { ⊥ } and μ ∈ I S ω , we define μ π ∈ Δ ( A × O ) ≤ ω by Pr a o ∼ μ π [ a n = a ∗ ] = E a o ∼ μ π [ 1 | a o | ≥ n π ( a ∗ | a o : n ) ] Pr a o ∼ μ π [ o n = o ∗ ] = E a o ∼ μ π [ 1 | a o | > n μ ( o ∗ | a o : n a n ) ] π is said to be a terminable policy when for any μ ∈ I S ω Pr h ∼ μ π [ | h | < ∞ ] = 1 That is, a terminable policy is allowed to produce a special token ⊥ which terminates the "experiment" (instead of choosing an action), and we require that, for any environment, this token will be eventually produced with probability 1. Definition 14 Given a terminable policy π and a bounded function r : ( A × O ) ∗ → R , we define the function R π r : I S ω → R by R π r ( μ ) : = E h ∼ μ π [ r ( h ) ] This gives us a second definition of instrumental reward functions. In fact, the two definitions are equivalent: Theorem 1 For any terminable policy π and bounded function r : ( A × O ) ∗ → R , R π r is continuous and affine. Conversely, for any continuous affine R : I S ω → [ 0 , 1 ] , there exists a terminable policy π and r : ( A × O ) ∗ → [ − 2 , 2 ] s.t. R = R π r . Putting the second part of the theorem into words, for any instrumental reward function (in the sense of the first definition) there is some experiment the agent can do which yields an unbiased estimate of the reward for the instrumental state that existed at the beginning of the experiment. The range [ − 2 , 2 ] is not optimal, but for the regret bound in the next subsection, it's only important that it is bounded by some fixed constant. To illustrate this concept of instrumental reward function, imagine that Clippy has access to a black box with a collection of levers on its outside. Pulling the levers produces some sounds that hint at what happens inside the box, but are not enough to determine it with certainty. The box has a shuttered glass window, whose shutter can be opened from the outside. Through the window, Clippy can see a jumble of scrap metal, mechanical manipulators that are controlled by the levers (and can be used to shape the scrap metal), and also a few mice running around the box and wreaking havoc. However, it is not possible to control the manipulators while the shutter is open. Worse, while opening the shutter allows seeing a snapshot of the shape of the metal, it also causes the manipulators to move chaotically, ruining this shape. So, Clippy can experiment with the levers and occasionally open the shutter to test the result. However, in order to produce and maintain paperclips inside the box, the shutter has to be kept closed (and the paperclips hidden) most of the time. It is also possible to consider reward functions of the more general form R : ( A × O ) ∗ × I S ω → R , required to be continuous and affine in the second argument. Such a reward function depends both on the current (unknown) instrumental state of the environment and the observable history so far. By Theorem 1, such a reward can be equivalently described in terms of a family { π h : ( A × O ) ∗ → A ⊔ { ⊥ } } h ∈ ( A × O ) ∗ of terminable policies and a family { r h : ( A × O ) ∗ → R } h ∈ ( A × O ) ∗ of bounded functions s.t. R ( h , μ ) = R π h r h ( μ ) This means that, the value of reward can be estimated empirically, but only if the agent remembers the entire observation history. If the history is forgotten at some point, it might never be able to estimate the reward again. We will such reward functions "semi-instrumental". Although semi-instrumental reward functions are more general than instrumental reward functions, I think that there is some interest in studying the narrower class. Arguably, instrumental reward functions are a better model of what counts as "consequentialist" or "goal-directed" behavior, since they depend only on the state of the environment. Indeed, it is easy to construct a semi-instrumental reward function that makes any given policy Bayes-optimal for any given prior, so semi-instrumental reward functions are incapable (without further assumptions) to distinguish between "intelligent" and "unintelligent" behavior. On the other hand, optimality w.r.t. some instrumental reward function seems like a stronger condition. In order to derive a regret bound, we will restrict attention to those reward functions for which the terminable policy can be made to terminate within time that has some finite and bounded expected value. I don't know an elegant way to characterize those reward functions in general, but we will describe one class of such functions. Definition 15 Consider any C ∈ C o n S e t . Then, we can define the total variation distance d tv : C × C → R by d tv ( x , y ) : = sup r ∈ M o r ( C , [ 0 , 1 ] ) | r ( x ) − r ( y ) | In general, d tv is a pseudometric. Moreover, when C is finite-dimensional and bounded, it is a metrization of the natural topology. For a finite set A and C = Δ A , d tv is just the usual total variation metric. For C a ball of unit diameter in Euclidean space, d tv is the Euclidean metric. Definition 16 Consider any λ ∈ ( 0 , 1 ) . We define the metric d λ tv on I S ω by d λ tv ( μ , ν ) : = sup n ∈ N λ n d tv ( p r ω n μ , p r ω n ν ) For any λ , d λ tv is a metrization of the inverse limit topology on I S ω . Proposition 5 Consider any λ ∈ ( 0 , 1 ) and R : I S ω → R affine and Lipschitz with respect to d λ tv . Then there is a terminable policy π and a bounded function r : ( A × O ) ∗ → R s.t. R = R π r and sup μ ∈ I S ω E h ∼ μ π [ | h | ] < ∞ Note that λ is a parameter reminiscent of geometric time discount that constraints the shape of the reward function. However, in the regret analysis that follows, it is not the same as the actual geometric time discount parameter γ . In particular, we consider the asymptotics in which the latter approaches 1, while the reward function is assumed to be fixed. It might be interesting to study regimes in which both approach 1, but we will not attempt it at present. A Regret Bound for RL with Instrumental Rewards Fix A and O . For any finite set S and T : S × A k → S × O , there is a unique mapping I T : S → I S ω s.t. I T ( s ) a o = ( ∑ s ′ ∈ S T ( s ′ , o ∣ ∣ s , a ) I T ( s ′ ) , ∑ s ′ ∈ S T ( s ′ , o ∣ ∣ s , a ) ) That is, I T ( s ) is just the instrumental state corresponding to the POMDP state s . Given R : I S ω → R continuous affine, we get for any S and T the POMDP reward function R ∘ I T . Hence, one natural setting for regret analysis is fixing R and S and considering a hypothesis class of transition kernels H ⊆ { S × A k → S × O } However, regret analysis for POMDPs involves some technical complexity, and we prefer to start with a simpler setting. Hopefully, we will address the POMDP case in a followup essay. Suppose that O = S . Then, given any MPD transition kernel T : S × A k → S , we can define the POMDP transition kernel T ♯ : S × A k → S × O by T ♯ ( s ′ , s ′′ ∣ ∣ s , a ) : = 1 s ′ = s ′′ T ( s ′ ∣ ∣ s , a ) Fix R : S × I S ω → [ 0 , 1 ] continuous affine in the second argument (a type of semi-instrumental reward function). For any T as above, we get the induced reward function R T : S → [ 0 , 1 ] given by R T ( s ) : = R ( s , I T ♯ ( s ) ) . We can now consider the learning problem corresponding to a hypothesis class of MDP transition kernels H ⊆ { S × A k → S } It might seem odd to consider a setting with fully observable states in the context of imperceptible rewards. However, we can think about it as follows: what we observe is only a label whose physical meaning is unknown. Only given the (unknown) transition kernel, such a label can be interpreted as assigned a reward. For example, imagine a robot tasked with sorting balls into bins according to their weight. Some of the balls are solid gold and some of them are solid silver, so it's in principle possible to know their weight just by looking at them. However, the robot doesn't know a priori whether silver or gold is heavier. On the other hand, the robot can perform some experiment with a ball to determine its weight. In this situation, the reward is imperceptible even if the state (e.g. the locations, colors and sizes of the balls, the locations and shapes of the bins and the location of the robot and the state of its manipulators) is fully observable. Using the concepts of MB dimension and RVO dimension we defined in a previous essay , we can formulate the regret bound. Theorem 2 There is some C ∈ R + s.t. the following holds. Consider any finite non-empty sets S and A , function continuous affine in the second argument R : S × I S ω → [ 0 , 1 ] , closed set H ⊆ { S × A k → S } and Borel probability measure ζ on H (prior). Suppose π e s t : S × ( A × S ) ∗ k → A ⊔ { ⊥ } is s.t. for any s ∈ S , π e s t ( s , ⋅ ) is terminable, and r : S × ( A × S ) ∗ → [ 0 , 1 ] is a bounded function s.t. R ( s , ⋅ ) = R π e s t ( s , ⋅ ) r ( s , ⋅ ) Define the maximal expected reward estimation time t e s t by t e s t = sup s ∈ S , μ ∈ I S ω E h ∼ μ π e s t ( s , ⋅ ) [ | h | ] Define the maximal bias span τ by τ : = lim sup γ → 1 max T ∈ H max s ∈ S V T R T ( s , γ ) − min s ∈ S V T R T ( s , γ ) 1 − γ Define H R ⊆ { S → R } by H R : = { R T | T ∈ H } Denote D M B : = dim M B H R and D R V O : = dim R V O H R . Define the Bayesian regret R ( γ ) by R ( γ ) : = E T ∼ ζ [ E U ∗ T R T ( γ ) − E U π † γ T R T ( γ ) ] Then, there is a family of policies { π † γ : S ∗ × S k → A } γ ∈ ( 0 , 1 ) s.t. lim sup γ → 1 R ( γ ) 3 √ ( τ + t e s t ) ( D M B + 1 ) ( D R V O + 1 ) ( 1 − γ ) ln 1 1 − γ ≤ C Discussion More on the Regret Bound It might appear odd that the regret bound in Theorem 2 depends on the dimensions of the class of reward functions, but not on the dimensions on the class of transition kernels, like in the perceptible case. The reason for this is that we only give the asymptotic form. Asymptotically, the leading term is O ( 3 √ ( 1 − γ ) ln 1 1 − γ ) and its coefficient depends only on those parameters that appear in Theorem 2. However, examining the proof reveals that there is also an O ( √ ( 1 − γ ) ln 1 1 − γ ) term that has the same form as the regret bound in the perceptible case. For the sake of brevity and simplicity we will not attempt to write down a more precise regret bound that reflects the role of the dimensions of the class of transition kernels, but in principle it is not difficult. We must keep in mind, however, that in practice the other term might be significant: a priori the dimensions of the class of transition kernels are only bounded by a polynomial in | S | and | A | and the latter might be exponentially big for realistic models. The Death of the Agent and Kamikaze Strategies There is one potential application of defining rewards that are not a direct function of observations which seems not supported by instrumental rewards as we defined them. Namely, one can imagine agents that are motivated to follow a certain strategy that is designed to destroy the agent but produce some desirable results in the external world ("kamikaze strategy"). In other words, although survival is a convergent instrumental goal, it seems entirely reasonable for it to be sacrificed in certain specific scenarios. To give an example, imagine a bodyguard robot whose primary goal is keeping a certain person alive. If assassins shoot at the person, and the only wait to stop them is for the robot to block the bullets with its body, then it can be the optimal strategy, even if it will destroy the robot and prevent it from continuing its function as bodyguard (assuming that e.g. it will give the person a chance to escape or someone else a chance to stop the assassins). Our formalism doesn't directly address the possibility of the agent's death, because the sequence of actions and observations is assumed to be infinite. One simple way to accommodate death is postulating a special observation ⊥ ∈ O s.t. it is never received before death and always received after death. If we do this, then death corresponds to a specific instrumental state and therefore its reward is a fixed constant. This seems incompatible with kamikaze strategies where the decision of self-sacrifice is contingent on conditions in the external world after death. Another approach is assuming the agent becomes a "ghost": it keeps receiving observations which reflect the actual physical world but its actions have no effect. Such ghosts might theoretically be produced by a simplicity prior: for example, if the agent is an AI connected to a camera that monitors a room, then we can imagine a virtual video of the same room continuing beyond the AI's shutdown. This allows for different instrumental states after death and can potentially justify kamikaze strategies, but it seems like a very fragile construct and is unlikely to guarantee reasonable behavior. The problem with death can be viewed from another perspective: our regret analysis assumes a no-traps condition ( τ < ∞ ) whereas death is usually a trap. Therefore, to guarantee rational behavior while accounting for death, we need to operate within a framework that allows for traps. One such framework is requiring Bayes-optimality and giving up on learnability. This seems both too weak (because nothing is guaranteed for specific environments) and too strong (because it's computationally intractable ). That said, I think this approach can be salvaged by requiring something somewhat weaker than Bayes-optimality and proving something somewhat weaker than learnability (hopefully I will write on that in a future essay). In any case, once we give up on learnability we can allow unobservable rewards (the general POMDP setting in the beginning of the Results section) which allow handling death and kamikaze strategies easily. Specifically, we can have a plethora of "dead" states that produce only the ⊥ observation and whose transitions do no depend on the action, but which have different rewards. So, this approach "solves" the problem but at a high cost: no learnability or regret analysis. Another framework for dealing with traps is Delegative Reinforcement Learning (DRL). In DRL the agent interacts with an external advisor, and is thereby able to successfully navigate all traps that the advisor knows about. In other words, it converges to a policy that is Bayes-optimal with respect to the belief state of the advisor (while the advisor is not able to produce such a policy by itself). Combining DRL with the instrumental rewards formalism should allow accounting for death. Specifically, in any given POMDP hypothesis, the state space will be decomposed as S = S dead ⊔ S alive , with the following assumptions: The transition kernel on states in S dead doesn't depend on the action. S dead is invariant under the dynamics (death is irreversible). The reward function on S dead can be arbitrary. The reward function on S alive has to factor through I T (i.e. depend only on the instrumental state), and moreover the policy for estimating the reward function is known to be safe (alternatively, we might let the agent learn a safe estimation policy from some space of candidate policies). Under these assumptions (or some variant thereof), it seems plausible that we should be able to prove learnability and derive a reasonable regret bound. Formalizing this line of thought is a task for future work. The DRL approach to kamikaze strategies also has implications on corrigibility. Indeed, if the external advice is compatible with an admissible reward function that recommends shutting down the agent (i.e. upon delegation, the advisor acts to shut down the agent) then a DRL agent will assist with its own shutdown.
This property is preserved by subagents, since creating a subagent is another potentially irreversible action (and therefore must be vetted by the advisor). Also, it is tempting to speculate about DRL as a model of human self-sacrifice. We have already speculated before that we can view DRL as model of human learning, where the human's social environment or humanity as a whole is regarded as playing the role of the advisor. Similarly, humans that sacrifice their lives for the sake of their loved ones or the "greater good" can be regarded as heeding that "advise" regarding the rewards of states in which the human doesn't exist. Under this model, we can make sense of self-sacrifices by individual humans but not of hypothetical self-sacrifice by humanity as a whole (potentially augmented by other minds with which we could communicate and find common ground), but, the latter restriction seems compatible with intuition. Specifying Instrumental Reward Functions It might be useful to find natural ways to specify instrumental reward functions. In particular, it is interesting to start with a reward function defined on a specific ontology (POMDP) and somehow extend it to a full instrumental reward function (which, like we said before, induces a reward function on any ontology via the I T mapping). De Blanc suggests one way to extend reward functions from one POMDP to another, but I don't know whether this operation leads to an instrumental reward function, i.e. whether it is compatible with the constraints imposed by affine dependencies between the states (and I don't see any reason why it should). Essentially, what we're looking for is a way to extend an affine function from an affine subspace to the entire affine space (the affine subspace is the affine span of the instrumental states corresponding to the states of the initial ontology; note that, if these instrumental states are not affine independent, then we have some constraint on this initial reward function). One natural way to do it is looking for an affine function whose differential (the linear function part) has minimal norm, or choosing some privileged projection operator from the entire space to the affine subspace. However, since the natural norms we have here are not inner product norms, these choices are usually non-unique, and it's possible we can't get much out of it. A different natural approach is using Occam's razor, i.e. looking for an extension of minimal description length or the expected value of a random extension sampled from a conditional simplicity prior. This requires a natural way to describe instrumental reward functions. We do have such a way: assuming that the π and r guaranteed to exist by Theorem 1 can be chosen to be computable , the description is the program for those objects with respect to a fixed universal Turing machine (we consider a single program that computes both π and r to exploit possible mutual information between the two). These questions are left for future research. Proofs Proof of Proposition 1 We proceed by induction on n . For n = 0 there is nothing to prove since I S 0 = p t so θ = θ ′ a priori. Now, suppose n > 0 . We need to show that for any a ∗ ∈ A and o ∗ ∈ O , θ a ∗ o ∗ = θ ′ a ∗ o ∗ . To show it for given a ∗ and o ∗ , we consider some π s.t. π ( λ ) = a ∗ . Since θ π = θ ′ π , we have Pr a o ∼ θ π [ o 0 = o ∗ ] = Pr a o ∼ θ ′ π [ o 0 = o ∗ ] By Definition 7, we get, θ ( o ∗ | a ∗ ) = θ ′ ( o ∗ | a ∗ ) By Definition 6, we get, h I S n − 1 ( θ a ∗ o ∗ ) = h I S n − 1 ( θ ′ a ∗ o ∗ ) If this value vanishes then θ a ∗ o ∗ = θ ′ a ∗ o ∗ = 0 . Otherwise, consider any σ : ( A × O ) < n − 1 → A and define π : ( A × O ) < n → A by π ( λ ) : = a ∗ π ( a o h ) : = σ ( h ) Definitions 6 and 7 imply that [ θ a ∗ o ∗ ] σ ( h ) = θ π ( a ∗ o ∗ h ) θ ( o ∗ | a ∗ ) and similarly for θ ′ . We have θ π = θ ′ π and θ ( o ∗ | a ∗ ) = θ ′ ( o ∗ | a ∗ ) , which implies [ θ a ∗ o ∗ ] σ = [ θ ′ a ∗ o ∗ ] σ . By the induction hypothesis, we get [ θ a ∗ o ∗ ] = [ θ ′ a ∗ o ∗ ] . Combining this with h I S n − 1 ( θ a ∗ o ∗ ) = h I S n − 1 ( θ ′ a ∗ o ∗ ) , we get θ a ∗ o ∗ = θ ′ a ∗ o ∗ . ■ Proposition A.1 Consider any C ∈ C o n S e t , θ , θ ′ ∈ Cone C and p ∈ [ 0 , 1 ] . Assume that h C ( p θ + ( 1 − p ) θ ′ ) > 0 Then [ p θ + ( 1 − p ) θ ′ ] = p h C ( θ ) [ θ ] + ( 1 − p ) h C ( θ ′ ) [ θ ′ ] p h C ( θ ) + ( 1 − p ) h C ( θ ′ ) Here, h C ( θ ) [ θ ] is understood to mean 0 when h C ( θ ) = 0 and the same for θ ′ . Proof of Proposition A.1 Obvious from the definitions. Proof of Proposition 2 Given n ∈ N + and some α , β ∈ Δ ( A × O ) n , to show that α = β it is sufficient to show that For any a ∗ ∈ A and o ∗ ∈ O , Pr a o ∼ α [ a o : 1 = a ∗ o ∗ ] = Pr a o ∼ β [ a o : 1 = a ∗ o ∗ ] For any a ∗ ∈ A and o ∗ ∈ O , if Pr a o ∼ α [ a o : 1 = a ∗ o ∗ ] > 0 then for any h ∈ ( A × O ) n − 1 Pr a o ∼ α [ a o = a ∗ o ∗ h | a o : 1 = a ∗ o ∗ ] = Pr a o ∼ β [ a o = a ∗ o ∗ h | a o : 1 = a ∗ o ∗ ] We will use this to prove the claim by induction on n . For n = 0 , there is nothing to prove. For n > 0 , by Definition 7 Pr a o ∼ ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = π ( a ∗ | λ ) ( p θ + ( 1 − p ) θ ′ ) ( o ∗ | a ∗ ) By Definition 6 Pr a o ∼ ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = π ( a ∗ | λ ) h I S n − 1 ( ( p θ + ( 1 − p ) θ ′ ) a ∗ o ∗ ) Pr ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = p π ( a ∗ | λ ) h ( θ a ∗ o ∗ ) + ( 1 − p ) π ( a ∗ | λ ) h ( θ ′ a ∗ o ∗ ) Pr ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = p π ( a ∗ | λ ) θ ( o ∗ | a ∗ ) + ( 1 − p ) π ( a ∗ | λ ) θ ′ ( o ∗ | a ∗ ) Pr ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = p Pr θ π [ a o : 1 = a ∗ o ∗ ] + ( 1 − p ) Pr θ ′ π [ a o : 1 = a ∗ o ∗ ] Pr ( p θ + ( 1 − p ) θ ′ ) π [ a o : 1 = a ∗ o ∗ ] = Pr p θ π + ( 1 − p ) θ π [ a o : 1 = a ∗ o ∗ ] Furthermore, Definitions 6 and 7 imply that Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a o : 1 = a ∗ o ∗ ] = Pr [ ( p θ + ( 1 − p ) θ ′ ) a ∗ o ∗ ] σ [ h ] Here, σ is defined by σ ( h ) : = π ( a ∗ o ∗ h ) . Denote q : = p h ( θ a ∗ o ∗ ) p h ( θ a ∗ o ∗ ) + ( 1 − p ) h ( θ ′ a ∗ o ∗ ) By Proposition A.1 [ ( p θ + ( 1 − p ) θ ′ ) a ∗ o ∗ ] = q [ θ a ∗ o ∗ ] + ( 1 − q ) [ θ ′ a ∗ o ∗ ] We get Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a o : 1 = a ∗ o ∗ ] = Pr ( q [ θ a ∗ o ∗ ] + ( 1 − q ) [ θ ′ a ∗ o ∗ ] ) σ [ h ] By the induction hypothesis, we get Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a o : 1 = a ∗ o ∗ ] = Pr q [ θ a ∗ o ∗ ] σ + ( 1 − q ) [ θ ′ a ∗ o ∗ ] σ [ h ] Decomposing the right hand side and applying the same reasoning in reverse, Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a ∗ o ∗ ] = q Pr θ π [ a ∗ o ∗ h | a ∗ o ∗ ] + ( 1 − q ) Pr θ ′ π [ a ∗ o ∗ h | a ∗ o ∗ ] By Definition 6, q can be written as q = p θ ( o ∗ | a ∗ ) p θ ( o ∗ | a ∗ ) + ( 1 − p ) θ ′ ( o ∗ | a ∗ ) Multiplying the numerator and denominator by π ( a ∗ | λ ) , we get q = p π ( a ∗ | λ ) θ ( o ∗ | a ∗ ) p π ( a ∗ | λ ) θ ( o ∗ | a ∗ ) + ( 1 − p ) π ( a ∗ | λ ) θ ′ ( o ∗ | a ∗ ) q = p Pr θ π [ a ∗ o ∗ ] p Pr θ π [ a ∗ o ∗ ] + ( 1 − p ) Pr θ ′ π [ a ∗ o ∗ ] Combining this with the previous identity, we get … = p Pr θ π [ a ∗ o ∗ ] Pr θ π [ a ∗ o ∗ h | a ∗ o ∗ ] + ( 1 − p ) Pr θ ′ π [ a ∗ o ∗ ] Pr θ ′ π [ a ∗ o ∗ h | a ∗ o ∗ ] p Pr θ π [ a ∗ o ∗ ] + ( 1 − p ) Pr θ ′ π [ a ∗ o ∗ ] Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a ∗ o ∗ ] = p Pr θ π [ a ∗ o ∗ h ] + ( 1 − p ) Pr θ ′ π [ a ∗ o ∗ h ] p Pr θ π [ a ∗ o ∗ ] + ( 1 − p ) Pr θ ′ π [ a ∗ o ∗ ] Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a ∗ o ∗ ] = Pr p θ π + ( 1 − p ) θ ′ π [ a ∗ o ∗ h ] Pr p θ π + ( 1 − p ) θ ′ π [ a ∗ o ∗ ] Pr ( p θ + ( 1 − p ) θ ′ ) π [ a ∗ o ∗ h | a ∗ o ∗ ] = Pr p θ π + ( 1 − p ) θ ′ π [ a ∗ o ∗ h | a ∗ o ∗ ] ■ Given μ ∈ Δ X ω and f : X ω → X n defined by f ( x ) : = x : n , we will denote μ : n : = f ∗ μ . Proposition A.2 Consider any C , D ∈ C o n S e t and f ∈ M o r ( C , D ) . Then, h D ∘ Cone f = h C Proof of Proposition A.2 Obvious from the definitions. Proposition A.3 Consider any C , D ∈ C o n S e t , f ∈ M o r ( C , D ) and θ ∈ Cone C ∖ 0 . Then, [ ( Cone f ) ( θ ) ] = f ( [ θ ] ) Proof of Proposition A.3 Obvious from the definitions. Proposition A.4 Consider any n ∈ N , θ ∈ I S n + 1 , a ∈ A and h ∈ dom θ s.t. | h | < n . Then, p r n ( θ ) ( h a ) = θ ( h a ) Proof of Proposition A.4 We prove the claim by induction on n . For n = 0 , there is nothing to prove. Assume n > 0 . For h = λ , we have p r n ( θ ) ( o | a ) = h ( p r n ( θ ) a o ) = h ( ( Cone p r n − 1 ) ( θ a o ) ) By Proposition A.2 p r n ( θ ) ( o | a ) = h ( θ a o ) = θ ( o | a ) Now suppose that h = a ′ o ′ h ′ . We get p r n ( θ ) ( a ′ o ′ h ′ a ) = [ p r n ( θ ) a ′ o ′ ] ( h ′ a ) = [ ( Cone p r n − 1 ) ( θ a ′ o ′ ) ] ( h ′ a ) By Proposition A.3 p r n ( θ ) ( a ′ o ′ h ′ a ) = p r n − 1 [ θ a ′ o ′ ] ( h ′ a ) Using the induction hypothesis p r n ( θ ) ( a ′ o ′ h ′ a ) = [ θ a ′ o ′ ] ( h ′ a ) = θ ( a ′ o ′ h ′ a ) ■ Proof of Proposition 3 Proposition A.4 implies that, in Definition 11, we can replace | h | + 1 by any m ≥ | h | + 1 . Therefore, for any n ∈ N , ( p r ω n μ ) π = μ π : n . Hence, μ π = μ ′ π implies that ( p r ω n μ ) π = ( p r ω n μ ′ ) π . By Proposition 1, we get p r ω n μ = p r ω n μ ′ , and therefore μ = μ ′ . ■ Proof of Proposition 4 For any n ∈ N , Proposition 2 implies that ( p ⋅ p r ω n μ + ( 1 − p ) ⋅ p r ω n μ ′ ) π = p ( p r ω n μ ) π + ( 1 − p ) ( p r ω n μ ′ ) π p r ω n is an affine mapping, therefore p r ω n ( p μ + ( 1 − p ) μ ′ ) π = p ( p r ω n μ ) π + ( 1 − p ) ( p r ω n μ ′ ) π Using Proposition A.4 ( p μ + ( 1 − p ) μ ′ ) π : n = p μ π : n + ( 1 − p ) μ ′ π : n = ( p μ π + ( 1 − p ) μ ′ π ) : n Since this holds for any n , we must have that ( p μ + ( 1 − p ) μ ′ ) π = p μ π + ( 1 − p ) μ ′ π ■ Proposition A.5 For any terminable policy π lim n → ∞ sup μ ∈ I S ω Pr h ∼ μ π [ | h | > n ] = 0 Proof of Proposition A.5 Assume to the contrary that there is ϵ ∈ ( 0 , 1 ) and sequences { n k ∈ N } k ∈ N and { μ k ∈ I S ω } k ∈ N s.t. n k + 1 > n k and, for any k ∈ N Pr h ∼ μ k π [ | h | > n k ] > ϵ I S ω is compact, therefore { μ k } has a convergent subsequence. Without loss of generality, we can assume that { μ k } itself converges and denote μ ∗ : = lim k → ∞ μ k . For any k ∈ N and j > k , we have n k < n j and therefore Pr h ∼ μ j π [ | h | > n k ] ≥ Pr h ∼ μ j π [ | h | > n j ] > ϵ Using Proposition A.4, it follows that Pr h ∼ p r ω n k + 1 ( μ j ) π [ | h | > n k ] > ϵ The right hand side is clearly continuous in p r ω n k + 1 ( μ j ) , and the latter converges to p r ω n k + 1 ( μ ∗ ) as j goes to ∞ . We get Pr h ∼ μ ∗ π [ | h | > n k ] = Pr h ∼ p r ω n k + 1 ( μ ∗ ) π [ | h | > n k ] > ϵ Since this holds for any k , it follows that Pr h ∼ μ ∗ π [ | h | = ∞ ] = lim k → ∞ Pr h ∼ μ ∗ π [ | h | > n k ] ≥ ϵ This contradicts the assumption that π is terminable. ■ Proposition A.6 Consider { X n } n ∈ N a sequence of compact Polish spaces, and { p r n : X n + 1 → X n } n ∈ N continuous mappings. Denote X ω : = lim ← − n X n Denote p r ω n : X ω → X n the canonical mapping. Let f : X → R be continuous. Then, lim n → ∞ sup x ∈ X n x 1 , 2 ∈ ( p r ω n ) − 1 ( x ) | f ( x 1 ) − f ( x 2 ) | = 0 Proof of Proposition A.6 Assume to the contrary that there is ϵ ∈ R + , and sequences { n k ∈ N } k ∈ N , { x k 1 , x k 2 ∈ X ω } k ∈ N s.t. n k + 1 > n k , p r ω n k ( x k 1 ) = p r ω n k ( x k 2 ) and f ( x k 1 ) − f ( x k 2 ) > ϵ . Without loss of generality, we assume that n k = k and the limits x ∗ 1 , 2 : = lim n → ∞ x n 1 , 2 exist (the latter using the fact X ω is compact by Tychonoff's theorem). It follows that f ( x ∗ 1 ) − f ( x ∗ 2 ) ≥ ϵ , and in particular x ∗ 1 ≠ x ∗ 2 and therefore there is m ∈ N s.t. p r ω m ( x ∗ 1 ) ≠ p r ω m ( x ∗ 2 ) . On the other hand, p r ω n ( x n 1 ) = p r ω n ( x n 2 ) , implying that, for n ≥ m , p r ω m ( x n 1 ) = p r ω m ( x n 2 ) and therefore p r ω m ( x ∗ 1 ) = p r ω m ( x ∗ 2 ) , a contradiction. ■ Proposition A.7 Let V be a finite-dimensional normed vector space and W ⊆ V ∗ a linear subspace. Suppose v ∈ V and ϵ ∈ R + are s.t. for any α ∈ W , | α ( v ) | ≤ ϵ ∥ α ∥ . Then, there is v ′ ∈ W ⊥ ⊆ V s.t. ∥ v − v ′ ∥ ≤ ϵ . In the above, ∥ α ∥ refers to the standard dual norm on V ∗ , induced by the norm on V . W ⊥ refers to the set { v ∈ V | ∀ α ∈ W : α ( v ) = 0 } . Proof of Proposition A.7 Consider v ∗ ∈ W ∗ defined by v ∗ ( α ) : = α ( v ) . By the assumption about v , ∥ v ∗ ∥ ≤ ϵ . By the Hahn-Banach theorem, there is u ∗ ∈ V ∗ ∗ s.t. u ∗ | W = v ∗ and ∥ u ∗ ∥ ≤ ϵ . Using the canonical isomorphism V ≅ V ∗ ∗ , u ∗ corresponds to some u ∈ V , and it follows that ∥ u ∥ ≤ ϵ and for any α ∈ W , α ( u ) = α ( v ) . We now take v ′ : = v − u . ■ Proposition A.8 Let C , D ∈ C o n S e t , f ∈ M o r ( C , D ) and r ∈ M o r ( C , R ) . Assume D is a bounded closed finite-dimensional polytope, and f is onto (as a mapping). Suppose ϵ ∈ R + s.t. for any x 1 , 2 ∈ C , if f ( x 1 ) = f ( x 2 ) then | r ( x 1 ) − r ( x 2 ) | ≤ ϵ . Then, there exists r ′ ∈ M o r ( D , R ) s.t. for any x ∈ C ∣ ∣ r ( x ) − r ′ ( f ( x ) ) ∣ ∣ ≤ 3 2 ϵ Proof of Proposition A.8 Let X be the vector space correspond to C , let Y be the vector space corresponding to D (so that C ⊆ X and D ⊆ Y ) and let Q be the (finite) set of vertices of D . Since f is onto, we can choose some g : Q → C s.t. for any q ∈ Q , f ( g ( q ) ) = q . Define v ∈ R Q by v q : = r ( g ( q ) ) . Let R Q 0 be the linear subspace of R Q given by R Q 0 : = ⎧ ⎨ ⎩ u ∈ R Q ∣ ∣
∣ ∣ ∑ q ∈ Q u q = 0 ⎫ ⎬ ⎭ Define the linear operators A : R Q → X and B : R Q → Y by A u : = ∑ q ∈ Q u q g ( q ) B u : = ∑ q ∈ Q u q q Consider any w ∈ ker B ∩ R Q 0 ∖ 0 . In particular, w ∈ R Q 0 and therefore 0 = ∑ q ∈ Q w q = ∑ q ∈ Q 1 w q > 0 w q + ∑ q ∈ Q 1 w q < 0 w q Also ∥ w ∥ 1 = ∑ q ∈ Q | w q | = ∑ q ∈ Q 1 w q > 0 w q − ∑ q ∈ Q 1 w q < 0 w q Combining the last two identities, we conclude ∑ q ∈ Q 1 w q > 0 w q = − ∑ q ∈ Q 1 w q < 0 w q = ∥ w ∥ 1 2 Using the assumption w ≠ 0 , this allows us to define w + , w − ∈ Δ Q by w + q : = 2 ∥ w ∥ 1 1 w q > 0 w q w − q : = − 2 ∥ w ∥ 1 1 w q < 0 w q We have w = 1 2 ∥ w ∥ 1 ( w + − w − ) . Also, B w = 0 and therefore B w + = B w − . Now, for any u ∈ Δ Q , we have u ⋅ v = ∑ q ∈ Q u q v q = ∑ q ∈ Q u q r ( g ( q ) ) = r ⎛ ⎝ ∑ q ∈ Q u q g ( q ) ⎞ ⎠ = r ( A u ) Moreover, f ( A u ) = f ⎛ ⎝ ∑ q ∈ Q u q g ( q ) ⎞ ⎠ = ∑ q ∈ Q u q f ( g ( q ) ) = ∑ q ∈ Q u q q = B u It follows that w ⋅ v = 1 2 ∥ w ∥ 1 ( w + ⋅ v − w − ⋅ v ) = 1 2 ∥ w ∥ 1 ( r ( A w + ) − r ( A w − ) ) By our previous reasoning, f ( A w + ) = B w + = B w − = f ( A w − ) . Therefore, we can use the assumption on r to conclude that | w ⋅ v | = 1 2 ∥ w ∥ 1 ∣ ∣ r ( A w + ) − r ( A w − ) ∣ ∣ ≤ ϵ 2 ∥ w ∥ 1 By Proposition A.7, it follows that there is some v ′ ∈ R Q s.t. v ′ ∈ ( ker B ∩ R Q 0 ) ⊥ and ∥ v − v ′ ∥ ∞ ≤ ϵ 2 (the L ∞ norm is dual to the L 1 norm). Now, consider some y ∈ D . There is some u ∈ Δ Q s.t. y = B u . We define r ′ ( y ) : = u ⋅ v ′ . To see this definition is unambiguous, consider some u ′ ∈ Δ Q s.t. also y = B u ′ . In particular, B ( u − u ′ ) = 0 and therefore u − u ′ ∈ ker B . Moreover, u − u ′ ∈ R Q 0 since u , u ′ ∈ Δ Q . Using that u − u ′ ∈ ker B ∩ R Q 0 and v ′ ∈ ( ker B ∩ R Q 0 ) ⊥ , we get u ⋅ v ′ − u ′ ⋅ v ′ = ( u − u ′ ) ⋅ v ′ = 0 It is easy to see that r ′ is affine. Finally, consider any x ∈ C . Choose u ∈ Δ Q s.t. f ( x ) = B u . We have ∣ ∣ r ( x ) − r ′ ( f ( x ) ) ∣ ∣ ≤ ∣ ∣ r ( x ) − r ( A u ) ∣ ∣ + ∣ ∣ r ( A u ) − r ′ ( f ( x ) ) ∣ ∣ Since f ( A u ) = B u , we can use the assumption on r to bound the first term on the right hand side: ∣ ∣ r ( x ) − r ( A u ) ∣ ∣ ≤ ϵ For the second term, we have ∣ ∣ r ( A u ) − r ′ ( f ( x ) ) ∣ ∣ = ∣ ∣ u ⋅ v − u ⋅ v ′ ∣ ∣ = ∣ ∣ u ⋅ ( v − v ′ ) ∣ ∣ ≤ ∥ u ∥ 1 ∥ ∥ v − v ′ ∥ ∥ ∞ ≤ ϵ 2 Combining the two, we conclude ∣ ∣ r ( x ) − r ′ ( f ( x ) ) ∣ ∣ ≤ 3 2 ϵ ■ Proposition A.9 Let A be a finite set, C ∈ C o n S e t and R ∈ M o r ( C A , [ 0 , 1 ] ) . Assume R attains its infimum at some point θ ∗ ∈ C A . Then, there exist π ∈ Δ A and r : A → M o r ( C , [ 0 , 1 ] ) s.t. for any θ ∈ C A R ( θ ) = E a ∼ π [ r ( a , θ a ) ] Here, we used implicit currying: r ( a , x ) : = r ( a ) ( x ) . Proof of Proposition A.9 For each a ∈ A , define ι a ∈ M o r ( C , C A ) by ι a ( x ) b : = { x if a = b θ ∗ b if a ≠ b Denote R a : = R ∘ ι a and N a : = sup R a − inf R a . If N a vanishes for every a ∈ A , then R is constant, so we can set r to the same constant and take arbitrary π . Otherwise, we define π and r by π a : = N a ∑ b ∈ A N b r ( a , x ) : = R ( θ ∗ ) + ∑ b ∈ A N b N a ( R a ( x ) − R ( θ ∗ ) ) We need to show that r takes values in [ 0 , 1 ] . It is non-negative since R is minimal at θ ∗ , so both terms in r are non-negative. To see it is not greater than 1 , observe that r ( a , x ) = R ( θ ∗ ) + ∑ b ∈ A N b N a ( R a ( x ) − R ( θ ∗ ) ) ≤ inf R + ∑ b ∈ A N b N a ( sup R a − inf R ) Clearly inf R = inf R a and therefore sup R a − inf R = N a . It is also easy to see that, since R is affine, sup R − inf R = ∑ b ∈ A N b . We get r ( a , x ) ≤ inf R + ∑ b ∈ A N b N a N a = inf R + ∑ b ∈ A N b = sup R ≤ 1 It remains to show that R ( θ ) = E a ∼ π [ r ( a , θ a ) ] . We have E a ∼ π [ r ( a , θ a ) ] = ∑ a ∈ A π a r ( a , θ a ) E a ∼ π [ r ( a , θ a ) ] = ∑ a ∈ A π a ( R ( θ ∗ ) + ∑ b ∈ A N b N a ( R a ( θ a ) − R ( θ ∗ ) ) ) E a ∼ π [ r ( a , θ a ) ] = ∑ a ∈ A π a R ( θ ∗ ) + ∑ a ∈ A π a ∑ b ∈ A N b N a ( R a ( θ a ) − R ( θ ∗ ) ) E a ∼ π [ r ( a , θ a ) ] = R ( θ ∗ ) + ∑ a ∈ A N a ∑ b ∈ A N b ⋅ ∑ b ∈ A N b N a ( R a ( θ a ) − R ( θ ∗ ) ) E a ∼ π [ r ( a , θ a ) ] = R ( θ ∗ ) + ∑ a ∈ A ( R a ( θ a ) − R ( θ ∗ ) ) Using the fact R is affine, the desired conclusion follows. ■ Proposition A.10 Consider any n ∈ N and R ∈ M o r ( I S n , [ 0 , 1 ] ) . Then, there exist π : ( A × O ) < n k → A and r : ( A × O ) n → [ 0 , 1 ] s.t. for any θ ∈ I S n R ( θ ) = E θ π [ r ] Proof of Proposition A.10 We proceed by induction on n . For n = 0 , R is constant and we set r to the same constant. Now, suppose n > 0 . Define I S n − 1 2 ∈ C o n S e t by I S n − 1 2 : = ( ∏ o ∈ O h I S n − 1 ) − 1 ( Δ O ) Using Proposition A.9, we get π 0 ∈ Δ A and r 0 : A → M o r ( I S n − 1 2 , [ 0 , 1 ] ) s.t. for any θ ∈ I S n R ( θ ) = E a ∼ π 0 [ r 0 ( a , θ a ) ] For every o ∈ O , we define j o ∈ M o r ( I S n − 1 , I S n − 1 2 ) by j o ( θ ) o ′ : = { ( θ , 1 ) if o = o ′ 0 if o ≠ o ′ For every a ∈ A and o ∈ O , we apply the induction hypothesis to r 0 ( a ) ∘ j o , and get π a o : ( A × O ) < n − 1 k → A and r a o : ( A × O ) n − 1 → [ 0 , 1 ] s.t. for any θ ∈ I S n − 1 r 0 ( a , j o ( θ ) ) = E θ π a o [ r a o ] We now define π and r by π ( λ ) : = π 0 π ( a o h ) : = π a o ( h ) r ( a o h ) : = r a o ( h ) Now, observe that, for any θ ∈ I S n E h ∼ θ π [ r ( h ) ] = E a ∼ π 0 o ∼ θ ( a ) [ E h ′ ∼ [ θ a o ] π a o [ r a o ( h ′ ) ] ] = E a ∼ π 0 o ∼ θ ( a ) [ r 0 ( a , j o [ θ a o ] ) ] Using the fact that r 0 is affine in the second argument, we get E h ∼ θ π [ r ( h ) ] = E a ∼ π 0 [ r 0 ( a , E o ∼ θ ( a ) [ j o [ θ a o ] ] ) ] Moreover, using Definition 6 and the definition of j 0 , we get E o ∼ θ ( a ) [ j o [ θ a o ] ] = ∑ o ∈ O h ( θ a o ) ⨁ o ′ ∈ O ( 1 o ′ = o θ a o , 1 o ′ = o ) E o ∼ θ ( a ) [ j o [ θ a o ] ] = ⨁ o ′ ∈ O ( ∑ o ∈ O h ( θ a o ) 1 o ′ = o θ a o , ∑ o ∈ O h ( θ a o ) 1 o ′ = o ) E o ∼ θ ( a ) [ j o [ θ a o ] ] = ⨁ o ′ ∈ O ( h ( θ a o ′ ) θ a o ′ , h ( θ a o ′ ) ) = ⨁ o ′ ∈ O θ a o ′ = θ a Combining this with the previous identity, we get E h ∼ θ π [ r ( h ) ] = E a ∼ π 0 [ r 0 ( a , θ a ) ] = R ( θ ) ■ Proposition A.11 Consider some α ∈ Δ N and sequences { π k : ( A × O ) ∗ k → A ⊔ { ⊥ } } k ∈ N { r k : ( A × O ) ∗ → [ 0 , 1 ] } k ∈ N Assume π k is a terminable policy for every k ∈ N . Then, there is π a terminable policy and r : ( A × O ) ∗ → [ 0 , 1 ] s.t. R π r = E k ∼ α [ R π k r k ] Proof of Proposition A.11 Define π and r by setting, for any n ∈ N and a o ∈ ( A × O ) n π ( a o ) : = E n ∼ α [ ∏ n − 1 m = 0 π n ( a m | a o : m ) ⋅ π n ( a o ) ] E n ∼ α [ ∏ n − 1 m = 0 π n ( a m | a o : m ) ] r ( a o ) : = E n ∼ α [ ∏ n − 1 m = 0 π n ( a m | a o : m ) ⋅ π n ( ⊥ | a o ) r n ( a o ) ] E n ∼ α [ ∏ n − 1 m = 0 π n ( a m | a o : m ) ⋅ π n ( ⊥ | a o ) ] When the denominator vanishes, we can make an arbitrary choice. Essentially, what we do is sample n from α and then run the "experiment" defined by ( π n , r n ) . We have R π r ( μ ) = E μ π [ r ] = E n ∼ α [ E μ π n [ r n ] ] = E n ∼ α [ R π n r n ( μ ) ] ■ For any n , m ∈ N s.t. m ≥ n , we will denote by p r m n : I S m → I S n the canonical projection. That is p r m n : = p r m − 1 ∘ p r m − 2 … ∘ p r n + 1 ∘ p r n Proof of Theorem 1 Direction 1: R π r is affine by Proposition 4. To verify it is continuous, consider a sequence { μ k ∈ I S ω } k ∈ N s.t. μ ∗ : = lim k → ∞ μ k exists. Denote Δ r : = sup r − inf r , μ n k : = p r ω n ( μ k ) and μ n ∗ : = p r ω n ( μ ∗ ) . For any n ∈ N , we can decompose the expected value into the contribution of histories at length at most n and the contribution of longer histories. | R π r ( μ k ) − R π r ( μ ∗ ) | ≤ Δ r ( d tv ( μ n k , μ n ∗ ) + Pr μ k π [ | h | > n ] + Pr μ ∗ π [ | h | > n ] ) μ n k converges to μ n ∗ as k goes to ∞ , therefore d tv ( μ n k , μ n ∗ ) converges to 0 and we get lim sup k → ∞ | R π r ( μ k ) − R π r ( μ ∗ ) | ≤ 2 Δ r sup μ ∈ I S ω Pr μ π [ | h | > n ] Since this holds for any n ∈ N , we get lim sup k → ∞ | R π r ( μ k ) − R π r ( μ ∗ ) | ≤ 2 Δ r inf n ∈ N sup μ ∈ I S ω Pr μ π [ | h | > n ] By Proposition A.5, the right hand side vanishes. Direction 2: Define { ϵ n ∈ [ 0 , 1 ] } n ∈ N by ϵ n : = sup θ ∈ I S n μ 1 , 2 ∈ ( p r ω n ) − 1 ( θ ) | R ( μ 1 ) − R ( μ 2 ) | By Proposition A.6, lim n → ∞ ϵ n = 0 . By Proposition A.8, there is a sequence { ~ R n ∈ M o r ( I S n , [ 0 , 1 ] ) } n ∈ N s.t. for any n ∈ N sup μ ∈ I S ω ∣ ∣ R ( μ ) − ~ R n ( p r ω n ( μ ) ) ∣ ∣ ≤ 3 2 ϵ n It follows that there is a sequence { n k ∈ N } k ∈ N s.t. n k + 1 > n k and ∞ ∑ k = 0 sup μ ∈ I S ω ∣ ∣ ~ R n k + 1 ( p r ω n k + 1 ( μ ) ) − ~ R n k ( p r ω n k ( μ ) ) ∣ ∣ < 1 Define Δ R k ∈ M o r ( I S n k + 1 , [ − 1 , 1 ] ) by Δ R k ( θ ) : = ~ R n k + 1 ( θ ) − ~ R n k ( p r n k + 1 n k ( θ ) ) Denote δ k : = sup | Δ R k | . We can assume without loss of generality that δ k > 0 for every k ∈ N (this can be arranged by choosing appropriate n k , unless for some m ∈ N , R = p r ω n ∘ ~ R m ; but in the latter case, the theorem follows directly from Proposition A.10). By Proposition A.10, for every k ∈ N , there is π k + 1 : ( A × O ) < n k + 1 k → A and r k + 1 : ( A × O ) n k + 1 → [ − 1 , 1 ] s.t. 1 δ k Δ R k ( θ ) = E θ π k + 1 [ r k + 1 ] Also by Proposition A.10, there is π 0 : ( A × O ) < n 0 k → A and r 0 : ( A × O ) n 0 → [ 0 , 1 ] s.t. ~ R n 0 ( θ ) = E θ π 0 [ r 0 ] By the construction, ∑ ∞ k = 0 δ k < 1 , and moreover, denoting C : = 1 + ∑ ∞ k = 0 δ k R = p r ω n 0 ∘ ~ R n 0 + ∞ ∑ k = 0 p r ω n k + 1 ∘ Δ R k = C ( 1 C p r ω n 0 ∘ ~ R n 0 + ∞ ∑ k = 0 δ k C ⋅ p r ω n k + 1 ∘ Δ R k δ k ) By Proposition A.11, there is π a terminable policy and r : ( A × O ) ∗ → [ − 2 , 2 ] (the range of r k is [ − 1 , 1 ] and C < 2 ) s.t. R π r = R . ■ Proposition A.12 Consider any λ ∈ ( 0 , 1 ) , n ∈ N , θ ∈ I S n and μ 1 , 2 ∈ ( p r ω n ) − 1 ( θ ) . Then, d λ tv ( μ 1 , μ 2 ) ≤ λ n + 1 Proof of Proposition A.12 By Definition 16, d λ tv ( μ 1 , μ 2 ) = sup m ∈ N λ m d tv ( p r ω m μ 1 , p r ω m μ 2 ) For m ≤ n , p r ω m μ 1 = p r n m θ = p r ω m μ 2 , and therefore d tv ( p r ω m μ 1 , p r ω m μ 2 ) = 0 . For m > n , d tv ( p r ω m μ 1 , p r ω m μ 2 ) ≤ 1 by Definition 15. We get d λ tv ( μ 1 , μ 2 ) ≤ sup m > n λ m = λ n + 1 ■ Proof of Proposition 5 Define { ϵ n ∈ [ 0 , 1 ] } n ∈ N by ϵ n : = sup θ ∈ I S n μ 1 , 2 ∈ ( p r ω n ) − 1 ( θ ) | R ( μ 1 ) − R ( μ 2 ) | Let L ∈ R be the Lipschitz constant of R . We have ϵ n ≤ L sup θ ∈ I S n μ 1 , 2 ∈ ( p r ω n ) − 1 ( θ ) d λ tv ( μ 1 , μ 2 ) By Proposition A.12, we get ϵ n ≤ L λ n + 1 Without loss of generality, assume the range of R is contained in [ 0 , 1 ] . By Proposition A.8, it follows that there is a sequence { ~ R n ∈ M o r ( I S n , [ 0 , 1 ] ) } n ∈ N s.t. for any n ∈ N sup μ ∈ I S ω ∣ ∣ R ( μ ) − ~ R n ( p r ω n ( μ ) ) ∣ ∣ ≤ 3 2 L λ n + 1 It follows that ∞ ∑ n = 0 sup μ ∈ I S ω ∣ ∣ ~ R n + 1 ( p r ω n + 1 ( μ ) ) − ~ R n ( p r ω n ( μ ) ) ∣ ∣ ≤ 3 2 L ∞ ∑ n = 0 ( λ n + 2 + λ n + 1 ) ∞ ∑ n = 0 sup μ ∈ I S ω ∣ ∣ ~ R n + 1 ( p r ω n + 1 ( μ ) ) − ~ R n ( p r ω n ( μ ) ) ∣ ∣ ≤ 3 L 2 ⋅ λ 2 + λ 1 − λ Define Δ R n ∈ M o r ( I S n + 1 , [ − 1 , 1 ] ) by Δ R n ( θ ) : = ~ R n + 1 ( θ ) − ~ R n ( p r n ( θ ) ) Denote δ n : = sup | Δ R n | . By Proposition A.10, for every n ∈ N s.t. δ n > 0 , there is π n + 1 : ( A × O ) ≤ n k → A and r n + 1 : ( A × O ) n + 1 → [ − 1 , 1 ] s.t. 1 δ n Δ R n ( θ ) = E θ π n + 1 [ r n + 1 ] ~ R 0 is a constant. Define C ∈ R + by C : = 1 + ∞ ∑ k = 0 δ k ≤ 1 + 3 L 2 ⋅ λ 2 + λ 1 − λ We have R = ~ R 0 + ∞ ∑ n = 0 p r ω n + 1 ∘ Δ R n = C ( 1 C ~ R 0 + ∞ ∑ n = 0 δ n C ⋅ p r ω n + 1 ∘ Δ R n δ n ) Here, the terms with δ n = 0 are understood to vanish. By Proposition A.11, there is π a terminable policy and r : ( A × O ) ∗ → [ − C , C ] s.t. R π r = R . Moreover, looking at the construction in the proof of Proposition A.11, we can see that E h ∼ μ π [ | h | ] = ∞ ∑ n = 0 δ n C ( n + 1 ) ≤ ∞ ∑ n = 0 3 L 2 ( λ n + 2 + λ n + 1 ) ( n + 1 ) < ∞ ■ In order to prove Theorem 2, we will consider the policy π PS γ , T : S ∗ × S k → A implemented by an algorithm which is PSRL with two modifications: Each episode has random duration, uniformly distributed from 1 to 2 T − 1 , for some fixed T ∈ N + . Between any two regular episodes, there is an "interlude" which consists of, performing the reward estimation experiment ( π e s t ). The PSRL algorithm assumes choosing Π : H × S → A , a Borel measurable mapping s.t. Π ( T ) is an optimal policy, i.e. E U Π ( T ) T R T ( γ ) = E U ∗ T R T ( γ ) As usual, we will consider ( Ω , P ) , a probability space governing both the uncertainty about the true hypothesis, the stochastic behavior of the environment and the random sampling inside the algorithm. Let Y ∗ : Ω → H be a random variable representing the true hypothesis, { Y k : Ω → H } k ∈ N be random variables s.t. Y n represents the hypothesis sampled at episode k , { Θ n : Ω → S } n ∈ N be s.t. Θ n represents the state at time n , { A n : Ω → A } n ∈ N be s.t. A n represents the action taken at time n , { N k : Ω → N } k ∈ N be s.t. N k represents the time when the k -th episode starts and { M k : Ω → N } k ∈ N be s.t. M k represents the time when the k -the interlude starts. This probability space can be formally defined via recursive equations on the random variables, but this is straightforward and we will omit it. Proposition A.13 In the setting of Theorem 2, fix T ∈ N + and γ ∈ ( 0 , 1 ) . Denote R k : = R Y k , R ∗ : = R Y ∗ , Δ R k : = R k − R ∗ , Δ Y k : = Y k − Y ∗ , E ∗ k : = Y ∗ Π ( Y k ) , E k ∗ : = Y k Π ( Y ∗ ) , E ∗ ∗ : = Y ∗ Π ( Y ∗ ) , Δ N k : = M k − N k and Δ M k : = N k + 1 − M k . Then, R ( γ ) = ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n ( ( 1 − γ ) Δ R k ( Θ n ) + γ E Δ Y k [ V Y k R k ( γ ) ∣ ∣ Θ n , A n ] ) ⎤ ⎦ + ∞ ∑ k = 0 E ⎡ ⎣ γ M k E E Δ N k k ∗ − E Δ N k ∗ k [ V Y ∗ R ∗ ( γ ) ∣ ∣ Θ N k ] ⎤ ⎦ + ( 1 − γ ) ∞ ∑ k = 0 E ⎡ ⎣ N k + 1 − 1 ∑ n = M k γ n E E n − M k ∗ ∗ − E n − M k ∗ k [ R ∗ ∣ ∣ Θ M k ] ⎤ ⎦ + ∞ ∑ k = 0 E ⎡ ⎣ γ N k + 1 E E Δ M k ∗ ∗ − E Δ M k ∗ k [ V Y ∗ R ∗ ( γ ) ∣ ∣ Θ M k ] ⎤ ⎦ Proof of Proposition A.13 For any n ∈ N , define Π n : H × H × S ∗ × S k → A as follows. Π n ( T 1 , T 2 , h , s ) : = { Π ( T 1 , s ) if | h | < n Π ( T 2 , s ) if | h | ≥ n That is, Π n ( T 1 , T 2 ) is a policy that follows Π ( T 1 ) for time n and Π ( T 2 ) afterwards. In the following, we use the shorthand notation V ∗ ( s ) : = V Y ∗ R ∗ ( s , γ ) V k ( s ) : = V Y k R k ( s , γ ) V k l ( s ) : = V Y ∗ Π Δ N k − l ( Y k , Y ∗ ) R ∗ ( s , γ ) It is easy to see that R ( γ ) = ∞ ∑ k = 0 E [ γ N k ( V ∗ ( Θ N k ) − V k 0 ( Θ N k ) ) ] + ( 1 − γ ) ∞ ∑ k = 0 E ⎡ ⎣ N k + 1 − 1 ∑ n = M k γ n E E n − M k ∗ ∗ − E n − M k ∗ k [ R ∗ ∣ ∣ Θ M k ] ⎤ ⎦ + ∞ ∑ k = 0 E ⎡ ⎣ γ N k + 1 E E Δ M k ∗ ∗ − E Δ M k ∗ k [ V Y ∗ R ∗ ( γ ) ∣ ∣ Θ M k ] ⎤ ⎦ Here, the first term represents the regret incurred during the episodes, whereas the second and third term represent the regret incurred during the interludes (the lost reward and lost value respectively). We will denote the first term R 0 ( γ ) in the following. By definition, Y k and Y ∗ have the same distribution even when conditioned by the history up to N k . Therefore E [ V ∗ ( Θ N k ) ] = E [ V k ( Θ N k ) ] It follows that R 0 ( γ ) = ∞ ∑ k = 0 E [ γ N k ( V k ( Θ N k ) − V k 0 ( Θ N k ) ) ] Denote Θ k l : = Θ N k + l and Δ V k l : = V k ( Θ k l ) − V k l ( Θ k l ) . We now prove by induction on l ∈ N that, with probability 1 l ≤ Δ N k ⟹ E [ Δ V k 0 | N k , M k ] = E ⎡ ⎣ N k + l − 1 ∑ n = N k γ n − N k ( ( 1 − γ ) Δ R k ( Θ n ) + γ E Δ Y k [ V k | Θ n , A n ] ) + γ l Δ V k l ∣ ∣
∣ ∣ N k , M k ⎤ ⎦ For l = 0 this is a tautology. For any l ∈ N , the Bellman equation says that V k ( s ) = ( 1 − γ ) R k ( s ) + γ E Y k Π ( Y k ) [ V k | s ] l < Δ N k ⟹ V k l ( s ) = ( 1 − γ ) R ∗ ( s ) + γ E Y ∗ Π ( Y k ) [ V k , l + 1 | s ] Denote E k k : = Y k Π ( Y k ) . We will also use the notation E k [ X ] : = E [ X | N k , M k ] . Substituting s = Θ k l and subtracting the two identities, we get that, in the subspace of Ω defined by l < Δ N k E k [ Δ V k l ] = E k [ ( 1 − γ ) Δ R ( Θ k l ) + γ ( E E k k [ V k | Θ k l ] − E E ∗ k [ V k , l + 1 | Θ k l ] ) ] Denote A k l : = A N k + l . Since Π ( Y k ) is exactly the policy followed by PSRL at time N k + l , we get E k [ Δ V k l ] = E k [ ( 1 − γ ) Δ R ( Θ k l ) + γ ( E Y k [ V k | Θ k l , A k l ] − E Y ∗ [ V k , l + 1 | Θ k l , A k l ] ) ] We now subtract and add γ E Y ∗ [ V k | Θ k l , A k l ] , and use the fact that Y ∗ ( Θ k l , A k l ) is the conditional distribution of Θ k , l + 1 . E k [ Δ V k l ] = E k [ ( 1 − γ ) Δ R ( Θ k l ) + γ ( E Δ Y k [ V k | Θ k l , A k l ] + Δ V k , l + 1 ) ] Applying this identity to the last term on the right hand side of the induction hypothesis, we prove the induction step. For l = Δ N k , we get E k [ Δ V k 0 ] = M k ∑ n = N k γ n − N k E k [ ( 1 − γ ) Δ R k ( Θ n ) + γ E Δ Y k [ V k | Θ n , A n ] ] + γ Δ N k E k [ V k ( Θ M k ) − V ∗ ( Θ M k ) ] Clearly E k [ V k ( Θ M k ) ] = E k ⎡ ⎣ E E Δ N k ∗ k [ V k ∣ ∣ Θ N k ] ⎤ ⎦ E k [ V ∗ ( Θ M k ) ] = E k ⎡ ⎣ E E Δ N k ∗ k [ V ∗ ∣ ∣ Θ N k ] ⎤ ⎦ Using the definition of PSRL, we can exchange and true and sampled hypothesis and get E k [ V k ( Θ M k ) ] = E k ⎡ ⎣ E E Δ N k k ∗ [ V ∗ ∣ ∣ Θ N k ] ⎤ ⎦ It follows that E k [ Δ V k 0 ] = M k ∑ n = N k γ n − N k E k [ ( 1 − γ ) Δ R k ( Θ n ) + γ E Δ Y k [ V k | Θ n , A n ] ] + γ Δ N k E k ⎡ ⎣ E E Δ N k k ∗ − E Δ N k ∗ k [ V ∗ ∣ ∣ Θ N k ] ⎤ ⎦ Applying this to each term in the earlier expression for R 0 ( γ ) , we get the desired result. ■ Proposition A.14 Consider ( Ω , P ) a probability space, { M k , Δ k : Ω → N } k ∈ N random variables and T ∈ N + . Assume that M k + 1 − M k ≥ Δ k and the Δ k are all independent and uniformly distributed between 1 and 2 T − 1 . Define the random variable K n : Ω → N by K n : = min { k ∈ N | M k ≥ n } Then, Pr [ K n > 2 n T + 1 ] ≤ exp ( − n 4 T ) Proof of Proposition A.14 Define M ′ k : = ∑ k = 1 l = 0 Δ l . Obviously, M ′ k ≤ M k . For any k ∈ N and m ∈ R ≥ 0 Pr [ M k ≤ k T − m ] ≤ Pr [ M ′ k ≤ k T − m ] Apply Hoeffding's inequality to the RHS, Pr [ M k ≤ k T − m ] ≤ exp ( − 2 m 2 k ( 2 T − 2 ) 2 ) ≤ exp ( − m 2 2 k T 2 ) Taking m : = 1 2 k T , we get Pr [ M k ≤ k T 2 ] ≤ exp ⎛ ⎜
⎜ ⎝ − ( 1 2 k T ) 2 2 k T 2 ⎞ ⎟
⎟ ⎠ = exp ( − k 8 ) Moreover, by definition of K n , we have, for any k , n ∈ N Pr [ K n > k ] = Pr [ M k < n ] It follows that Pr [ K ⌈ 1 2 k T ⌉ > k ] = Pr [ M k < ⌈ k T 2 ⌉ ] = Pr [ M k < k T 2 ] ≤ exp ( − k 8 ) Take k : = ⌈ 2 n T ⌉ . We get Pr [ K n > 2 n T + 1 ] ≤ Pr [ K ⌈ 1 2 ⌈ 2 n T ⌉ T ⌉ > ⌈ 2 n T ⌉ ] ≤ exp ⎛ ⎜
⎜ ⎝ − ⌈ 2 n T ⌉ 8 ⎞ ⎟
⎟ ⎠ ≤ exp ( − n 4 T ) ■ Proposition A.15 Consider Ψ be a measurable space, ( Ω , P ) a probability space, { H n ⊆ P ( Ω ) } n ∈ N a filtration, { X n : Ω → Ψ } n ∈ N a stochastic process adapted to H , { M k : Ω → N } k ∈ N stopping times and { f n : Ψ n + 1 → [ 0 , 1 ] } n ∈ N measurable functions. Consider also γ ∈ ( 0 , 1 ) and C ∈ R + and assume that with probability 1 ∞ ∑ k = 0 γ k f k ( X M 0 , X M 1 … X M k ) ≤ C In addition, consider some T ∈ N + , T ≥ 2 and assume that for all k ∈ N Pr [ M k = n | M k − 1 ] = { ( 2 T − 1 ) − 1 if M k − 1 < n < M k − 1 + 2 T 0 otherwise Here, M − 1 is understood to identically equal − 1 . Finally, assume that, conditional on M k ≥ n , M k and X n are independent. Define the H n -measurable random variable K n : Ω → N by K n : = min { k ∈ N | M k ≥ n } Then, ∞ ∑ n = 0 γ 2 n T + 1 E [ f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ 2 C T + 1 1 − exp ( − 1 4 T ) Proof of Proposition A.15 We have, with probability 1 ∞ ∑ n = 0 1 M K n = n γ K n f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ≤ C Taking expected value ∞ ∑ n = 0 E [ 1 M K n = n γ K n f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ C Denote by K ♯ n the joint random variables K n and M 0 , M 1 … M K n − 1 . Our assumptions imply that, conditional on K ♯ n , the factor 1 M K n = n is independent of the rest of the expression inside the expected value. It follows that ∞ ∑ n = 0 E [ Pr [ M K n = n ∣ ∣ K ♯ n ] γ K n E [ f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ∣ ∣ K ♯ n ] ] ≤ C Clearly Pr [ M K n = n ∣ ∣ K ♯ n ] = 1 2 T − n + M K n − 1 ≥ 1 2 T We get ∞ ∑ n = 0 E [ 1 2 T γ K n f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ C ∞ ∑ n = 0 E [ γ K n f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ 2 C T Using Proposition A.14, we get ∞ ∑ n = 0 ( E [ γ 2 n T + 1 f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] − exp ( − n 4 T ) ) ≤ 2 C T ∞ ∑ n = 0 γ 2 n T + 1 E [ f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ 2 C T + ∞ ∑ n = 0 exp ( − n 4 T ) ∞ ∑ n = 0 γ 2 n T + 1 E [ f K n ( X M 0 , X M 1 … X M K n − 1 , X n ) ] ≤ 2 C T + 1 1 − exp ( − 1 4 T ) ■ Proposition A.16 Consider ( Ω , P ) a probability space, T ∈ N + and { N k , Δ k : Ω → N } k ∈ N random variables s.t. N k + 1 − N k ≥ Δ k and the Δ k are all independent and uniformly distributed between 1 and 2 T − 1 . Consider also γ ∈ ( 0 , 1 ) . Then, for any k ∈ N E [ γ N k ] ≤ ( 1 − T γ 2 T − 2 ( 1 − γ ) ) k In particular, ∞ ∑ k = 0 E [ γ N k ] ≤ 1 T γ 2 T − 2 ( 1 − γ ) Proof of Proposition A.16 For any n ∈ N , we have 1 − γ n 1 − γ = n − 1 ∑ m = 0 γ m 1 − γ n = ( 1 − γ ) n − 1 ∑ m = 0 γ m ≥ n ( 1 − γ ) γ n − 1 γ n ≤ 1 − n ( 1 − γ ) γ n − 1 Therefore, since Δ 0 is uniformly distributed between 1 and 2 T − 1 , E [ γ Δ 0 ] = 1 2 T − 1 2 T − 1 ∑ n = 1 γ n ≤ 1 2 T − 1 2 T − 1 ∑ n = 1 ( 1 − n ( 1 − γ ) γ n − 1 ) E [ γ Δ 0 ] ≤ 1 2 T − 1 2 T − 1 ∑ n = 1 ( 1 − n ( 1 − γ ) γ 2 T − 2 ) = 1 − T ( 1 − γ ) γ 2 T − 2 Also, for any k ∈ N N k ≥ k − 1 ∑ l = 0 Δ l γ N k ≤ γ ∑ k − 1 l = 0 Δ l = k − 1 ∏ l = 0 γ Δ l E [ γ N k ] ≤ E [ k − 1 ∏ l = 0 γ Δ l ] = k − 1 ∏ l = 0 E [ γ Δ l ] = E [ γ Δ 0 ] k Here, we used that the Δ l are independent and equally distributed. Substituting the expression for E [ Δ 0 ] , we get the desired result. ■ Proposition A.17 In the setting of Proposition A.16, consider some δ ∈ R + . Denote α : = 1 − T γ 2 T − 2 ( 1 − γ ) Assume α > 0 . Then, ∞ ∑ k = 0 min ( E [ γ N k ] , δ ) ≤ ( ⌈ ln δ ln α ⌉ + 1 1 − α ) δ Proof of Proposition A.17 By Proposition A.16 ∞ ∑ k = 0 min ( E [ γ N k ] , δ ) ≤ ∞ ∑ k = 0 min ( α k , δ ) ∞ ∑ k = 0 min ( E [ γ N k ] , δ ) ≤ ⌈ ln δ ln α ⌉ − 1 ∑ k = 0 min ( α k , δ ) + ∞ ∑ k = ⌈ ln δ ln α ⌉ min ( α k , δ ) In the second term, we have α k ≤ α ⌈ ln δ ln α ⌉ ≤ α ln δ ln α = e ln α ln δ ln α = e ln δ = δ We get ∞ ∑ k = 0 min ( E [ γ N k ] , δ ) ≤ ⌈ ln δ ln α ⌉ − 1 ∑ k = 0 δ + ∞ ∑ k = ⌈ ln δ ln α ⌉ α k = ⌈ ln δ ln α ⌉ δ + α ⌈ ln δ ln α ⌉ 1 − α We've already seen that α ⌈ ln δ ln α ⌉ ≤ δ , and therefore ∞ ∑ k = 0 min ( E [ γ N k ] , δ ) ≤ ⌈ ln δ ln α ⌉ δ + δ 1 − α = ( ⌈ ln δ ln α ⌉ + 1 1 − α ) δ ■ We will use the notations of Definitions B.1 and B.2 (see Appendix). The following is a simple generalization of "Lemma 1" in Osband and Van Roy 2014 and the proof is essentially the same. Proposition A.18 Consider a set X , a finite-dimensional inner product space Y and some F ⊆ { X → Y } . Consider also some x ∈ X ω , y ∈ Y ω , T ∈ N , θ ∈ R + , an increasing sequence { N k ∈ N } k ∈ N and a nondecreasing sequence { β k ∈ R + } k ∈ N . Suppose that for any k ∈ N , N k + 1 ≤ N k + T . For any k ∈ N , define F k by F k : = C S F [ x y : N k , β − 1 k ] Denote D : = dim R V O F . Then, for any K ∈ N ∣ ∣ { ( k ∈ [ K ] , n ∈ N ) ∣ ∣ N k ≤ n < N k + 1 , W F k ( x n ) > θ } ∣ ∣ ≤ ( D + 1 ) ( 4 β K − 1 θ 2 + T ) Here, β − 1 is understood to mean 0 . Proof of Proposition A.18 Let A ⊂ N × N be the set A : = { ( k ∈ [ K ] , n ∈ N ) ∣ ∣ N k ≤ n < N k + 1 , W F k ( x n ) > θ } Let A ′ ⊂ N be the set A ′ : = { n ∈ N | ∃ k ∈ [ K ] : ( k , n ) ∈ A } For each i ∈ [ | A | ] , we define ( k i , n i ) ∈ A recursively by n 0 : = min A ′ n i + 1 : = min { n ∈ A ′ ∣ ∣ n > n i } Denote D : = dim R V O F and let L : = ⌊ | A | D + 1 ⌋ . Given any n ∈ N ∗ , the notation x n will refer to the element of X ∗ s.t. | x n | = | n | and for any i ∈ [ | n | ] , ( x n ) i : = x n i . We define j ∈ [ | A | ] and { m l i ∈ N ∗ } l ∈ [ L ] , i ∈ [ j + 1 ] by recursion over i . For i = 0 , we set m l 0 : = λ . For any i , we consider whether there is l ∈ [ L ] s.t. x n i is ( F , θ ) -independent of x m l i . If there is such l , we set m l , i + 1 : = m l i n i and for any l ′ ∈ [ L ] ∖ l , m l ′ , i + 1 : = m l i . If there is no such l , we set j : = i . The latter situation must occur for some i ∈ [ | A | ] , since otherwise we would get ∑ l ∈ [ L ] ∣ ∣ m l | A | ∣ ∣ = | A | That would imply that there is l ∈ [ L ] s.t. ∣ ∣ m l | A | ∣ ∣ ≥ | A | L = | A | ⌊ | A | D + 1 ⌋ ≥ | A | ( | A | D + 1 ) = D + 1 This is impossible since, by construction, each element of the sequence x m l | A | is ( F , θ ) -independent of the preceding subsequence, whereas, by definition of D , it is the maximal length of such a sequence. Since ( k j , n j ) ∈ A , W F k j ( x n j ) > θ . Therefore, there are f , ~ f ∈ F k j s.t. ∥ ∥ f ( x n j ) − ~ f ( x n j ) ∥ ∥ > θ By construction of j and m , For each l ∈ [ L ] , x n j is ( F , θ ) -dependent of x m l j . Therefore, ∣ ∣ m l j ∣ ∣ − 1 ∑ i = 0 ∥ ∥ f ( x m l j i ) − ~ f ( x m l j i ) ∥ ∥ 2 > θ 2 Define J ⊆ [ L ] by J : = { l ∈ [ L ] ∣ ∣ ∀ i ∈ [ ∣ ∣ m l j ∣ ∣ ] : m l j i < N k j } ∑ l ∈ J ∣ ∣ m l j ∣ ∣ − 1 ∑ i = 0 ∥ ∥ f ( x m l j i ) − ~ f ( x m l j i ) ∥ ∥ 2 ≥ | J | θ 2 By construction, the sequences m l j for all values of l together are a collection of distinct elements of [ n j ] . Therefore, | J | ≥ L − ( n j − N k j ) ≥ L − T + 1 . It follows that N k j − 1 ∑ n = 0 ∥ ∥ f ( x n ) − ~ f ( x n ) ∥ ∥ 2 ≥ ( L − T + 1 ) θ 2  

 ⎷ N k j − 1 ∑ n = 0 ∥ ∥ f ( x n ) − ~ f ( x n ) ∥ ∥ 2 ≥ θ √ max ( L − T + 1 , 0 ) Denote f ∗ : = L S F [ x y : N k j ] .  

 ⎷ N k j − 1 ∑ n = 0 ∥ f ( x n ) − f ∗ ( x n ) ∥ 2 +  

 ⎷ N k j − 1 ∑ n = 0 ∥ ∥ ~ f ( x n ) − f ∗ ( x n ) ∥ ∥ 2 ≥ θ √ max ( L − T + 1 , 0 ) Since f , ~ f ∈ F k j , by the definition of F k j each of the two terms on the RHS is at most √ β k j ≤ √ β K − 1 and we get 2 √ β K − 1 ≥ θ √ max ( L − T + 1 , 0 ) 4 β K − 1 ≥ θ 2 ( L + 1 − T ) 4 β K − 1 ≥ θ 2 ( | A | D + 1 − T ) | A | ≤ ( D + 1 ) ( 4 β K − 1 θ 2 + T ) ■ Proposition A.19 Consider α ∈ N and f : R + → R + non-decreasing. Define g : R → R by g ( x ) : = ln f ( e x ) , and assume g is Lipschitz continuous with constant α . In other words, for any t ∈ R + and λ ∈ [ 1 , ∞ ) , we have f ( λ t ) ≤ λ α f ( t ) . Let L denote the Laplace transform operator. Then, L [ f ] ( s ) ≤ 1 − e − 1 + α ! s f ( 1 s ) Proof of Proposition A.19 L [ f ] ( s ) = ∫ ∞ 0 e − s t f ( t ) d t = ∫ 1 s 0 e − s t f ( t ) d t + ∫ ∞ 1 s e − s t f ( t ) d t For the first term, we will use that f is non-decreasing, and for the second term, we will use that g is Lipschitz continuous with constant α . L [ f ] ( s ) ≤ ∫ 1 s 0 e − s t f ( 1 s ) d t + ∫ ∞ 1 s e − s t f ( 1 s ) ⋅ ( t s ) α d t L [ f ] ( s ) ≤ ( ∫ 1 s 0 e − s t d t + s α ∫ ∞ 1 s e − s t t α d t ) f ( 1 s ) L [ f ] ( s ) ≤ ( ∫ 1 s 0 e − s t d t + s α ∫ ∞ 0 e − s t t α d t ) f ( 1 s ) L [ f ] ( s ) ≤ ( 1 − e − 1 s + s α ⋅ α ! s − α − 1 ) f ( 1 s ) = 1 − e − 1 + α ! s f ( 1 s ) ■ Proposition A.20 There is some C A .20 ∈ R + s.t. the following holds. Consider a set X , an inner product space Y and some F ⊆ { X → Y } . Consider also some x ∈ X ω , y ∈ Y ω , T ∈ N + , γ ∈ ( 0 , 1 ) , θ ∈ R + , η 0 , η 1 ∈ R + , δ ∈ ( 0 , 1 ) and an increasing sequence { N k ∈ N } k ∈ N . Suppose that N 0 = 0 , for any k ∈ N , N k + 1 ≤ N k + T , and γ T > 1 2 . Denote β ( t ) : = η 0 + η 1 t ln e t δ For any k ∈ N , define F k by F k : = C S F [ x y : N k , β ( N k + 1 ) − 1 ] Denote D : = dim R V O F . Then, ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T 1 W F k ( x n ) > θ ≤ C A .20 D ( 1 θ 2 β ( 1 1 − γ ) + T ) Proof of Proposition A.20 By Proposition A.18, for any K ∈ N K − 1 ∑ k = 0 N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ ( D + 1 ) ( 4 β ( N K − 1 + 1 ) θ 2 + T ) Here, N − 1 is understood to mean 0 . Observing that N k ≤ k T , we get K − 1 ∑ k = 0 N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ ( D + 1 ) ( 4 β ( K T + 1 ) θ 2 + T ) Multiplying the inequality by γ K T and summing over K , we get ∞ ∑ k = 0 ( ∞ ∑ K = k + 1 γ K T ) N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ ( D + 1 ) ∞ ∑ K = 0 γ K T ( 4 β ( K T + 1 ) θ 2 + T ) On the left hand side, we sum the geometric series. On the right hand side, we use the observation that γ K T ( 4 β ( K T + 1 ) θ 2 + T ) ≤ 1 T ∫ T 0 γ K T + t − T ( 4 β ( K T + t + 1 ) θ 2 + T ) d t γ K T ( 4 β ( K T + 1 ) θ 2 + T ) ≤ 1 T γ T ∫ T 0 γ K T + t ( 4 β ( K T + t + 1 ) θ 2 + T ) d t Here, we used that β ( t ) is an increasing function for t ≥ 1 . We get ∞ ∑ k = 0 γ ( k + 1 ) T 1 − γ T N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ D + 1 T γ T ∫ ∞ 0 γ t ( 4 β ( t + 1 ) θ 2 + T ) d t γ T 1 − γ T ∞ ∑ k = 0 γ k T N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ D + 1 T γ T L t [ 4 β ( t + 1 ) θ 2 + T ] ( ln 1 γ ) It is easy to see that Proposition A.19 is applicable to the RHS for α = 2 . We get, γ T 1 − γ T ∞ ∑ k = 0 γ k T N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ D + 1 T γ T ⋅ 3 − e − 1 ln 1 γ ⎛ ⎜
⎜
⎜
⎜
⎜
⎜ ⎝ 4 β ( 1 ln 1 γ + 1 ) θ 2 + T ⎞ ⎟
⎟
⎟
⎟
⎟
⎟ ⎠ Using the condition γ T > 1 2 and absorbing O ( 1 ) factors into the definition of C A.20 , we get ∞ ∑ k = 0 γ k T N k + 1 − 1 ∑ n = N k 1 W F k ( x n ) > θ ≤ C A.20 D ( 1 θ 2 β ( 1 1 − γ ) + T ) ■ Proposition A.21 There is some C A .21 ∈ R + s.t. the following holds. In the setting of Proposition A.20, assume that for any x ∈ X and f ∈ F , ∥ f ( x ) ∥ ≤ 1 . Then, ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T W F k ( x n ) ≤ C A.21 ( D T + √ D β ( 1 1 − γ ) 1 1 − γ ) Proof of Proposition A.21 Due to the assumption ∥ f ( x ) ∥ ≤ 1 , we have W F k ( x ) ≤ 2 . For any t ∈ R + , we have W F k ( x n ) = ∫ 2 0 1 W F k ( x n ) > θ d θ ≤ t + ∫ 2 t 1 W F k ( x n ) > θ d θ ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T W F k ( x n ) ≤ t T 1 − γ T + ∫ 2 t ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T 1 W F k ( x n ) > θ d θ Applying Proposition A.20 to integrand on the RHS ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T W F k ( x n ) ≤ t T 1 − γ T + C A.20 D ∫ 2 t ( 1 θ 2 β ( 1 1 − γ ) + T ) d θ Evaluating the integral and dropping some negative terms on the right hand side, we get ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T W F k ( x n ) ≤ t T 1 − γ T + C A.20 D ( 1 t β ( 1 1 − γ ) + 2 T ) We now set t to be t : = √ D β ( 1 1 − γ ) ⋅ ( 1 − γ ) For an appropriate choice of C A.21 , and using the assumption γ T > 1 2 , it follows that ∞ ∑ k = 0 N k + 1 − 1 ∑ n = N k γ k T W F k ( x n ) ≤ C A.21 ( D T + √ D β ( 1 1 − γ ) 1 1 − γ ) ■ Proof of Theorem 2 We take π † γ : = π PS γ , T where T ∈ N + will be specified later. By Proposition A.13 R ( γ ) ≤ ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n ( ( 1 − γ ) | Δ R k ( Θ n ) | + γ ∣ ∣ ∣ E Δ Y k [ V Y k R k ( γ ) ∣ ∣ Θ n , A n ] ∣ ∣ ∣ ) ⎤ ⎦ + ∞ ∑ k = 0 E ⎡ ⎣ γ M k ∣ ∣
∣ ∣ E E Δ N k k ∗ − E Δ N k ∗ k [ V Y ∗ R ∗ ( γ ) ∣ ∣ Θ N k ] ∣ ∣
∣ ∣ ⎤ ⎦ + ( 1 − γ ) ∞ ∑ k = 0 E ⎡ ⎣ N k + 1 − 1 ∑ n = M k γ n ∣ ∣
∣ ∣ E E n − M k ∗ ∗ − E n − M k ∗ k [ R ∗ ∣ ∣ Θ M k ] ∣ ∣
∣ ∣ ⎤ ⎦ + ∞ ∑ k = 0 E ⎡ ⎣ γ N k + 1 ∣ ∣
∣ ∣ E E Δ M k ∗ ∗ − E Δ M k ∗ k [ V Y ∗ R ∗ ( γ ) ∣ ∣ Θ M k ] ∣ ∣
∣ ∣ ⎤ ⎦ We will use the notation Δ V ( γ ) : = max T ∈ H ( max s ∈ S V T R T ( s , γ ) − min s ∈ S V T R T ( s , γ ) ) We will also use the notation d tv ( μ − ν ) : = d tv ( μ , ν ) . It follows that R ( γ ) ≤ ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n ( ( 1 − γ ) | Δ R k ( Θ n ) | + γ Δ V ( γ ) d tv ( Δ Y k ( Θ n , A n ) ) ) ⎤ ⎦ + Δ V ( γ ) ∞ ∑ k = 0 E [ γ M k ] + ( 1 − γ ) ∞ ∑ k = 0 E ⎡ ⎣ N k + 1 − 1 ∑ n = M k γ n ⎤ ⎦ + Δ V ( γ ) ∞ ∑ k = 0 E [ γ N k + 1 ] Denote R 0 ( γ ) the first term on the RHS and R 1 ( γ ) the sum of the others terms. We have R ( γ ) ≤ R 0 ( γ ) + R 1 ( γ ) First, we analyze R 1 . In the second term, we have γ n ≤ γ M k , leading to E ⎡ ⎣ N k + 1 − 1 ∑ n = M k γ n ⎤ ⎦ ≤ E [ Δ M k γ M k ] = E [ E [ Δ M k | M k ] γ M k ] ≤ t e s t E [ γ M k ] We get R 1 ( γ ) ≤ Δ V ( γ ) ∞ ∑ k = 0 E [ γ M k ] + t e s t ( 1 − γ ) ∞ ∑ k = 0 E [ γ M k ] + Δ V ( γ ) ∞ ∑ k = 0 E [ γ N k + 1 ] Applying Proposition A.16 to each term, we get R 1 ( γ ) ≤ 2 Δ V ( γ ) + t e s t ( 1 − γ ) γ 2 T − 2 ( 1 − γ ) T Now, we analyze R 0 . Define Θ r M ∈ ( S × R ) ω by Θ r M k : = ( Θ M k , r ( Θ A M k : N k + 1 Θ N k + 1 ) ) That is, Θ r M is the history of reward estimation experiments. For any i ∈ N , let L i be the stopping time defined recursively by L 0 : = 0 L i + 1 : = min { l ∈ N | l > L i , ∃ k ∈ N : N k ≤ l < M k } That is, L are time indices that traverse the "interior" of the episodes only. Define Θ A L ∈ ( S × A ) ω by Θ A L i : = Θ L i A L i We apply Proposition B.1 (see Appendix) with δ : = 1 2 ( 1 − γ ) 2 and ϵ : = ( 1 − γ ) 2 , to each of the two terms in R 0 ( γ ) : Pr [ R ∗ ∈ ∞ ⋂ k = 0 C S H R [ Θ r M : k , β R ( k + 1 ) − 1 ] ] ≥ 1 − 1 2 ( 1 − γ ) 2 Pr [ Y ∗ ∈ ∞ ⋂ i = 0 C S H [ Θ A L : i Θ L i , β T ( i + 1 ) − 1 ] ] ≥ 1 − 1 2 ( 1 − γ ) 2 Here, β R and β T correspond to β in Proposition B.1. We also define N ′ k by the condition L N ′ k = N k . Since the hypotheses Y k is sampled from the posterior, for any k ∈ N we also have Pr [ R k ∈ C S H R [ Θ r M : k , β R ( k + 1 ) − 1 ] ] ≥ 1 − 1 2 ( 1 − γ ) 2 Pr [ Y k ∈ C S H [ Θ A L : N ′ k Θ N k , β T ( N ′ k + 1 ) − 1 ] ] ≥ 1 − 1 2 ( 1 − γ ) 2 Pr [ R ∗ , R k ∈ C S H R [ Θ r M : k , β R ( k + 1 ) − 1 ] ] ≥ 1 − ( 1 − γ ) 2 Pr [ Y ∗ , Y k ∈ C S H [ Θ A L : N ′ k Θ N k , β T ( N ′ k + 1 ) − 1 ] ] ≥ 1 − ( 1 − γ ) 2 Denote G k R : = { R ∗ , R k ∈ C S H R [ Θ r M : k , β R ( k + 1 ) − 1 ] } ⊆ Ω G k T : = { Y ∗ , Y k ∈ C S H [ Θ A L : N ′ k Θ N k , β T ( N ′ k + 1 ) − 1 ] } ⊆ Ω Define R R ( γ ) and R T ( γ ) by R R ( γ ) : = ( 1 − γ ) ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ⎤ ⎦ R T ( γ ) : = Δ V ( γ ) ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n + 1 d tv ( Δ Y k ( Θ n , A n ) ) ⎤ ⎦ We have R 0 ( γ ) = R R ( γ ) + R T ( γ ) We split R R into the G k R and G k ∁ R contributions R R ( γ ) = ( 1 − γ ) ∞ ∑ k = 0 ( E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k R ⎤ ⎦ + E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ) For the second term, we have M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ≤ 2 T γ N k E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ≤ 2 T E [ γ N k ; G k ∁ R ] ≤ 2 T min ( E [ γ N k ] , Pr [ G k ∁ R ] ) E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ≤ 2 T min ( E [ γ N k ] , ( 1 − γ ) 2 ) ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ≤ 2 T ∞ ∑ k = 0 min ( E [ γ N k ] , ( 1 − γ ) 2 ) Applying Proposition A.17 to the RHS, we get ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ≤ 2 T ( ⌈ 2 ln ( 1 − γ ) ln α ⌉ + 1 T γ 2 T − 2 ( 1 − γ ) ) ( 1 − γ ) 2 Here, α is as defined in Proposition A.17. Since we are interested in the asymptotics γ → 1 , and our ultimate choice of T will ensure that γ T → 1 , we will henceforth make the assumption that γ 2 T > 1 2 . ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k ∁ R ⎤ ⎦ ≤ 2 T ⎡ ⎢
⎢
⎢
⎢ ⎢ 2 ln ( 1 − γ ) ln ( 1 − 1 2 T ( 1 − γ ) ) ⎤ ⎥
⎥
⎥
⎥ ⎥ ( 1 − γ ) 2 + 4 ( 1 − γ ) Denote ρ ( γ , T ) the expression on the RHS. We get R R ( γ ) ≤ ( 1 − γ ) ⎛ ⎝ ∞ ∑ k = 0 E ⎡ ⎣ M k − 1 ∑ n = N k γ n | Δ R k ( Θ n ) | ; G k R ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ Denote H k R : = C S H R [ Θ r M : k , β R ( k + 1 ) − 1 ] Clearly Pr [ | Δ R k ( Θ n ) | ≤ W H k R ( Θ n ) ∣ ∣ G k R ] = 1 Using this inequality, dropping the ; G k R (since it can only the right hand side smaller) and moving the sum inside the expected value, we get R R ( γ ) ≤ ( 1 − γ ) ⎛ ⎝ E ⎡ ⎣ ∞ ∑ k = 0 M k − 1 ∑ n = N k γ n W H k R ( Θ n ) ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ Extending the sum on the RHS to M k (that can only increase it), and using the fact that the width is ≤ 1 , R R ( γ ) ≤ ( 1 − γ ) ⎛ ⎝ E ⎡ ⎣ ∞ ∑ k = 0 ⎛ ⎝ γ N k + M k ∑ n = N k + 1 γ n W H k R ( Θ n ) ⎞ ⎠ ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ By Proposition A.16, R R ( γ ) ≤ ( 1 − γ ) ⎛ ⎝ E ⎡ ⎣ ∞ ∑ k = 0 M k ∑ n = N k + 1 γ n W H k R ( Θ n ) ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ + 2 T We define the random variable K i : Ω → N by K i : = min { k ∈ N | M k ≥ L i } We can now rewrite the previous inequality as R R ( γ ) ≤ ( 1 − γ ) ( E [ ∞ ∑ i = 0 γ L i + 1 W H K i R ( Θ L i + 1 ) ] + ρ ( γ , T ) ) + 2 T Obviously L i + 1 ≥ i and hence R R ( γ ) ≤ ( 1 − γ ) ( ∞ ∑ i = 0 γ i E [ W H K i R ( Θ L i + 1 ) ] + ρ ( γ , T ) ) + 2 T On the other hand, by Proposition A.21 (for the T = 1 , N k = k case, applied to the subsequence Θ M k , with γ 1 2 T playing the role of γ ) ∞ ∑ k = 0 γ 1 2 T k W H k R ( Θ M k ) ≤ C A.21 ⎛ ⎜
⎜ ⎝ D R V O +  

 ⎷ D R V O β R ⎛ ⎝ 1 1 − γ 1 2 T ⎞ ⎠ 1 1 − γ 1 2 T ⎞ ⎟
⎟ ⎠ Denote ~ β R ( γ , T , D R V O ) the expression on the RHS. Applying Proposition A.15, we conclude ∞ ∑ i = 0 γ i + 1 2 T E [ W H K i R ( Θ L i + 1 ) ] ≤ 2 T ~ β R ( γ , T , D R V O ) + 1 1 − exp ( − 1 4 T ) It follows R R ( γ ) ≤ ( 1 − γ ) ⎛ ⎜
⎜ ⎝ γ − 1 2 T ⎛ ⎜
⎜ ⎝ 2 T ~ β R ( γ , T , D R V O ) + 1 1 − exp ( − 1 4 T ) ⎞ ⎟
⎟ ⎠ + ρ ( γ , T ) ⎞ ⎟
⎟ ⎠ + 2 T Now, we analyze R T . By the same reasoning as for R R , we have R T ( γ ) ≤ Δ V ( γ ) ⎛ ⎝ E ⎡ ⎣ M k − 1 ∑ n = N k γ n d tv ( Δ Y k ( Θ n , A n ) ) ; G k T ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ Denote H k T : = C S H [ Θ A L : N ′ k Θ N k , β T ( N ′ k + 1 ) − 1 ] It is easy to see that for N k ≤ n < M k Pr [ d tv ( Δ Y k ( Θ n , A n ) ) ≤ | S | 2 W H k T ( Θ n A n ) ∣ ∣ ∣ G k T ] = 1 It follows R T ( γ ) ≤ Δ V ( γ ) ⎛ ⎝ | S | 2 E ⎡ ⎣ ∞ ∑ k = 0 M k − 1 ∑ n = N k γ n W H k T ( Θ n A n ) ⎤ ⎦ + ρ ( γ , T ) ⎞ ⎠ R T ( γ ) ≤ Δ V ( γ ) ( | S | 2 ∞ ∑ i = 0 E [ γ L i W H K i T ( Θ L i A L i ) ] + ρ ( γ , T ) ) Since L i ≥ i , By Proposition A.14 ∞ ∑ i = 0 E [ γ L i W H K i T ( Θ L i A L i ) ] ≤ ∞ ∑ i = 0 ( E [ γ 1 2 ( K i − 1 ) T W H K i T ( Θ L i A L i ) ] + exp ( − i 4 T ) ) ∞ ∑ i = 0 E [ γ L i W H K i T ( Θ L i A L i ) ] ≤ γ − 1 2 T ∞ ∑ i = 0 E [ γ 1 2 K i T W H K i T ( Θ L i A L i ) ] + 1 1 − exp ( − 1 4 T ) Denote ~ ρ ( γ , T , | S | ) : = ρ ( γ , T ) + | S | 2 ⋅ 1 1 − exp ( − 1 4 T ) We get, using that γ − 1 2 T < 2 R T ( γ ) ≤ Δ V ( γ ) ( | S | ∞ ∑ i = 0 E [ γ 1 2 K i T W H K i T ( Θ L i A L i ) ] + ~ ρ ( γ , T , | S | ) ) On the other hand, dim R V O H ≤ | S | | A | and by Proposition A.21 ∞ ∑ i = 0 γ 1 2 K i T W H K i T ( Θ L i A L i ) ≤ C A.21 ⎛ ⎜
⎜ ⎝ | S | | A | T +  

 ⎷ | S | | A | β T ⎛ ⎝ 1 1 − γ 1 2 ⎞ ⎠ 1 1 − γ 1 2 ⎞ ⎟
⎟ ⎠ Denote ~ β T ( γ , T , | S | | A | ) the expression on the RHS. It follows that R T ( γ ) ≤ Δ V ( γ ) ( | S | ~ β T ( γ , T , | S | | A | ) + ~ ρ ( γ , T ) ) We set T : = 3  

 ⎷ ( τ + t e s t ) 2 ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ Now, we analyze the γ → 1 limit. In this limit, the expression for T justifies our assumption that γ 2 T > 1 2 . Indeed, we have lim γ → 1 ln γ T = lim γ → 1 T ln γ = lim γ → 1 3  

 ⎷ ( τ + t e s t ) 2 ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ⋅ ln γ = 0 We now analyze the separate contributions of R R , R T and R 1 to the limit of interest. We will use the notation x ≲ y to mean, there is some constant C 0 ∈ R + that depends on nothing (i.e. on none of the parameters of the problem) s.t. x ≤ C 0 y . Our previous bound on R R can be written as R R ( γ ) ≲ D R V O ( 1 − γ ) T +  
 ⎷ D R V O ln N ( H R , ( 1 − γ ) − 4 ) ⋅ 1 1 − γ 1 2 T ⋅ ( 1 − γ ) T +  
 ⎷ D R V O 1 1 − γ 1 2 T ln 1 1 − γ ⋅ ( 1 − γ ) T + 1 − γ 1 − exp ( − 1 4 T ) + T ⎡ ⎢
⎢
⎢
⎢ ⎢ ln ( 1 − γ ) ln ( 1 − 1 2 T ( 1 − γ ) ) ⎤ ⎥
⎥
⎥
⎥ ⎥ ( 1 − γ ) 3 + ( 1 − γ ) 2 + 1 T Here we used that 1 ≲ γ T ≤ 1 , substituted the expressions for ~ β R , ~ β and ρ , and dropped some dominated terms. We analyze the separate contribution of each term. lim sup γ → 1 D R V O ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 √ D R V O ln N ( H R , ( 1 − γ ) − 4 ) ⋅ 1 1 − γ 1 2 T ⋅ ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 √ D R V O D M B ln 1 1 − γ ⋅ 1 ( 1 − γ ) T ⋅ ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 √ D R V O D M B ( 1 − γ ) ln 1 1 − γ ⋅ T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ 1 lim sup γ → 1 √ D R V O 1 1 − γ 1 2 T ln 1 1 − γ ⋅ ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 √ D R V O 1 ( 1 − γ ) T ln 1 1 − γ ⋅ ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = lim sup γ → 1 √ D R V O ( 1 − γ ) ln 1 1 − γ ⋅ T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 1 3 √ D M B + 1 lim sup γ → 1 ( 1 − γ 1 − exp ( − 1 4 T ) ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 ( 1 − γ ) T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 ( T ⌈ ln ( 1 − γ ) ln ( 1 − 1 2 T ( 1 − γ ) ) ⌉ ( 1 − γ ) 3 ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 ln 1 1 − γ ( 1 − γ ) 2 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 ( 1 − γ ) 2 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 1 T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 1 τ + t e s t Our previous bound on R T can be written as R T ( γ ) ≲ Δ V ( γ ) | S | 2 | A | T + Δ V ( γ ) | S |  
 ⎷ | S | | A | ln N ( H , ( 1 − γ ) − 4 ) ( 1 − γ ) 2 ⋅ 1 1 − γ 1 2 + Δ V ( γ ) | S |  




 ⎷ | S | | A | ( 1 − γ ) 2 1 1 − γ 1 2 ln ( 1 1 − γ 1 2 ) ( 1 − γ ) 2 ⋅ 1 1 − γ 1 2 + Δ V ( γ ) T ⎡ ⎢
⎢
⎢
⎢ ⎢ ln ( 1 − γ ) ln ( 1 − 1 2 T ( 1 − γ ) ) ⎤ ⎥
⎥
⎥
⎥ ⎥ ( 1 − γ ) 2 + Δ V ( γ ) ⋅ ( 1 − γ ) + Δ V ( γ ) | S | 2 ⋅ 1 1 − exp ( − 1 4 T ) We analyze the contribution of each term. lim sup γ → 1 Δ V ( γ ) | S | 2 | A | T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 τ ( 1 − γ ) | S | 2 | A | T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 Δ V ( γ ) | S | √ | S | | A | ln N ( H , ( 1 − γ ) − 4 ) ( 1 − γ ) 2 ⋅ 1 1 − γ 1 2 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 τ ( 1 − γ ) | S | √ | S | | A | ( dim M B H + 1 ) ln 1 1 − γ ⋅ 1 1 − γ 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 Δ V ( γ ) | S |  



 ⎷ | S | | A | ( 1 − γ ) 2 1 1 − γ 1 2 ln ⎛ ⎜
⎜ ⎝ 1 1 − γ 1 2 ⎞ ⎟
⎟ ⎠ ( 1 − γ ) 2 ⋅ 1 1 − γ 1 2 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 Δ V ( γ ) T ⌈ ln ( 1 − γ ) ln ( 1 − 1 2 T ( 1 − γ ) ) ⌉ ( 1 − γ ) 2 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 τ ( 1 − γ ) 2 ln 1 1 − γ 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 Δ V ( γ ) ⋅ ( 1 − γ ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 lim sup γ → 1 Δ V ( γ ) | S | 2 ⋅ 1 1 − exp ( − 1 4 T ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 τ ( 1 − γ ) | S | T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 0 To complete the proof, we need to analyze the contribution of R 1 . We have R 1 ( γ ) ≲ 1 T ( Δ V ( γ ) ( 1 − γ ) + t e s t ) lim sup γ → 1 1 T ( Δ V ( γ ) ( 1 − γ ) + t e s t ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ lim sup γ → 1 τ + t e s t T 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ = 1 Putting everything together, we conclude lim sup γ → 1 R ( γ ) 3 √ ( τ + t e s t ) ( D M B + 1 ) D R V O ( 1 − γ ) ln 1 1 − γ ≲ 1 ■ Appendix The following is a special case of what appeared in the previous essay as "Definition 1", introduced here for the sake of simplifying notations. Definition B.1 Consider a set X , an inner product space Y and some F ⊆ { X → Y } . Consider also θ ∈ R + , n ∈ N , a sequence { x k ∈ X } k ∈ [ n ] and x ∗ ∈ X . x ∗ is said to be ( F , θ ) -dependant on { x k } when, for any f , ~ f ∈ F n − 1 ∑ k = 0 ∥ ∥ f ( x k ) − ~ f ( x k ) ∥ ∥ 2 ≤ θ 2 ⟹ ∥ ∥ f ( x ∗ ) − ~ f ( x ∗ ) ∥ ∥ ≤ θ Otherwise, x ∗ is said to be ( F , θ ) -independent of { x k } . The following is a special case of what appeared in the previous essay as "Definition A.1". Definition B.2 Consider a set X , a finite-dimensional inner product space Y and some F ⊆ { X → Y } . Assume F is compact w.r.t. the product topology on X → Y ≅ ∏ x ∈ X Y . Consider also some n ∈ N , x ∈ X n , y ∈ Y n and λ ∈ R + . We then use the notation L S F [ x y ] : = a r g m i n f ∈ F n − 1 ∑ m = 0 ∥ f ( x m ) − y m ∥ 2 C S F [ x y , λ ] : = { f ∈ F ∣ ∣
∣ ∣ n − 1 ∑ m = 0 ∥ ∥ f ( x m ) − L S F [ x y ] ( x m ) ∥ ∥ 2 ≤ 1 λ } Proposition B.1 There is some C B .1 ∈ R + s.t. the following holds. Consider a finite set X , a finite-dimensional inner product space Y and some F ⊆ { X → Y } . Let { H n ⊆ P ( X ω × Y ω ) } n ∈ N be the canonical filtration, i.e. H n : = { A ′ ⊆ X ω × Y ω ∣ ∣ A ′ = { x y | x y : n ∈ A } , A ⊆ X n × Y n Borel } Consider also f ∗ ∈ F and μ ∈ Δ ( X ω × Y ω ) s.t. for any n ∈ N and x ∈ X E x y ∼ μ [ y n | x n = x , H n ] = f ∗ ( x ) Assume that ∥ y n ∥ ≤ 1 with μ -probability 1 for all n ∈ N . Fix ϵ ∈ R + , δ ∈ ( 0 , 1 ) . Define β : R + → R by β ( t ) : = C B .1 ( σ 2 ln N ( F , ϵ − 2 I d ) δ + ϵ t ln e t δ ) Then, Pr x y ∼ μ [ f ∗ ∉ ∞ ⋂ n = 0 C S F [ x y : n , β ( n + 1 ) − 1 ] ] ≤ δ Proof of Proposition B.1 Straightforward from "Proposition B.1" and "Proposition A.3" in the previous essay . ■