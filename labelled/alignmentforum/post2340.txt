Suppose we want to estimate the mean and variance of a normal distribution from some samples X 1 … X n from the distribution. It turns out that we don’t need to keep around all of the data: only the sample mean ^ μ = 1 n ∑ i X i and sample variance ^ Σ = 1 n ∑ i ( X i − ^ μ ) 2 are needed for the estimation problem. From those, we can calculate the entire posterior distribution of μ , Σ . The pair ( ^ μ , ^ Σ ) is a “sufficient statistic” for X 1 … X n : a statistic which summarizes all the estimation-relevant information from the data. In principle, every estimation problem has a sufficient statistic: just let the summary be all the data. But this isn’t very useful. We really want to compress the data, pull out the actually-useful parts and throw away the rest. In the normal distribution example, our n samples of data are each 1-dimensional for a total of n dimensions of data, but the summary is only 2-dimensional, no matter how large n grows. When will an estimation problem have a fixed-dimensional sufficient statistic as the number of data points increases, like the normal-distribution estimation problem? The Koopman-Pitman-Darmois (KPD) Theorem says that, when estimating distribution parameters from IID samples, there is a fixed-dimensional sufficient statistic if-and-only-if the distribution can be expressed in exponential family form: P [ X | Θ ] = 1 Z ( Θ ) e f ( Θ ) T ∑ i g ( X i ) ∏ i h ( X i ) … for some vector-valued functions f , g and positive-real-valued function h . The sufficient statistic is then ∑ n i = 1 g ( X i ) . For instance, for a normal distribution, the parameters Θ are ( μ , Σ ) , and we can use g ( x ) = ( x , x 2 ) and f ( Θ ) = f ( μ , Σ ) = ( − Σ − 1 μ , − 1 2 Σ − 1 ) . Intuitively, this says the “coupling” between X and Θ is only via the fixed-dimensional “summary” vectors f ( Θ ) and ∑ i g ( X i ) . That’s the original KPD Theorem. We’ll see in this post that the theorem generalizes a lot . It’s not just estimation of distribution parameters from IID samples - KPD can also generalize to estimation of parameters for Markov chains, or causal models with symmetry - aka stochastic programs. The theorem also extends to causal models without any symmetry, albeit slightly weaker: a small number of variables can violate the exponential form, but (roughly speaking) the number of variables which can violate the exponential form is proportional to the summary dimension. So if we have a low-dimensional summary of lots of variables, the vast majority of variables must still satisfy the exponential form. The condition which does most of the work is sparsity: we’ll assume the conditional distribution factors according to a causal model with a sparse graph. Or, in more physical terms: direct interactions are local; long-range interactions are always mediated by short-range interactions. Conditionally independent variables are just the most extreme version of this - their conditional distribution factors according to a graph with no edges at all (i.e. there are no interactions at all). In particular, I now expect most abstractions to mostly satisfy the exponential family form, though that’s a topic for future posts. The Theorems We’ll cover three generalized KPD theorems, each with different assumptions on the structure of P [ X | Θ ] : Independent But Non-Identical Causal Model/Bayes Net IID The first is intended as a relatively-simple case to illustrate the core ideas, before we introduce more complexity. The second is the most general theorem. The third is intended to illustrate how we can leverage symmetry to rule out the annoying “exception” variables. This is definitely not a comprehensive set of KPD generalizations; these theorems and proofs are mainly intended to illustrate the general tools and techniques by which KPD generalizations can be derived. Independent But Non-Identical KPD The simplest starting point for these theorems is parameter estimation from independent-but-not-identically-distributed variables. (If you want a concrete image in mind, picture scientists trying to estimate the values of some physical constants using a bunch of different experiments.) Theorem Let ( X 1 , … , X n ) be continuous random variables, conditionally independent given Θ (i.e. P [ X | Θ ] = ∏ i P [ X i | Θ ] ). There exists a D-dimensional sufficient statistic G ( X ) summarizing all information in X relevant to Θ only if the distribution has the form P [ X | Θ ] = 1 Z ( Θ ) e f ( Θ ) ⋅ ∑ i ∉ E g i ( X i ) ∏ i ∉ E P [ X i | Θ 0 ] ∏ i ∈ E P [ X i | Θ ] … where: f , { g i } are some at-most D-dimensional vector-valued summary functions E is a set of “exception” variables, not satisfying the exponential form The number of exception variables | E | is at-most D Intuitively, this is like the original KPD, but some variables can be “exceptions” and not follow the exponential form - their coupling with Θ is not mediated by the summary vectors f ( Θ ) and ∑ i ∉ E g i ( x i ) . However, there can only be at-most D exceptions. When the number of variables is much greater than the summary dimension (i.e. n > > D), this means that the vast majority of variables must satisfy the exponential form. The summary vectors mediate the interactions with Θ of all but at-most D variables. Note that this is an “only if” theorem, not an “if-and-only-if” theorem. It does establish that a fixed-dimension sufficient statistic exists if-and-only-if the distribution takes the above form, since any distribution with the above form can use G ( X ) = ( X E , ∑ i ∉ E g i ( X i ) ) as a sufficient statistic. However, that sufficient statistic has dimension at-most 2D, whereas the “only if” theorem above assumes the existence of a statistic of dimension D. So there’s a “gap” in the if-and-only-if characterization: any conditionally-independent distribution with a D-dimensional sufficient statistic satisfies the form, but given a distribution which satisfies the form, we may only be able to find a 2D-dimensional sufficient statistic rather than a D-dimensional sufficient statistic. Of course, for applications with n > > D, the difference between D and 2D won't matter much anyway. Proof The first key idea is the Minimal Map Theorem (also proved more elegantly here ): if we want to summarize all the information in X which is relevant to Θ , then the posterior distribution ( θ ↦ P [ Θ = θ | X ] ) is a sufficient statistic. It’s also “minimal” in the sense that the posterior distribution can be calculated from any other sufficient statistic, therefore any other sufficient statistic must contain at least as much information (this can be proven via the Data Processing Inequality ). So, given our hypothetical fixed-dimensional summary statistic G ( X ) (where X is a vector of all the data points), we can write F ( G ( X ) ) = ( θ ↦ P [ Θ = θ | X ] ) … for some function F . The right-hand side is a data structure containing the values of P [ Θ = θ | X ] for EVERY θ -value; we can think of it as a vector indexed by θ . (In the case where θ has m possible values θ 1 , … , θ m , any map ( θ ↦ f ( θ ) ) with real-valued f can be represented as a length- m vector v in which v i is f ( θ i ) .) Now, the key property underlying (this version of) the KPD is conditional independence of X , i.e. P [ X | θ ] = ∏ i P [ X i | θ ] . We want to leverage that factorization, so we’ll transform the distribution into a representation we can factor. First, transform the distribution to a log-odds representation: l o g O d d s ( F ( G ( X ) ) ) = ( θ ↦ l n P [ Θ = θ | X ] P [ Θ = θ 0 | X ] ) … for some arbitrary reference parameters θ 0 . Next, we apply Bayes’ Rule: = ( θ ↦ l n P [ X | Θ = θ ] P [ X | Θ = θ 0 ] + l n P [ Θ = θ ] P [ Θ = θ 0 ] ) … then subtract off the prior l n P [ Θ = θ ] P [ Θ = θ 0 ] from both sides, since it’s not a function of X : l o g O d d s ( F ( G ( X ) ) ) − ( θ ↦ l n P [ Θ = θ ] P [ Θ = θ 0 ] ) = ( θ ↦ l n P [ X | Θ = θ ] P [ X | Θ = θ 0 ] ) To clean up the notation, we’ll define F ′ ( G ) : = l o g O d d s ( F ( G ) ) − ( θ ↦ l n P [ Θ = θ ] P [ Θ = θ 0 ] ) . Finally, we can apply the factorization (remember, that was the point of all these transformations) and get F ′ ( G ( X ) ) = ∑ i ( θ ↦ l n P [ X i | Θ = θ ] P [ X i | Θ = θ 0 ] ) The right-hand side of this expression is a sum of vectors indexed by θ . Each vector is a function of just one of the X i , and the left-hand side says that we can express the sum in terms of a D-dimensional summary G ( X ) . So, this is an Additive Summary Equation (see appendix below for details). In fact, it’s a particularly simple Additive Summary Equation: each f i depends only on x i , and each x i has no neighbors besides itself. The Additive Summary Equation Theorem then tells us that the equation is solvable (i.e. a D-dimensional summary statistic exists) only if l n P [ X | Θ = θ ] P [ X | Θ = θ 0 ] = ∑ i ∈ B ( l n P [ X i | Θ = θ ] P [ X i | Θ = θ 0 ] ) + U ( θ ) ∑ i ′ ∉ B g i ′ ( x i ′ ) + C ( θ ) … for some B consisting of at-most D X -indices, and some U ( θ ) of dimension at-most D. Exponentiating both sides and simplifying a bit, this condition becomes P [ X | Θ = θ ] = 1 Z ( θ ) e U ( θ ) ∑ i ′ ∉ B g i ′ ( x i ′ ) ∏ i ∈ B P [ X i | Θ = θ ] ∏ i ′ ∉ B P [ X i ′ | Θ = θ 0 ] … which is the desired form. Key Takeaways The main takeaway from the theorem is the idea of “exception” variables, which circumvent the exponential family form, and the idea that the number of exception variables is limited by the dimensionality of the sufficient statistic. The main takeaways from the proof are: Start with the Minimal Map Theorem to get the “most general” sufficient statistic Transform to apply the factorization of the distribution Use the Additive Summary Equation Theorem We’ll reuse this general structure in the next proof. Causal Model/Bayes Net KPD Now we address a much more general case: factorization according to a Bayes Net/Causal Model. We still imagine estimating some parameters Θ , but our data is no longer conditionally independent. Conditional on the parameters, interactions between data points are no longer non-existent. However, the direct interactions are sparse - i.e. most data points interact directly with only a few other data points (though they may indirectly interact with everything). This would be the case if, for example, we are trying to estimate parameters of some complicated physical system in real-time from a single instance of the system. Theorem Let ( X 1 , … , X n ) be continuous random variables, whose distribution conditional on Θ forms a Bayes Net on a DAG (i.e. P [ X | Θ ] = ∏ i P [ X i | X p a ( i ) , Θ ] , where p a ( i ) denotes the nodes with edges directly into i in the DAG). There exists a D-dimensional sufficient statistic G ( X ) summarizing all information in X relevant to Θ only if the distribution has the form P [ X | Θ ] = 1 Z ( Θ ) e f ( Θ ) ∑ i ∉ E g i ( x i , x p a ( i ) ) ∏ i ∉ E P [ X i | X p a ( i ) , Θ = θ 0 ] ∏ i ∈ E P [ X i | X p a ( i ) , Θ = θ ] … where: f , { g i } are some at-most D-dimensional summary functions E is a set of “exception” variables, not satisfying the exponential form The set of exception variables includes at-most D variables, plus variables in the Markov blanket (i.e. parents, children and parents-of-children) of those D variables, plus children of variables in the Markov blanket. This mostly generalizes the previous theorem in the obvious way, with one major exception: we can now have a lot more exception variables. Roughly speaking, exceptions happen in “chunks”: neighborhoods each consisting of a variable, its “neighbors” in the Markov blanket, and its neighbors' children. So, in order for the theorem to say anything nontrivial, the DAG has to be sparse: each variable has to have only a few neighbors. If a single variable directly touches most of the DAG, then an exception-neighborhood around that variable could include most of the variables in the model. As long as the DAG is sparse and n > > D, the vast majority of variables must still satisfy the exponential form. If each variable has at-most k variables in its Markov blanket, then the number of exception variables is less than k 2 D. For instance, in a minimal computationally-complete circuit model (e.g. NAND gates), k = 6 (two inputs per node, two children per node to allow copying, and one other parent for each child), so the number of exceptions would be less than 36D. If the number of variables exceeds the summary dimension by several orders of magnitude, this would be a drop in the bucket - the vast majority of variables would still need to satisfy the exponential form. Proof This follows broadly the same structure as the proof for the Independent But Non-Identical KPD, so we’ll speed through the parts which are the same and just focus on differences. As in that proof, we apply the Minimal Map Theorem, then apply a log odds transformation, and factor the distribution. The factorization is now P [ X | Θ ] = ∏ i P [ X i | X p a ( i ) , Θ ] , so the summary equation is F ′ ( G ( X ) ) = ( θ ↦ l n P [ X | Θ = θ ] P [ X | Θ = θ 0 ] ) = ∑ i ( θ ↦ l n P [ X i | X p a ( i ) , Θ = θ ] P [ X i | X p a ( i ) , Θ = θ 0 ] ) The neighbors N ( j ) of a variable X j are no longer trivial; they are exactly the Markov blanket of X j (i.e. parents, children, and children of parents of X j in the Bayes net). The terms which depend on X N ( j ) are the factors corresponding to neighbors plus children-of-neighbors, i.e. N ( j ) ∪ c h ( N ( j ) ) . The Additive Summary Equation Theorem then says that a D-dimensional summary exists only if l n P [ X | Θ = θ ] P [ X | Θ = θ 0 ] = ∑ i ∈ E ( l n P [ X i | X p a ( i ) , Θ = θ ] P [ X i | X p a ( i ) , Θ = θ 0 ] ) + U ( θ ) ∑ i ′ ∉ E g i ′ ( x i ′ , x p a ( i ′ ) ) + C ( θ ) … where E = N ( B ) ∪ c h ( N ( B ) ) , and | B | is at-most D. Exponentiating and simplifying a bit yields: P [ X | Θ ] = 1 Z ( Θ ) e U ( Θ ) ∑ i ′ ∉ E g i ′ ( x i ′ , x p a ( i ′ ) ) ∏ i ∉ E P [ X i | X p a ( i ) , Θ 0 ] ∏ i ∈ E P [ X i | X p a ( i ) , Θ ] … which is the desired form. Key Takeaways The main takeaway here is the idea that exceptional variables occur in neighborhoods, so sparsity is a necessary condition for the theorem to say anything nontrivial. On the other hand, causal models are extremely general , sparsity is ubiquitous in the physical sciences , and a sparse causal model is all we need to apply the theorem. We should thus expect exponential family distributions to show up in most places where low-dimensional summaries exist, in practice. In particular, we should expect exponential family forms for most abstractions , in practice. Another important point: the methods used in the proof are “smooth”, in the sense that small violations of the assumptions should produce only small violations of the conclusions. In other words, we should also expect distributions with approximate low-dimensional summaries, which approximately factor as a sparse Bayes Net, to approximately fit the exponential form. IID KPD When our variables have some symmetry, we can sometimes leverage it to eliminate the annoying “exception” variables. The basic requirement is that our distribution P [ X | Θ ] is invariant under permuting some of the variables. For instance, if we have a time-symmetric Markov Chain, then we can replace every X t with X t + 1 , and the distribution remains the same. In the case of IID variables, we can swap any two variables X i and X j , and the distribution remains the same, i.e. P [ X i = x i , X j = x j , … | Θ ] = P [ X j = x i , X i = x j , … | Θ ] If we can swap exception variables with non-exception variables, then we can sometimes eliminate the exceptions altogether. Theorem Let ( X 1 , … , X n ) be continuous random variables, conditionally independent and identically distributed given Θ (i.e. P [ X = x | Θ ] = ∏ i P [ X 1 = x | Θ ] ). There exists a D-dimensional sufficient statistic G ( X ) summarizing all information in X relevant to Θ , with D < n , if-and-only-if the distribution has the form P [ X | Θ ] = 1 Z ( Θ ) e f ( Θ ) ⋅ ∑ i g ( X i ) ∏ i P [ X i | Θ 0 ] … where f , g are some at-most D-dimensional summary functions. Other than eliminating the exception terms, there are two differences from the independent-but-not-identically-distributed theorem: the g i ’s are all the same function, and we explicitly require D < n . When D ≥ n in the earlier theorem, all variables can be exceptions, so the theorem says nothing. For this theorem, we need at least one non-exceptional variable to swap the other variables with, so we require D < n . Note that this theorem is strictly stronger than the original KPD as typically stated, which also applies to the IID case. The original KPD talks about existence of a finite-dimensional summary for an infinite stream of IID variables, whereas this version applies even to a finite set of variables, so long as the dimension of the sufficient statistic is smaller than the number of variables. Proof Since this a special case of independent variables, we can start from our independent but non-identical theorem: P [ X | Θ ] = 1 Z ( Θ ) e f ( Θ ) ⋅ ∑ i ∉ E g i ( X i ) ∏ i ∉ E P [ X i | Θ 0 ] ∏ i ∈ E P [ X i | Θ ] Since we assume D < n , there must be at least one non-exception variable. So, without loss of generality, assume X 1 ∉ E . For any other variable i ∈ E , we can swap X i with X 1 and integrate out all the other variables to find 1 Z ′ ( Θ ) e f ( Θ ) ⋅ g 1 ( x 1 ) P [ X 1 = x 1 | Θ 0 ] P [ X i = x i | Θ ] = P [ X 1 = x 1 , X i = x i | Θ ] = P [ X 1 = x i , X i = x 1 | Θ ] = 1 Z ′ ( Θ ) e f ( Θ ) ⋅ g 1 ( x i ) P [ X 1 = x i | Θ 0 ] P [ X i = x 1 | Θ ] … then integrate out x 1 : P [ X i = x i | Θ ] = 1 Z ′′ ( Θ ) e f ( Θ ) ⋅ g 1 ( x i ) P [ X 1 = x i | Θ 0 ] (Minor note: we’re absorbing constants into Z ( Θ ) from each integral, which is why it keeps gaining primes.) For variables i ∉ E , we can also swap with X 1 in order to replace g i with g 1 . Swapping and integrating as before yields e f ( Θ ) ⋅ g 1 ( x i ) P [ X 1 = x i | Θ 0 ] = e f ( Θ ) ⋅ g i ( x i ) P [ X i = x i | Θ 0 ] Substituting both of those into the original expression from the independent but non-identical theorem yields P [ X = x | Θ ] = 1 Z ′ ′ ′ ( Θ ) e f ( Θ ) ⋅ ∑ i g 1 ( x i ) ∏ i P [ X 1 = x i | Θ 0 ] … which is the desired form. Key Takeaways While this is a minor improvement over the original KPD, the real point is to show how symmetry can remove the exception terms. I expect this to be an especially powerful tool in conjunction with the techniques in Writing Causal Models Like We Write Programs . That post illustrates how to turn recursively-defined functions into recursively-defined causal models. The recursive calls become exactly the sort of symmetries which could potentially be used to remove exception terms in the Causal Model/Bayes Net KPD. Takeaways Summary The original Koopman-Pitman-Darmois theorem says that a fixed-dimensional sufficient statistic exists for a stream of IID variables if-and-only-if the distribution is of exponential form. This generalizes a lot. Neither independence nor identical distribution is necessary; we need only a sparse causal model. However, this generalization comes with a cost: some “exception” variables may not follow the exponential form. As long as the system is sparse, and the number of variables is much larger than the dimension of the sufficient statistic, the number of exception variables will be relatively small, and the vast majority of variables in the system will satisfy the exponential form. The proofs should also generalize to approximations - systems with approximate sufficient statistics should be approximately exponential family, except for a few variables. We can also sometimes leverage symmetry to eliminate the exception variables. If the distribution is invariant under some permutation of the variables, then we can try to permute exception variables to non-exception variables, in which case they must follow the exponential form. Appendix: Additive Summary Equation Theorem An Additive Summary Equation is a functional equation of the form F ( G ( x ) ) = f ( x ) = ∑ i f i ( x ) … with F and G unknown, G of dimension D < d i m ( f ) , D < d i m ( x ) . In order to say anything nontrivial about the equation, we need each f -term f i to only depend on a few x -components x j , and each x -component to only influence a few f -terms. Given some x j , we can pick out the (indices of) f -components which it influences via the expression { i : ∂ f i ∂ x j ≢ 0 } We’re also interested in the “neighbors” of x j , i.e. x -components x j ′ for which some f i depends on both x j and x j ′ . We’ll write the (indices of) x j ’s neighbors as N ( j ) ; note that we do consider x j a neighbor of itself. The post on the Additive Summary Equation shows that the equation is solvable only if we can choose a set of at-most D components of x , called x B , for which f can be expressed as f ( x ) = ∑ i : ∂ f i ∂ x N ( B ) ≢ 0 f i ( x ) + U ∑ i ′ g i ′ ( x ) + C … where the g i ’s have output dimension at-most D, U is a constant d i m ( f ) by D matrix, and C is a constant vector. In particular, we can choose g i ′ ( x ) = U † ( f i ′ ( x ) − f i ′ ( x 0 ) ) , C = ∑ i ′ f i ′ ( x 0 ) … for some x 0 , with i ′ ranging over terms not dependent on x N ( B ) , i.e. { i ′ : ∂ f i ′ ∂ x j ≡ 0 } . Intuitively, this says that we can’t really say anything about terms dependent on x N ( B ) . However, x N ( B ) consists of at-most D variables plus their neighbors, so in a large sparse system, hopefully most terms will not depend on x N ( B ) . And for all the terms not dependent on x N ( B ) , the information content can be aggregated by summation - i.e. the sum ∑ i ′ g i ′ ( x ) . Note that we may sometimes want to think about f ( x ) whose output dimension is uncountably infinite - i.e. f ( x ) returns a distribution over a continuous variable θ . In that case, the dot product U † ( f i ′ ( x ) − f i ′ ( x 0 ) ) defining g i ′ ( x ) becomes an integral ∫ θ U † ( θ ) ( f i ′ ( x ) ( θ ) − f i ′ ( x 0 ) ( θ ) ) d θ ; everything else remains the same. For simplicity, this post's notation implicitly assumes that θ has finitely many values, but the generalization is always straightforward.